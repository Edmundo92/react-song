!function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,i){"use strict";e.exports=i(5)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.render=t.Midi=t.Track=t.Note=t.Song=void 0;var n=i(6),o=function(e){return e&&e.__esModule?e:{default:e}}(n);t.Song="Song",t.Note="Note",t.Track="Track",t.Midi="Midi",t.render=o.default.render;t.default=o.default},function(e,t,i){"use strict";function n(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
var o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},i=0;i<10;i++)t["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var i,a,c=n(e),u=1;u<arguments.length;u++){i=Object(arguments[u]);for(var l in i)s.call(i,l)&&(c[l]=i[l]);if(o){a=o(i);for(var d=0;d<a.length;d++)r.call(i,a[d])&&(c[a[d]]=i[a[d]])}}return c}},function(e,t,i){i(4),e.exports=i(1)},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var o=i(0),s=n(o),r=i(1),a=i(11),c=n(a),u=i(12),l=n(u),d=i(13),p=n(d),h=i(14),f=n(h);i(15);var m=void 0;switch(new URLSearchParams(window.location.search).get("s")){case"yuyuhakusho":m=f.default;break;case"beverlyhillscop":m=l.default;break;case"backstreetboys":m=p.default;break;case"robot":m=c.default;default:m=p.default}(0,r.render)(s.default.createElement(m,null),document.querySelector("#root"))},function(e,t,i){"use strict";function n(e,t,i,n,o,s,r,a){if(!e){if(e=void 0,void 0===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[i,n,o,s,r,a],u=0;e=Error(t.replace(/%s/g,function(){return c[u++]})),e.name="Invariant Violation"}throw e.framesToPop=1,e}}function o(e){for(var t=arguments.length-1,i="https://reactjs.org/docs/error-decoder.html?invariant="+e,o=0;o<t;o++)i+="&args[]="+encodeURIComponent(arguments[o+1]);n(!1,"Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",i)}function s(e,t,i){this.props=e,this.context=t,this.refs=_,this.updater=i||B}function r(){}function a(e,t,i){this.props=e,this.context=t,this.refs=_,this.updater=i||B}function c(e,t,i){var n=void 0,o={},s=null,r=null;if(null!=t)for(n in void 0!==t.ref&&(r=t.ref),void 0!==t.key&&(s=""+t.key),t)V.call(t,n)&&!q.hasOwnProperty(n)&&(o[n]=t[n]);var a=arguments.length-2;if(1===a)o.children=i;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(n in a=e.defaultProps)void 0===o[n]&&(o[n]=a[n]);return{$$typeof:N,type:e,key:s,ref:r,props:o,_owner:L.current}}function u(e,t){return{$$typeof:N,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function l(e){return"object"==typeof e&&null!==e&&e.$$typeof===N}function d(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,function(e){return t[e]})}function p(e,t,i,n){if(D.length){var o=D.pop();return o.result=e,o.keyPrefix=t,o.func=i,o.context=n,o.count=0,o}return{result:e,keyPrefix:t,func:i,context:n,count:0}}function h(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>D.length&&D.push(e)}function f(e,t,i,n){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var r=!1;if(null===e)r=!0;else switch(s){case"string":case"number":r=!0;break;case"object":switch(e.$$typeof){case N:case P:r=!0}}if(r)return i(n,e,""===t?"."+v(e,0):t),1;if(r=0,t=""===t?".":t+":",Array.isArray(e))for(var a=0;a<e.length;a++){s=e[a];var c=t+v(s,a);r+=f(s,c,i,n)}else if(null===e||"object"!=typeof e?c=null:(c=C&&e[C]||e["@@iterator"],c="function"==typeof c?c:null),"function"==typeof c)for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=t+v(s,a++),r+=f(s,c,i,n);else"object"===s&&(i=""+e,o("31","[object Object]"===i?"object with keys {"+Object.keys(e).join(", ")+"}":i,""));return r}function m(e,t,i){return null==e?0:f(e,"",t,i)}function v(e,t){return"object"==typeof e&&null!==e&&null!=e.key?d(e.key):t.toString(36)}function g(e,t){e.func.call(e.context,t,e.count++)}function y(e,t,i){var n=e.result,o=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?b(e,n,i,function(e){return e}):null!=e&&(l(e)&&(e=u(e,o+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(U,"$&/")+"/")+i)),n.push(e))}function b(e,t,i,n,o){var s="";null!=i&&(s=(""+i).replace(U,"$&/")+"/"),t=p(t,s,n,o),m(e,y,t),h(t)}function k(e,t){var i=L.currentDispatcher;return null===i&&o("277"),i.readContext(e,t)}/** @license React v16.5.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var w=i(2),E="function"==typeof Symbol&&Symbol.for,N=E?Symbol.for("react.element"):60103,P=E?Symbol.for("react.portal"):60106,S=E?Symbol.for("react.fragment"):60107,T=E?Symbol.for("react.strict_mode"):60108,A=E?Symbol.for("react.profiler"):60114,I=E?Symbol.for("react.provider"):60109,x=E?Symbol.for("react.context"):60110,O=E?Symbol.for("react.async_mode"):60111,M=E?Symbol.for("react.forward_ref"):60112;E&&Symbol.for("react.placeholder");var C="function"==typeof Symbol&&Symbol.iterator,B={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_={};s.prototype.isReactComponent={},s.prototype.setState=function(e,t){"object"!=typeof e&&"function"!=typeof e&&null!=e&&o("85"),this.updater.enqueueSetState(this,e,t,"setState")},s.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},r.prototype=s.prototype;var R=a.prototype=new r;R.constructor=a,w(R,s.prototype),R.isPureReactComponent=!0;var L={current:null,currentDispatcher:null},V=Object.prototype.hasOwnProperty,q={key:!0,ref:!0,__self:!0,__source:!0},U=/\/+/g,D=[],F={Children:{map:function(e,t,i){if(null==e)return e;var n=[];return b(e,n,null,t,i),n},forEach:function(e,t,i){if(null==e)return e;t=p(null,null,t,i),m(e,g,t),h(t)},count:function(e){return m(e,function(){return null},null)},toArray:function(e){var t=[];return b(e,t,null,function(e){return e}),t},only:function(e){return l(e)||o("143"),e}},createRef:function(){return{current:null}},Component:s,PureComponent:a,createContext:function(e,t){return void 0===t&&(t=null),e={$$typeof:x,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,Provider:null,Consumer:null,unstable_read:null},e.Provider={$$typeof:I,_context:e},e.Consumer=e,e.unstable_read=k.bind(null,e),e},forwardRef:function(e){return{$$typeof:M,render:e}},Fragment:S,StrictMode:T,unstable_AsyncMode:O,unstable_Profiler:A,createElement:c,cloneElement:function(e,t,i){(null===e||void 0===e)&&o("267",e);var n=void 0,s=w({},e.props),r=e.key,a=e.ref,c=e._owner;if(null!=t){void 0!==t.ref&&(a=t.ref,c=L.current),void 0!==t.key&&(r=""+t.key);var u=void 0;e.type&&e.type.defaultProps&&(u=e.type.defaultProps);for(n in t)V.call(t,n)&&!q.hasOwnProperty(n)&&(s[n]=void 0===t[n]&&void 0!==u?u[n]:t[n])}if(1===(n=arguments.length-2))s.children=i;else if(1<n){u=Array(n);for(var l=0;l<n;l++)u[l]=arguments[l+2];s.children=u}return{$$typeof:N,type:e.type,key:r,ref:a,props:s,_owner:c}},createFactory:function(e){var t=c.bind(null,e);return t.type=e,t},isValidElement:l,version:"16.5.2",__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentOwner:L,assign:w}},j={default:F},z=j&&F||j;e.exports=z.default||z},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(7),o=function(e){return e&&e.__esModule?e:{default:e}}(n),s=i(9),r=(0,o.default)({appendInitialChild:function(e,t){var i=t.type;"notes"===i&&e.addSequence(t.notes),"midi"===i&&e.setMIDI(t.midi)},createInstance:function(e,t,i,n,o){return(0,s.createElement)(e,t,i,o)},createTextInstance:function(e,t,i){return e},finalizeInitialChildren:function(e,t,i){"Song"===t&&window.sequencer.ready(function(){e.render()})},getPublicInstance:function(e){return e},prepareForCommit:function(e){},prepareUpdate:function(e,t,i,n,o){},resetAfterCommit:function(e){},resetTextContent:function(e){},getRootHostContext:function(e){},getChildHostContext:function(){return{}},scheduleAnimationCallback:function(){},scheduleDeferredCallback:function(){},useSyncScheduling:!1,now:Date.now,mutation:{appendChild:function(e,t){},appendChildToContainer:function(e,t){},removeChild:function(e,t){},removeChildFromContainer:function(e,t){},insertBefore:function(e,t,i){},commitUpdate:function(e,t,i,n,o){},commitMount:function(e,t,i,n,o){},commitTextUpdate:function(e,t,i){}},shouldSetTextContent:function(e){return"string"==typeof e.children||"number"==typeof e.children}}),a={},c="function"==typeof WeakMap?new WeakMap:new Map,u={render:function(e,t,i){var n=null==t?a:t,o=c.get(n);return o||(o=r.createContainer(n),c.set(t,o)),r.updateContainer(e,o,null,i),r.injectIntoDevTools({bundleType:1,version:"1.0.0",rendererPackageName:"React Song",findHostInstanceByFiber:r.findHostInstance}),r.getPublicRootInstance(o)}};t.default=u},function(e,t,i){"use strict";e.exports=i(8)},function(e,t,i){/** @license React v16.5.2
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
e.exports=function t(n){"use strict";function o(e,t,i,n,o,s,r,a){if(!e){if(e=void 0,void 0===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[i,n,o,s,r,a],u=0;e=Error(t.replace(/%s/g,function(){return c[u++]})),e.name="Invariant Violation"}throw e.framesToPop=1,e}}function s(e){for(var t=arguments.length-1,i="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=0;n<t;n++)i+="&args[]="+encodeURIComponent(arguments[n+1]);o(!1,"Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",i)}function r(e){return null===e||"object"!=typeof e?null:(e=Nt&&e[Nt]||e["@@iterator"],"function"==typeof e?e:null)}function a(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case kt:return"AsyncMode";case mt:return"Fragment";case ft:return"Portal";case gt:return"Profiler";case vt:return"StrictMode";case Et:return"Placeholder"}if("object"==typeof e){switch(e.$$typeof){case bt:return"Context.Consumer";case yt:return"Context.Provider";case wt:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef")}if("function"==typeof e.then&&(e=1===e._reactStatus?e._reactResult:null))return a(e)}return null}function c(e){var t=e;if(e.alternate)for(;t.return;)t=t.return;else{if(0!=(2&t.effectTag))return 1;for(;t.return;)if(t=t.return,0!=(2&t.effectTag))return 1}return 5===t.tag?2:3}function u(e){2!==c(e)&&s("188")}function l(e){var t=e.alternate;if(!t)return t=c(e),3===t&&s("188"),1===t?null:e;for(var i=e,n=t;;){var o=i.return,r=o?o.alternate:null;if(!o||!r)break;if(o.child===r.child){for(var a=o.child;a;){if(a===i)return u(o),e;if(a===n)return u(o),t;a=a.sibling}s("188")}if(i.return!==n.return)i=o,n=r;else{a=!1;for(var l=o.child;l;){if(l===i){a=!0,i=o,n=r;break}if(l===n){a=!0,n=o,i=r;break}l=l.sibling}if(!a){for(l=r.child;l;){if(l===i){a=!0,i=r,n=o;break}if(l===n){a=!0,n=r,i=o;break}l=l.sibling}a||s("189")}}i.alternate!==n&&s("190")}return 5!==i.tag&&s("188"),i.stateNode.current===i?e:t}function d(e){if(!(e=l(e)))return null;for(var t=e;;){if(7===t.tag||8===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function p(e){if(!(e=l(e)))return null;for(var t=e;;){if(7===t.tag||8===t.tag)return t;if(t.child&&6!==t.tag)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function h(e){var t="";do{e:switch(e.tag){case 4:case 0:case 1:case 2:case 3:case 7:case 10:var i=e._debugOwner,n=e._debugSource,o=a(e.type),s=null;i&&(s=a(i.type)),i=o,o="",n?o=" (at "+n.fileName.replace(di,"")+":"+n.lineNumber+")":s&&(o=" (created by "+s+")"),s="\n    in "+(i||"Unknown")+o;break e;default:s=""}t+=s,e=e.return}while(e);return t}function f(e){0>hi||(e.current=pi[hi],pi[hi]=null,hi--)}function m(e,t){hi++,pi[hi]=e.current,e.current=t}function v(e,t){var i=e.type.contextTypes;if(!i)return fi;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var o,s={};for(o in i)s[o]=t[o];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function g(e){return null!==(e=e.childContextTypes)&&void 0!==e}function y(e){f(vi,e),f(mi,e)}function b(e){f(vi,e),f(mi,e)}function k(e,t,i){mi.current!==fi&&s("168"),m(mi,t,e),m(vi,i,e)}function w(e,t,i){var n=e.stateNode;if(e=t.childContextTypes,"function"!=typeof n.getChildContext)return i;n=n.getChildContext();for(var o in n)o in e||s("108",a(t)||"Unknown",o);return ut({},i,n)}function E(e){var t=e.stateNode;return t=t&&t.__reactInternalMemoizedMergedChildContext||fi,gi=mi.current,m(mi,t,e),m(vi,vi.current,e),!0}function N(e,t,i){var n=e.stateNode;n||s("169"),i?(t=w(e,t,gi),n.__reactInternalMemoizedMergedChildContext=t,f(vi,e),f(mi,e),m(mi,t,e)):f(vi,e),m(vi,i,e)}function P(e){return function(t){try{return e(t)}catch(e){}}}function S(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var i=t.inject(e);yi=P(function(e){return t.onCommitFiberRoot(i,e)}),bi=P(function(e){return t.onCommitFiberUnmount(i,e)})}catch(e){}return!0}function T(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=null,this.index=0,this.ref=null,this.pendingProps=t,this.firstContextDependency=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function A(e){return!(!(e=e.prototype)||!e.isReactComponent)}function I(e,t,i){var n=e.alternate;return null===n?(n=new T(e.tag,t,e.key,e.mode),n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=t!==e.pendingProps?i:e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,n.firstContextDependency=e.firstContextDependency,n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function x(e,t,i){var n=e.type,o=e.key;e=e.props;var r=void 0;if("function"==typeof n)r=A(n)?2:4;else if("string"==typeof n)r=7;else e:switch(n){case mt:return O(e.children,t,i,o);case kt:r=10,t|=3;break;case vt:r=10,t|=2;break;case gt:return n=new T(15,e,o,4|t),n.type=gt,n.expirationTime=i,n;case Et:r=16;break;default:if("object"==typeof n&&null!==n)switch(n.$$typeof){case yt:r=12;break e;case bt:r=11;break e;case wt:r=13;break e;default:if("function"==typeof n.then){r=4;break e}}s("130",null==n?n:typeof n,"")}return t=new T(r,e,o,t),t.type=n,t.expirationTime=i,t}function O(e,t,i,n){return e=new T(9,e,n,t),e.expirationTime=i,e}function M(e,t,i){return e=new T(8,e,null,t),e.expirationTime=i,e}function C(e,t,i){return t=new T(6,null!==e.children?e.children:[],e.key,t),t.expirationTime=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function B(e,t){e.didError=!1;var i=e.earliestPendingTime;0===i?e.earliestPendingTime=e.latestPendingTime=t:i>t?e.earliestPendingTime=t:e.latestPendingTime<t&&(e.latestPendingTime=t),_(t,e)}function _(e,t){var i=t.earliestSuspendedTime,n=t.latestSuspendedTime,o=t.earliestPendingTime,s=t.latestPingedTime;o=0!==o?o:s,0===o&&(0===e||n>e)&&(o=n),e=o,0!==e&&0!==i&&i<e&&(e=i),t.nextExpirationTimeToWorkOn=o,t.expirationTime=e}function R(e){return{baseState:e,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function L(e){return{baseState:e.baseState,firstUpdate:e.firstUpdate,lastUpdate:e.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function V(e){return{expirationTime:e,tag:0,payload:null,callback:null,next:null,nextEffect:null}}function q(e,t){null===e.lastUpdate?e.firstUpdate=e.lastUpdate=t:(e.lastUpdate.next=t,e.lastUpdate=t)}function U(e,t){var i=e.alternate;if(null===i){var n=e.updateQueue,o=null;null===n&&(n=e.updateQueue=R(e.memoizedState))}else n=e.updateQueue,o=i.updateQueue,null===n?null===o?(n=e.updateQueue=R(e.memoizedState),o=i.updateQueue=R(i.memoizedState)):n=e.updateQueue=L(o):null===o&&(o=i.updateQueue=L(n));null===o||n===o?q(n,t):null===n.lastUpdate||null===o.lastUpdate?(q(n,t),q(o,t)):(q(n,t),o.lastUpdate=t)}function D(e,t){var i=e.updateQueue;i=null===i?e.updateQueue=R(e.memoizedState):F(e,i),null===i.lastCapturedUpdate?i.firstCapturedUpdate=i.lastCapturedUpdate=t:(i.lastCapturedUpdate.next=t,i.lastCapturedUpdate=t)}function F(e,t){var i=e.alternate;return null!==i&&t===i.updateQueue&&(t=e.updateQueue=L(t)),t}function j(e,t,i,n,o,s){switch(i.tag){case 1:return e=i.payload,"function"==typeof e?e.call(s,n,o):e;case 3:e.effectTag=-1025&e.effectTag|64;case 0:if(e=i.payload,null===(o="function"==typeof e?e.call(s,n,o):e)||void 0===o)break;return ut({},n,o);case 2:ki=!0}return n}function z(e,t,i,n,o){ki=!1,t=F(e,t);for(var s=t.baseState,r=null,a=0,c=t.firstUpdate,u=s;null!==c;){var l=c.expirationTime;l>o?(null===r&&(r=c,s=u),(0===a||a>l)&&(a=l)):(u=j(e,t,c,u,i,n),null!==c.callback&&(e.effectTag|=32,c.nextEffect=null,null===t.lastEffect?t.firstEffect=t.lastEffect=c:(t.lastEffect.nextEffect=c,t.lastEffect=c))),c=c.next}for(l=null,c=t.firstCapturedUpdate;null!==c;){var d=c.expirationTime;d>o?(null===l&&(l=c,null===r&&(s=u)),(0===a||a>d)&&(a=d)):(u=j(e,t,c,u,i,n),null!==c.callback&&(e.effectTag|=32,c.nextEffect=null,null===t.lastCapturedEffect?t.firstCapturedEffect=t.lastCapturedEffect=c:(t.lastCapturedEffect.nextEffect=c,t.lastCapturedEffect=c))),c=c.next}null===r&&(t.lastUpdate=null),null===l?t.lastCapturedUpdate=null:e.effectTag|=32,null===r&&null===l&&(s=u),t.baseState=s,t.firstUpdate=r,t.firstCapturedUpdate=l,e.expirationTime=a,e.memoizedState=u}function W(e,t,i){null!==t.firstCapturedUpdate&&(null!==t.lastUpdate&&(t.lastUpdate.next=t.firstCapturedUpdate,t.lastUpdate=t.lastCapturedUpdate),t.firstCapturedUpdate=t.lastCapturedUpdate=null),Q(t.firstEffect,i),t.firstEffect=t.lastEffect=null,Q(t.firstCapturedEffect,i),t.firstCapturedEffect=t.lastCapturedEffect=null}function Q(e,t){for(;null!==e;){var i=e.callback;if(null!==i){e.callback=null;var n=t;"function"!=typeof i&&s("191",i),i.call(n)}e=e.nextEffect}}function H(e,t){return{value:e,source:t,stack:h(t)}}function K(e,t){var i=e.type._context;Dt?(m(wi,i._currentValue,e),i._currentValue=t):(m(wi,i._currentValue2,e),i._currentValue2=t)}function X(e){var t=wi.current;f(wi,e),e=e.type._context,Dt?e._currentValue=t:e._currentValue2=t}function G(e){Ei=e,Pi=Ni=null,e.firstContextDependency=null}function Z(e,t){return Pi!==e&&!1!==t&&0!==t&&("number"==typeof t&&1073741823!==t||(Pi=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Ni?(null===Ei&&s("277"),Ei.firstContextDependency=Ni=t):Ni=Ni.next=t),Dt?e._currentValue:e._currentValue2}function Y(e){return e===Si&&s("174"),e}function J(e,t){m(Ii,t,e),m(Ai,e,e),m(Ti,Si,e),t=St(t),f(Ti,e),m(Ti,t,e)}function $(e){f(Ti,e),f(Ai,e),f(Ii,e)}function ee(e){var t=Y(Ii.current),i=Y(Ti.current);t=Tt(i,e.type,t),i!==t&&(m(Ai,e,e),m(Ti,t,e))}function te(e){Ai.current===e&&(f(Ti,e),f(Ai,e))}function ie(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!==e&&t!==t}function ne(e,t){if(ie(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++)if(!xi.call(t,i[n])||!ie(e[i[n]],t[i[n]]))return!1;return!0}function oe(e,t,i,n){t=e.memoizedState,i=i(n,t),i=null===i||void 0===i?t:ut({},t,i),e.memoizedState=i,null!==(n=e.updateQueue)&&0===e.expirationTime&&(n.baseState=i)}function se(e,t,i,n,o,s,r){return e=e.stateNode,"function"==typeof e.shouldComponentUpdate?e.shouldComponentUpdate(n,s,r):!t.prototype||!t.prototype.isPureReactComponent||(!ne(i,n)||!ne(o,s))}function re(e,t,i,n){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&Mi.enqueueReplaceState(t,t.state,null)}function ae(e,t,i,n){var o=e.stateNode,s=g(t)?gi:mi.current;o.props=i,o.state=e.memoizedState,o.refs=Oi,o.context=v(e,s),s=e.updateQueue,null!==s&&(z(e,s,i,o,n),o.state=e.memoizedState),s=t.getDerivedStateFromProps,"function"==typeof s&&(oe(e,t,s,i),o.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||(t=o.state,"function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&Mi.enqueueReplaceState(o,o.state,null),null!==(s=e.updateQueue)&&(z(e,s,i,o,n),o.state=e.memoizedState)),"function"==typeof o.componentDidMount&&(e.effectTag|=4)}function ce(e,t,i){if(null!==(e=i.ref)&&"function"!=typeof e&&"object"!=typeof e){if(i._owner){i=i._owner;var n=void 0;i&&(2!==i.tag&&3!==i.tag&&s("110"),n=i.stateNode),n||s("147",e);var o=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=n.refs;t===Oi&&(t=n.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}"string"!=typeof e&&s("284"),i._owner||s("254",e)}return e}function ue(e,t){"textarea"!==e.type&&s("31","[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,"")}function le(e){function t(t,i){if(e){var n=t.lastEffect;null!==n?(n.nextEffect=i,t.lastEffect=i):t.firstEffect=t.lastEffect=i,i.nextEffect=null,i.effectTag=8}}function i(i,n){if(!e)return null;for(;null!==n;)t(i,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t,i){return e=I(e,t,i),e.index=0,e.sibling=null,e}function a(t,i,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index,n<i?(t.effectTag=2,i):n):(t.effectTag=2,i):i}function c(t){return e&&null===t.alternate&&(t.effectTag=2),t}function u(e,t,i,n){return null===t||8!==t.tag?(t=M(i,e.mode,n),t.return=e,t):(t=o(t,i,n),t.return=e,t)}function l(e,t,i,n){return null!==t&&t.type===i.type?(n=o(t,i.props,n),n.ref=ce(e,t,i),n.return=e,n):(n=x(i,e.mode,n),n.ref=ce(e,t,i),n.return=e,n)}function d(e,t,i,n){return null===t||6!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?(t=C(i,e.mode,n),t.return=e,t):(t=o(t,i.children||[],n),t.return=e,t)}function p(e,t,i,n,s){return null===t||9!==t.tag?(t=O(i,e.mode,n,s),t.return=e,t):(t=o(t,i,n),t.return=e,t)}function h(e,t,i){if("string"==typeof t||"number"==typeof t)return t=M(""+t,e.mode,i),t.return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case ht:return i=x(t,e.mode,i),i.ref=ce(e,null,t),i.return=e,i;case ft:return t=C(t,e.mode,i),t.return=e,t}if(Ci(t)||r(t))return t=O(t,e.mode,i,null),t.return=e,t;ue(e,t)}return null}function f(e,t,i,n){var o=null!==t?t.key:null;if("string"==typeof i||"number"==typeof i)return null!==o?null:u(e,t,""+i,n);if("object"==typeof i&&null!==i){switch(i.$$typeof){case ht:return i.key===o?i.type===mt?p(e,t,i.props.children,n,o):l(e,t,i,n):null;case ft:return i.key===o?d(e,t,i,n):null}if(Ci(i)||r(i))return null!==o?null:p(e,t,i,n,null);ue(e,i)}return null}function m(e,t,i,n,o){if("string"==typeof n||"number"==typeof n)return e=e.get(i)||null,u(t,e,""+n,o);if("object"==typeof n&&null!==n){switch(n.$$typeof){case ht:return e=e.get(null===n.key?i:n.key)||null,n.type===mt?p(t,e,n.props.children,o,n.key):l(t,e,n,o);case ft:return e=e.get(null===n.key?i:n.key)||null,d(t,e,n,o)}if(Ci(n)||r(n))return e=e.get(i)||null,p(t,e,n,o,null);ue(t,n)}return null}function v(o,s,r,c){for(var u=null,l=null,d=s,p=s=0,v=null;null!==d&&p<r.length;p++){d.index>p?(v=d,d=null):v=d.sibling;var g=f(o,d,r[p],c);if(null===g){null===d&&(d=v);break}e&&d&&null===g.alternate&&t(o,d),s=a(g,s,p),null===l?u=g:l.sibling=g,l=g,d=v}if(p===r.length)return i(o,d),u;if(null===d){for(;p<r.length;p++)(d=h(o,r[p],c))&&(s=a(d,s,p),null===l?u=d:l.sibling=d,l=d);return u}for(d=n(o,d);p<r.length;p++)(v=m(d,o,p,r[p],c))&&(e&&null!==v.alternate&&d.delete(null===v.key?p:v.key),s=a(v,s,p),null===l?u=v:l.sibling=v,l=v);return e&&d.forEach(function(e){return t(o,e)}),u}function g(o,c,u,l){var d=r(u);"function"!=typeof d&&s("150"),null==(u=d.call(u))&&s("151");for(var p=d=null,v=c,g=c=0,y=null,b=u.next();null!==v&&!b.done;g++,b=u.next()){v.index>g?(y=v,v=null):y=v.sibling;var k=f(o,v,b.value,l);if(null===k){v||(v=y);break}e&&v&&null===k.alternate&&t(o,v),c=a(k,c,g),null===p?d=k:p.sibling=k,p=k,v=y}if(b.done)return i(o,v),d;if(null===v){for(;!b.done;g++,b=u.next())null!==(b=h(o,b.value,l))&&(c=a(b,c,g),null===p?d=b:p.sibling=b,p=b);return d}for(v=n(o,v);!b.done;g++,b=u.next())null!==(b=m(v,o,g,b.value,l))&&(e&&null!==b.alternate&&v.delete(null===b.key?g:b.key),c=a(b,c,g),null===p?d=b:p.sibling=b,p=b);return e&&v.forEach(function(e){return t(o,e)}),d}return function(e,n,a,u){var l="object"==typeof a&&null!==a&&a.type===mt&&null===a.key;l&&(a=a.props.children);var d="object"==typeof a&&null!==a;if(d)switch(a.$$typeof){case ht:e:{for(d=a.key,l=n;null!==l;){if(l.key===d){if(9===l.tag?a.type===mt:l.type===a.type){i(e,l.sibling),n=o(l,a.type===mt?a.props.children:a.props,u),n.ref=ce(e,l,a),n.return=e,e=n;break e}i(e,l);break}t(e,l),l=l.sibling}a.type===mt?(n=O(a.props.children,e.mode,u,a.key),n.return=e,e=n):(u=x(a,e.mode,u),u.ref=ce(e,n,a),u.return=e,e=u)}return c(e);case ft:e:{for(l=a.key;null!==n;){if(n.key===l){if(6===n.tag&&n.stateNode.containerInfo===a.containerInfo&&n.stateNode.implementation===a.implementation){i(e,n.sibling),n=o(n,a.children||[],u),n.return=e,e=n;break e}i(e,n);break}t(e,n),n=n.sibling}n=C(a,e.mode,u),n.return=e,e=n}return c(e)}if("string"==typeof a||"number"==typeof a)return a=""+a,null!==n&&8===n.tag?(i(e,n.sibling),n=o(n,a,u),n.return=e,e=n):(i(e,n),n=M(a,e.mode,u),n.return=e,e=n),c(e);if(Ci(a))return v(e,n,a,u);if(r(a))return g(e,n,a,u);if(d&&ue(e,a),void 0===a&&!l)switch(e.tag){case 2:case 3:case 0:u=e.type,s("152",u.displayName||u.name||"Component")}return i(e,n)}}function de(e,t){var i=new T(7,null,null,0);i.type="DELETED",i.stateNode=t,i.return=e,i.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=i,e.lastEffect=i):e.firstEffect=e.lastEffect=i}function pe(e,t){switch(e.tag){case 7:return null!==(t=si(t,e.type,e.pendingProps))&&(e.stateNode=t,!0);case 8:return null!==(t=ri(t,e.pendingProps))&&(e.stateNode=t,!0);default:return!1}}function he(e){if(Vi){var t=Li;if(t){var i=t;if(!pe(e,t)){if(!(t=ai(i))||!pe(e,t))return e.effectTag|=2,Vi=!1,void(Ri=e);de(Ri,i)}Ri=e,Li=ci(t)}else e.effectTag|=2,Vi=!1,Ri=e}}function fe(e){for(e=e.return;null!==e&&7!==e.tag&&5!==e.tag;)e=e.return;Ri=e}function me(e){if(!zt||e!==Ri)return!1;if(!Vi)return fe(e),Vi=!0,!1;var t=e.type;if(7!==e.tag||"head"!==t&&"body"!==t&&!Bt(t,e.memoizedProps))for(t=Li;t;)de(e,t),t=ai(t);return fe(e),Li=Ri?ai(e.stateNode):null,!0}function ve(){zt&&(Li=Ri=null,Vi=!1)}function ge(e){switch(e._reactStatus){case 1:return e._reactResult;case 2:throw e._reactResult;case 0:throw e;default:throw e._reactStatus=0,e.then(function(t){if(0===e._reactStatus){if(e._reactStatus=1,"object"==typeof t&&null!==t){var i=t.default;t=void 0!==i&&null!==i?i:t}e._reactResult=t}},function(t){0===e._reactStatus&&(e._reactStatus=2,e._reactResult=t)}),e}}function ye(e,t,i,n){t.child=null===e?_i(t,null,i,n):Bi(t,e.child,i,n)}function be(e,t,i,n,o){i=i.render;var s=t.ref;return vi.current||t.memoizedProps!==n||s!==(null!==e?e.ref:null)?(i=i(n,s),ye(e,t,i,o),t.memoizedProps=n,t.child):Ae(e,t,o)}function ke(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.effectTag|=128)}function we(e,t,i,n,o){var s=g(i)?gi:mi.current;return s=v(t,s),G(t,o),i=i(n,s),t.effectTag|=1,ye(e,t,i,o),t.memoizedProps=n,t.child}function Ee(e,t,i,n,o){if(g(i)){var s=!0;E(t)}else s=!1;if(G(t,o),null===e)if(null===t.stateNode){var r=g(i)?gi:mi.current,a=i.contextTypes,c=null!==a&&void 0!==a;a=c?v(t,r):fi;var u=new i(n,a);t.memoizedState=null!==u.state&&void 0!==u.state?u.state:null,u.updater=Mi,t.stateNode=u,u._reactInternalFiber=t,c&&(c=t.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=r,c.__reactInternalMemoizedMaskedChildContext=a),ae(t,i,n,o),n=!0}else{r=t.stateNode,a=t.memoizedProps,r.props=a;var l=r.context;c=g(i)?gi:mi.current,c=v(t,c);var d=i.getDerivedStateFromProps;(u="function"==typeof d||"function"==typeof r.getSnapshotBeforeUpdate)||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(a!==n||l!==c)&&re(t,r,n,c),ki=!1;var p=t.memoizedState;l=r.state=p;var h=t.updateQueue;null!==h&&(z(t,h,n,r,o),l=t.memoizedState),a!==n||p!==l||vi.current||ki?("function"==typeof d&&(oe(t,i,d,n),l=t.memoizedState),(a=ki||se(t,i,a,n,p,l,c))?(u||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||("function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount()),"function"==typeof r.componentDidMount&&(t.effectTag|=4)):("function"==typeof r.componentDidMount&&(t.effectTag|=4),t.memoizedProps=n,t.memoizedState=l),r.props=n,r.state=l,r.context=c,n=a):("function"==typeof r.componentDidMount&&(t.effectTag|=4),n=!1)}else r=t.stateNode,a=t.memoizedProps,r.props=a,l=r.context,c=g(i)?gi:mi.current,c=v(t,c),d=i.getDerivedStateFromProps,(u="function"==typeof d||"function"==typeof r.getSnapshotBeforeUpdate)||"function"!=typeof r.UNSAFE_componentWillReceiveProps&&"function"!=typeof r.componentWillReceiveProps||(a!==n||l!==c)&&re(t,r,n,c),ki=!1,l=t.memoizedState,p=r.state=l,h=t.updateQueue,null!==h&&(z(t,h,n,r,o),p=t.memoizedState),a!==n||l!==p||vi.current||ki?("function"==typeof d&&(oe(t,i,d,n),p=t.memoizedState),(d=ki||se(t,i,a,n,l,p,c))?(u||"function"!=typeof r.UNSAFE_componentWillUpdate&&"function"!=typeof r.componentWillUpdate||("function"==typeof r.componentWillUpdate&&r.componentWillUpdate(n,p,c),"function"==typeof r.UNSAFE_componentWillUpdate&&r.UNSAFE_componentWillUpdate(n,p,c)),"function"==typeof r.componentDidUpdate&&(t.effectTag|=4),"function"==typeof r.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!=typeof r.componentDidUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!=typeof r.getSnapshotBeforeUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),t.memoizedProps=n,t.memoizedState=p),r.props=n,r.state=p,r.context=c,n=d):("function"!=typeof r.componentDidUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!=typeof r.getSnapshotBeforeUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),n=!1);return Ne(e,t,i,n,s,o)}function Ne(e,t,i,n,o,s){ke(e,t);var r=0!=(64&t.effectTag);if(!n&&!r)return o&&N(t,i,!1),Ae(e,t,s);n=t.stateNode,qi.current=t;var a=r?null:n.render();return t.effectTag|=1,null!==e&&r&&(ye(e,t,null,s),t.child=null),ye(e,t,a,s),t.memoizedState=n.state,t.memoizedProps=n.props,o&&N(t,i,!0),t.child}function Pe(e){var t=e.stateNode;t.pendingContext?k(e,t.pendingContext,t.pendingContext!==t.context):t.context&&k(e,t.context,!1),J(e,t.containerInfo)}function Se(e,t){if(e&&e.defaultProps){t=ut({},t),e=e.defaultProps;for(var i in e)void 0===t[i]&&(t[i]=e[i])}return t}function Te(e,t,i,n){null!==e&&s("155");var o=t.pendingProps;if("object"==typeof i&&null!==i&&"function"==typeof i.then){i=ge(i);var r=i;r="function"==typeof r?A(r)?3:1:void 0!==r&&null!==r&&r.$$typeof?14:4,r=t.tag=r;var a=Se(i,o);switch(r){case 1:return we(e,t,i,a,n);case 3:return Ee(e,t,i,a,n);case 14:return be(e,t,i,a,n);default:s("283",i)}}if(r=v(t,mi.current),G(t,n),r=i(o,r),t.effectTag|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof){t.tag=2,g(i)?(a=!0,E(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null;var c=i.getDerivedStateFromProps;return"function"==typeof c&&oe(t,i,c,o),r.updater=Mi,t.stateNode=r,r._reactInternalFiber=t,ae(t,i,o,n),Ne(e,t,i,!0,a,n)}return t.tag=0,ye(e,t,r,n),t.memoizedProps=o,t.child}function Ae(e,t,i){null!==e&&(t.firstContextDependency=e.firstContextDependency);var n=t.childExpirationTime;if(0===n||n>i)return null;if(null!==e&&t.child!==e.child&&s("153"),null!==t.child){for(e=t.child,i=I(e,e.pendingProps,e.expirationTime),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,i=i.sibling=I(e,e.pendingProps,e.expirationTime),i.return=t;i.sibling=null}return t.child}function Ie(e,t,i){var n=t.expirationTime;if(!vi.current&&(0===n||n>i)){switch(t.tag){case 5:Pe(t),ve();break;case 7:ee(t);break;case 2:g(t.type)&&E(t);break;case 3:g(t.type._reactResult)&&E(t);break;case 6:J(t,t.stateNode.containerInfo);break;case 12:K(t,t.memoizedProps.value)}return Ae(e,t,i)}switch(t.expirationTime=0,t.tag){case 4:return Te(e,t,t.type,i);case 0:return we(e,t,t.type,t.pendingProps,i);case 1:var o=t.type._reactResult;return n=t.pendingProps,e=we(e,t,o,Se(o,n),i),t.memoizedProps=n,e;case 2:return Ee(e,t,t.type,t.pendingProps,i);case 3:return o=t.type._reactResult,n=t.pendingProps,e=Ee(e,t,o,Se(o,n),i),t.memoizedProps=n,e;case 5:return Pe(t),n=t.updateQueue,null===n&&s("282"),o=t.memoizedState,o=null!==o?o.element:null,z(t,n,t.pendingProps,null,i),n=t.memoizedState.element,n===o?(ve(),t=Ae(e,t,i)):(o=t.stateNode,(o=(null===e||null===e.child)&&o.hydrate)&&(zt?(Li=ci(t.stateNode.containerInfo),Ri=t,o=Vi=!0):o=!1),o?(t.effectTag|=2,t.child=_i(t,null,n,i)):(ye(e,t,n,i),ve()),t=t.child),t;case 7:ee(t),null===e&&he(t),n=t.type,o=t.pendingProps;var r=null!==e?e.memoizedProps:null,a=o.children;return Bt(n,o)?a=null:null!==r&&Bt(n,r)&&(t.effectTag|=16),ke(e,t),1073741823!==i&&1&t.mode&&_t(n,o)?(t.expirationTime=1073741823,t.memoizedProps=o,t=null):(ye(e,t,a,i),t.memoizedProps=o,t=t.child),t;case 8:return null===e&&he(t),t.memoizedProps=t.pendingProps,null;case 16:return null;case 6:return J(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Bi(t,null,n,i):ye(e,t,n,i),t.memoizedProps=n,t.child;case 13:return be(e,t,t.type,t.pendingProps,i);case 14:return o=t.type._reactResult,n=t.pendingProps,e=be(e,t,o,Se(o,n),i),t.memoizedProps=n,e;case 9:return n=t.pendingProps,ye(e,t,n,i),t.memoizedProps=n,t.child;case 10:return n=t.pendingProps.children,ye(e,t,n,i),t.memoizedProps=n,t.child;case 15:return n=t.pendingProps,ye(e,t,n.children,i),t.memoizedProps=n,t.child;case 12:e:{if(n=t.type._context,o=t.pendingProps,a=t.memoizedProps,r=o.value,t.memoizedProps=o,K(t,r),null!==a){var c=a.value;if(0===(r=c===r&&(0!==c||1/c==1/r)||c!==c&&r!==r?0:0|("function"==typeof n._calculateChangedBits?n._calculateChangedBits(c,r):1073741823))){if(a.children===o.children&&!vi.current){t=Ae(e,t,i);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){if(null!==(c=a.firstContextDependency))do{if(c.context===n&&0!=(c.observedBits&r)){if(2===a.tag||3===a.tag){var u=V(i);u.tag=2,U(a,u)}(0===a.expirationTime||a.expirationTime>i)&&(a.expirationTime=i),u=a.alternate,null!==u&&(0===u.expirationTime||u.expirationTime>i)&&(u.expirationTime=i);for(var l=a.return;null!==l;){if(u=l.alternate,0===l.childExpirationTime||l.childExpirationTime>i)l.childExpirationTime=i,null!==u&&(0===u.childExpirationTime||u.childExpirationTime>i)&&(u.childExpirationTime=i);else{if(null===u||!(0===u.childExpirationTime||u.childExpirationTime>i))break;u.childExpirationTime=i}l=l.return}}u=a.child,c=c.next}while(null!==c);else u=12===a.tag&&a.type===t.type?null:a.child;if(null!==u)u.return=a;else for(u=a;null!==u;){if(u===t){u=null;break}if(null!==(a=u.sibling)){a.return=u.return,u=a;break}u=u.return}a=u}}ye(e,t,o.children,i),t=t.child}return t;case 11:return r=t.type,n=t.pendingProps,o=n.children,G(t,i),r=Z(r,n.unstable_observedBits),o=o(r),t.effectTag|=1,ye(e,t,o,i),t.memoizedProps=n,t.child;default:s("156")}}function xe(e){e.effectTag|=4}function Oe(e,t){for(var i=t.child;null!==i;){if(7===i.tag||8===i.tag)Ot(e,i.stateNode);else if(6!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function Me(e,t){var i=t.source,n=t.stack;null===n&&null!==i&&(n=h(i)),null!==i&&a(i.type),t=t.value,null!==e&&2===e.tag&&a(e.type);try{console.error(t)}catch(e){setTimeout(function(){throw e})}}function Ce(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){He(e,t)}else t.current=null}function Be(e){switch("function"==typeof bi&&bi(e),e.tag){case 2:case 3:Ce(e);var t=e.stateNode;if("function"==typeof t.componentWillUnmount)try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){He(e,t)}break;case 7:Ce(e);break;case 6:Ft?Ve(e):jt&&jt&&(e=e.stateNode.containerInfo,t=ti(e),oi(e,t))}}function _e(e){for(var t=e;;)if(Be(t),null===t.child||Ft&&6===t.tag){if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}else t.child.return=t,t=t.child}function Re(e){return 7===e.tag||5===e.tag||6===e.tag}function Le(e){if(Ft){e:{for(var t=e.return;null!==t;){if(Re(t)){var i=t;break e}t=t.return}s("160"),i=void 0}var n=t=void 0;switch(i.tag){case 7:t=i.stateNode,n=!1;break;case 5:case 6:t=i.stateNode.containerInfo,n=!0;break;default:s("161")}16&i.effectTag&&($t(t),i.effectTag&=-17);e:t:for(i=e;;){for(;null===i.sibling;){if(null===i.return||Re(i.return)){i=null;break e}i=i.return}for(i.sibling.return=i.return,i=i.sibling;7!==i.tag&&8!==i.tag;){if(2&i.effectTag)continue t;if(null===i.child||6===i.tag)continue t;i.child.return=i,i=i.child}if(!(2&i.effectTag)){i=i.stateNode;break e}}for(var o=e;;){if(7===o.tag||8===o.tag)i?n?Zt(t,o.stateNode,i):Gt(t,o.stateNode,i):n?Qt(t,o.stateNode):Wt(t,o.stateNode);else if(6!==o.tag&&null!==o.child){o.child.return=o,o=o.child;continue}if(o===e)break;for(;null===o.sibling;){if(null===o.return||o.return===e)return;o=o.return}o.sibling.return=o.return,o=o.sibling}}}function Ve(e){for(var t=e,i=!1,n=void 0,o=void 0;;){if(!i){i=t.return;e:for(;;){switch(null===i&&s("160"),i.tag){case 7:n=i.stateNode,o=!1;break e;case 5:case 6:n=i.stateNode.containerInfo,o=!0;break e}i=i.return}i=!0}if(7===t.tag||8===t.tag)_e(t),o?Jt(n,t.stateNode):Yt(n,t.stateNode);else if(6===t.tag?(n=t.stateNode.containerInfo,o=!0):Be(t),null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return;t=t.return,6===t.tag&&(i=!1)}t.sibling.return=t.return,t=t.sibling}}function qe(e,t){if(Ft)switch(t.tag){case 2:case 3:break;case 7:var i=t.stateNode;if(null!=i){var n=t.memoizedProps;e=null!==e?e.memoizedProps:n;var o=t.type,r=t.updateQueue;t.updateQueue=null,null!==r&&Xt(i,r,o,e,n,t)}break;case 8:null===t.stateNode&&s("162"),i=t.memoizedProps,Ht(t.stateNode,null!==e?e.memoizedProps:i,i);break;case 5:case 15:case 16:break;default:s("163")}else if(jt)switch(t.tag){case 2:case 3:case 7:case 8:break;case 5:case 6:t=t.stateNode,oi(t.containerInfo,t.pendingChildren);break;default:s("163")}}function Ue(e,t,i){i=V(i),i.tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){rt(n),Me(e,t)},i}function De(e,t,i){i=V(i),i.tag=3;var n=e.stateNode;return null!==n&&"function"==typeof n.componentDidCatch&&(i.callback=function(){null===$i?$i=new Set([this]):$i.add(this);var i=t.value,n=t.stack;Me(e,t),this.componentDidCatch(i,{componentStack:null!==n?n:""})}),i}function Fe(e){switch(e.tag){case 2:g(e.type)&&y(e);var t=e.effectTag;return 1024&t?(e.effectTag=-1025&t|64,e):null;case 3:return g(e.type._reactResult)&&y(e),t=e.effectTag,1024&t?(e.effectTag=-1025&t|64,e):null;case 5:return $(e),b(e),t=e.effectTag,0!=(64&t)&&s("285"),e.effectTag=-1025&t|64,e;case 7:return te(e),null;case 16:return t=e.effectTag,1024&t?(e.effectTag=-1025&t|64,e):null;case 6:return $(e),null;case 12:return X(e),null;default:return null}}function je(){if(null!==Ki)for(var e=Ki.return;null!==e;){var t=e;switch(t.tag){case 2:var i=t.type.childContextTypes;null!==i&&void 0!==i&&y(t);break;case 3:i=t.type._reactResult.childContextTypes,null!==i&&void 0!==i&&y(t);break;case 5:$(t),b(t);break;case 7:te(t);break;case 6:$(t);break;case 12:X(t)}e=e.return}Xi=null,Gi=0,Zi=!1,Ki=null}function ze(e){for(;;){var t=e.alternate,i=e.return,n=e.sibling;if(0==(512&e.effectTag)){var o=t;t=e;var r=t.pendingProps;switch(t.tag){case 0:case 1:break;case 2:g(t.type)&&y(t);break;case 3:g(t.type._reactResult)&&y(t);break;case 5:$(t),b(t),r=t.stateNode,r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==o&&null!==o.child||(me(t),t.effectTag&=-3),Ui(t);break;case 7:te(t);var a=Y(Ii.current),c=t.type;if(null!==o&&null!=t.stateNode)Di(o,t,c,r,a),o.ref!==t.ref&&(t.effectTag|=128);else if(r){if(o=Y(Ti.current),me(t))r=t,zt||s("175"),a=ui(r.stateNode,r.type,r.memoizedProps,a,o,r),r.updateQueue=a,(r=null!==a)&&xe(t);else{var u=xt(c,r,a,o,t);Oe(u,t),Mt(u,c,r,a,o)&&xe(t),t.stateNode=u}null!==t.ref&&(t.effectTag|=128)}else null===t.stateNode&&s("166");break;case 8:o&&null!=t.stateNode?Fi(o,t,o.memoizedProps,r):("string"!=typeof r&&(null===t.stateNode&&s("166")),a=Y(Ii.current),c=Y(Ti.current),me(t)?(r=t,zt||s("176"),(r=li(r.stateNode,r.memoizedProps,r))&&xe(t)):t.stateNode=Rt(r,a,c,t));break;case 13:case 14:case 16:case 9:case 10:case 15:break;case 6:$(t),Ui(t);break;case 12:X(t);break;case 11:break;case 4:s("167");default:s("156")}if(t=Ki=null,r=e,1073741823===Gi||1073741823!==r.childExpirationTime){for(a=0,c=r.child;null!==c;)o=c.expirationTime,u=c.childExpirationTime,(0===a||0!==o&&o<a)&&(a=o),(0===a||0!==u&&u<a)&&(a=u),c=c.sibling;r.childExpirationTime=a}if(null!==t)return t;null!==i&&0==(512&i.effectTag)&&(null===i.firstEffect&&(i.firstEffect=e.firstEffect),null!==e.lastEffect&&(null!==i.lastEffect&&(i.lastEffect.nextEffect=e.firstEffect),i.lastEffect=e.lastEffect),1<e.effectTag&&(null!==i.lastEffect?i.lastEffect.nextEffect=e:i.firstEffect=e,i.lastEffect=e))}else{if(null!==(e=Fe(e,Gi)))return e.effectTag&=511,e;null!==i&&(i.firstEffect=i.lastEffect=null,i.effectTag|=512)}if(null!==n)return n;if(null===i)break;e=i}return null}function We(e){var t=Ie(e.alternate,e,Gi);return null===t&&(t=ze(e)),zi.current=null,t}function Qe(e,t,i){Hi&&s("243"),Hi=!0,zi.currentDispatcher=ji;var n=e.nextExpirationTimeToWorkOn;n===Gi&&e===Xi&&null!==Ki||(je(),Xi=e,Gi=n,Ki=I(Xi.current,null,Gi),e.pendingCommitExpirationTime=0);for(var o=!1;;){try{if(t)for(;null!==Ki&&!st();)Ki=We(Ki);else for(;null!==Ki;)Ki=We(Ki)}catch(e){if(null===Ki)o=!0,rt(e);else{null===Ki&&s("271");var r=Ki,a=r.return;if(null!==a){e:{var c=a,u=r,l=e;a=Gi,u.effectTag|=512,u.firstEffect=u.lastEffect=null,Zi=!0,l=H(l,u);do{switch(c.tag){case 5:c.effectTag|=1024,c.expirationTime=a,a=Ue(c,l,a),D(c,a);break e;case 2:case 3:u=l;var d=c.stateNode;if(0==(64&c.effectTag)&&null!==d&&"function"==typeof d.componentDidCatch&&(null===$i||!$i.has(d))){c.effectTag|=1024,c.expirationTime=a,a=De(c,u,a),D(c,a);break e}}c=c.return}while(null!==c)}Ki=ze(r);continue}o=!0,rt(e)}}break}if(Hi=!1,Pi=Ni=Ei=zi.currentDispatcher=null,o)Xi=null,e.finishedWork=null;else if(null!==Ki)e.finishedWork=null;else{if(t=e.current.alternate,null===t&&s("281"),Xi=null,Zi){if(o=e.latestPendingTime,r=e.latestSuspendedTime,a=e.latestPingedTime,0!==o&&o>n||0!==r&&r>n||0!==a&&a>n)return e.didError=!1,i=e.latestPingedTime,0!==i&&i<=n&&(e.latestPingedTime=0),i=e.earliestPendingTime,t=e.latestPendingTime,i===n?e.earliestPendingTime=t===n?e.latestPendingTime=0:t:t===n&&(e.latestPendingTime=i),i=e.earliestSuspendedTime,t=e.latestSuspendedTime,0===i?e.earliestSuspendedTime=e.latestSuspendedTime=n:i>n?e.earliestSuspendedTime=n:t<n&&(e.latestSuspendedTime=n),_(n,e),void(e.expirationTime=e.expirationTime);if(!e.didError&&!i)return e.didError=!0,e.nextExpirationTimeToWorkOn=n,void(e.expirationTime=1)}e.pendingCommitExpirationTime=n,e.finishedWork=t}}function He(e,t){var i;e:{for(Hi&&!Ji&&s("263"),i=e.return;null!==i;){switch(i.tag){case 2:case 3:var n=i.stateNode;if("function"==typeof i.type.getDerivedStateFromCatch||"function"==typeof n.componentDidCatch&&(null===$i||!$i.has(n))){e=H(t,e),e=De(i,e,1),U(i,e),Xe(i,1),i=void 0;break e}break;case 5:e=H(t,e),e=Ue(i,e,1),U(i,e),Xe(i,1),i=void 0;break e}i=i.return}5===e.tag&&(i=H(t,e),i=Ue(e,i,1),U(e,i),Xe(e,1)),i=void 0}return i}function Ke(e,t){return 0!==Qi?e=Qi:Hi?e=Ji?1:Gi:1&t.mode?(e=mn?2+10*(1+((e-2+15)/10|0)):2+25*(1+((e-2+500)/25|0)),null!==Xi&&e===Gi&&(e+=1)):e=1,mn&&(0===cn||e>cn)&&(cn=e),e}function Xe(e,t){e:{(0===e.expirationTime||e.expirationTime>t)&&(e.expirationTime=t);var i=e.alternate;null!==i&&(0===i.expirationTime||i.expirationTime>t)&&(i.expirationTime=t);var n=e.return;if(null===n&&5===e.tag)e=e.stateNode;else{for(;null!==n;){if(i=n.alternate,(0===n.childExpirationTime||n.childExpirationTime>t)&&(n.childExpirationTime=t),null!==i&&(0===i.childExpirationTime||i.childExpirationTime>t)&&(i.childExpirationTime=t),null===n.return&&5===n.tag){e=n.stateNode;break e}n=n.return}e=null}}null!==e&&(!Hi&&0!==Gi&&t<Gi&&je(),B(e,t),Hi&&!Ji&&Xi===e||$e(e,e.expirationTime),wn>kn&&(wn=0,s("185")))}function Ge(e,t,i,n,o){var s=Qi;Qi=1;try{return e(t,i,n,o)}finally{Qi=s}}function Ze(){yn=2+((Ut()-gn)/10|0)}function Ye(e,t){if(0!==nn){if(t>nn)return;null!==on&&Vt(on)}nn=t,e=Ut()-gn,on=Lt(tt,{timeout:10*(t-2)-e})}function Je(){return sn?bn:(et(),0!==an&&1073741823!==an||(Ze(),bn=yn),bn)}function $e(e,t){if(null===e.nextScheduledRoot)e.expirationTime=t,null===tn?(en=tn=e,e.nextScheduledRoot=e):(tn=tn.nextScheduledRoot=e,tn.nextScheduledRoot=en);else{var i=e.expirationTime;(0===i||t<i)&&(e.expirationTime=t)}sn||(hn?fn&&(rn=e,an=1,nt(e,1,!0)):1===t?it(1,null):Ye(e,t))}function et(){var e=0,t=null;if(null!==tn)for(var i=tn,n=en;null!==n;){var o=n.expirationTime;if(0===o){if((null===i||null===tn)&&s("244"),n===n.nextScheduledRoot){en=tn=n.nextScheduledRoot=null;break}if(n===en)en=o=n.nextScheduledRoot,tn.nextScheduledRoot=o,n.nextScheduledRoot=null;else{if(n===tn){tn=i,tn.nextScheduledRoot=en,n.nextScheduledRoot=null;break}i.nextScheduledRoot=n.nextScheduledRoot,n.nextScheduledRoot=null}n=i.nextScheduledRoot}else{if((0===e||o<e)&&(e=o,t=n),n===tn)break;if(1===e)break;i=n,n=n.nextScheduledRoot}}rn=t,an=e}function tt(e){if(e.didTimeout&&null!==en){Ze();var t=en;do{var i=t.expirationTime;0!==i&&yn>=i&&(t.nextExpirationTimeToWorkOn=yn),t=t.nextScheduledRoot}while(t!==en)}it(0,e)}function it(e,t){if(pn=t,et(),null!==pn)for(Ze(),bn=yn;null!==rn&&0!==an&&(0===e||e>=an)&&(!un||yn>=an);)nt(rn,an,yn>=an),et(),Ze(),bn=yn;else for(;null!==rn&&0!==an&&(0===e||e>=an);)nt(rn,an,!0),et();if(null!==pn&&(nn=0,on=null),0!==an&&Ye(rn,an),pn=null,un=!1,wn=0,En=null,null!==vn)for(e=vn,vn=null,t=0;t<e.length;t++){var i=e[t];try{i._onComplete()}catch(e){ln||(ln=!0,dn=e)}}if(ln)throw e=dn,dn=null,ln=!1,e}function nt(e,t,i){if(sn&&s("245"),sn=!0,null===pn||i){var n=e.finishedWork;null!==n?ot(e,n,t):(e.finishedWork=null,Qe(e,!1,i),null!==(n=e.finishedWork)&&ot(e,n,t))}else n=e.finishedWork,null!==n?ot(e,n,t):(e.finishedWork=null,Qe(e,!0,i),null!==(n=e.finishedWork)&&(st()?e.finishedWork=n:ot(e,n,t)));sn=!1}function ot(e,t,i){var n=e.firstBatch;if(null!==n&&n._expirationTime<=i&&(null===vn?vn=[n]:vn.push(n),n._defer))return e.finishedWork=t,void(e.expirationTime=0);e.finishedWork=null,e===En?wn++:(En=e,wn=0),Ji=Hi=!0,e.current===t&&s("177"),i=e.pendingCommitExpirationTime,0===i&&s("261"),e.pendingCommitExpirationTime=0,n=t.expirationTime;var o=t.childExpirationTime;for(n=0===n||0!==o&&o<n?o:n,e.didError=!1,0===n?(e.earliestPendingTime=0,e.latestPendingTime=0,e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0):(o=e.latestPendingTime,0!==o&&(o<n?e.earliestPendingTime=e.latestPendingTime=0:e.earliestPendingTime<n&&(e.earliestPendingTime=e.latestPendingTime)),o=e.earliestSuspendedTime,0===o?B(e,n):n>e.latestSuspendedTime?(e.earliestSuspendedTime=0,e.latestSuspendedTime=0,e.latestPingedTime=0,B(e,n)):n<o&&B(e,n)),_(0,e),zi.current=null,1<t.effectTag?null!==t.lastEffect?(t.lastEffect.nextEffect=t,n=t.firstEffect):n=t:n=t.firstEffect,At(e.containerInfo),Yi=n;null!==Yi;){o=!1;var r=void 0;try{for(;null!==Yi;){if(256&Yi.effectTag){var a=Yi.alternate;e:{var c=Yi;switch(c.tag){case 2:case 3:if(256&c.effectTag&&null!==a){var u=a.memoizedProps,l=a.memoizedState,d=c.stateNode;d.props=c.memoizedProps,d.state=c.memoizedState;var p=d.getSnapshotBeforeUpdate(u,l);d.__reactInternalSnapshotBeforeUpdate=p}break e;case 5:case 7:case 8:case 6:break e;default:s("163")}}}Yi=Yi.nextEffect}}catch(e){o=!0,r=e}o&&(null===Yi&&s("178"),He(Yi,r),null!==Yi&&(Yi=Yi.nextEffect))}for(Yi=n;null!==Yi;){a=!1,u=void 0;try{for(;null!==Yi;){var h=Yi.effectTag;if(16&h&&Ft&&$t(Yi.stateNode),128&h){var f=Yi.alternate;if(null!==f){var m=f.ref;null!==m&&("function"==typeof m?m(null):m.current=null)}}switch(14&h){case 2:Le(Yi),Yi.effectTag&=-3;break;case 6:Le(Yi),Yi.effectTag&=-3,qe(Yi.alternate,Yi);break;case 4:qe(Yi.alternate,Yi);break;case 8:l=Yi,Ft?Ve(l):_e(l),l.return=null,l.child=null,l.alternate&&(l.alternate.child=null,l.alternate.return=null)}Yi=Yi.nextEffect}}catch(e){a=!0,u=e}a&&(null===Yi&&s("178"),He(Yi,u),null!==Yi&&(Yi=Yi.nextEffect))}for(It(e.containerInfo),e.current=t,Yi=n;null!==Yi;){h=!1,f=void 0;try{for(m=i;null!==Yi;){var v=Yi.effectTag;if(36&v){var g=Yi.alternate;switch(a=Yi,u=m,a.tag){case 2:case 3:var y=a.stateNode;if(4&a.effectTag)if(null===g)y.props=a.memoizedProps,y.state=a.memoizedState,y.componentDidMount();else{var b=g.memoizedProps,k=g.memoizedState;y.props=a.memoizedProps,y.state=a.memoizedState,y.componentDidUpdate(b,k,y.__reactInternalSnapshotBeforeUpdate)}var w=a.updateQueue;null!==w&&(y.props=a.memoizedProps,y.state=a.memoizedState,W(a,w,y,u));break;case 5:var E=a.updateQueue;if(null!==E){if(l=null,null!==a.child)switch(a.child.tag){case 7:l=Pt(a.child.stateNode);break;case 2:case 3:l=a.child.stateNode}W(a,E,l,u)}break;case 7:var N=a.stateNode;null===g&&4&a.effectTag&&Kt(N,a.type,a.memoizedProps,a);break;case 8:case 6:case 15:case 16:break;default:s("163")}}if(128&v){var P=Yi.ref;if(null!==P){var S=Yi.stateNode;switch(Yi.tag){case 7:var T=Pt(S);break;default:T=S}"function"==typeof P?P(T):P.current=T}}var A=Yi.nextEffect;Yi.nextEffect=null,Yi=A}}catch(e){h=!0,f=e}h&&(null===Yi&&s("178"),He(Yi,f),null!==Yi&&(Yi=Yi.nextEffect))}Hi=Ji=!1,"function"==typeof yi&&yi(t.stateNode),v=t.expirationTime,t=t.childExpirationTime,t=0===v||0!==t&&t<v?t:v,0===t&&($i=null),e.expirationTime=t,e.finishedWork=null}function st(){return!!un||!(null===pn||pn.timeRemaining()>Nn)&&(un=!0)}function rt(e){null===rn&&s("246"),rn.expirationTime=0,ln||(ln=!0,dn=e)}function at(e){if(!e)return fi;e=e._reactInternalFiber;e:{(2!==c(e)||2!==e.tag&&3!==e.tag)&&s("170");var t=e;do{switch(t.tag){case 5:t=t.stateNode.context;break e;case 2:if(g(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}break;case 3:if(g(t.type._reactResult)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);s("171"),t=void 0}if(2===e.tag){var i=e.type;if(g(i))return w(e,i,t)}else if(3===e.tag&&(i=e.type._reactResult,g(i)))return w(e,i,t);return t}function ct(e,t,i,n,o){var s=t.current;return i=at(i),null===t.context?t.context=i:t.pendingContext=i,t=o,o=V(n),o.payload={element:e},t=void 0===t?null:t,null!==t&&(o.callback=t),U(s,o),Xe(s,n),n}var ut=i(2),lt=i(0),dt=lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,pt="function"==typeof Symbol&&Symbol.for,ht=pt?Symbol.for("react.element"):60103,ft=pt?Symbol.for("react.portal"):60106,mt=pt?Symbol.for("react.fragment"):60107,vt=pt?Symbol.for("react.strict_mode"):60108,gt=pt?Symbol.for("react.profiler"):60114,yt=pt?Symbol.for("react.provider"):60109,bt=pt?Symbol.for("react.context"):60110,kt=pt?Symbol.for("react.async_mode"):60111,wt=pt?Symbol.for("react.forward_ref"):60112,Et=pt?Symbol.for("react.placeholder"):60113,Nt="function"==typeof Symbol&&Symbol.iterator,Pt=n.getPublicInstance,St=n.getRootHostContext,Tt=n.getChildHostContext,At=n.prepareForCommit,It=n.resetAfterCommit,xt=n.createInstance,Ot=n.appendInitialChild,Mt=n.finalizeInitialChildren,Ct=n.prepareUpdate,Bt=n.shouldSetTextContent,_t=n.shouldDeprioritizeSubtree,Rt=n.createTextInstance,Lt=n.scheduleDeferredCallback,Vt=n.cancelDeferredCallback,qt=n.noTimeout,Ut=n.now,Dt=n.isPrimaryRenderer,Ft=n.supportsMutation,jt=n.supportsPersistence,zt=n.supportsHydration,Wt=n.appendChild,Qt=n.appendChildToContainer,Ht=n.commitTextUpdate,Kt=n.commitMount,Xt=n.commitUpdate,Gt=n.insertBefore,Zt=n.insertInContainerBefore,Yt=n.removeChild,Jt=n.removeChildFromContainer,$t=n.resetTextContent,ei=n.cloneInstance,ti=n.createContainerChildSet,ii=n.appendChildToContainerChildSet,ni=n.finalizeContainerChildren,oi=n.replaceContainerChildren,si=n.canHydrateInstance,ri=n.canHydrateTextInstance,ai=n.getNextHydratableSibling,ci=n.getFirstHydratableChild,ui=n.hydrateInstance,li=n.hydrateTextInstance,di=/^(.*)[\\\/]/;new Set;var pi=[],hi=-1,fi={},mi={current:fi},vi={current:!1},gi=fi,yi=null,bi=null,ki=!1,wi={current:null},Ei=null,Ni=null,Pi=null,Si={},Ti={current:Si},Ai={current:Si},Ii={current:Si},xi=Object.prototype.hasOwnProperty,Oi=(new lt.Component).refs,Mi={isMounted:function(e){return!!(e=e._reactInternalFiber)&&2===c(e)},enqueueSetState:function(e,t,i){e=e._reactInternalFiber;var n=Je();n=Ke(n,e);var o=V(n);o.payload=t,void 0!==i&&null!==i&&(o.callback=i),U(e,o),Xe(e,n)},enqueueReplaceState:function(e,t,i){e=e._reactInternalFiber;var n=Je();n=Ke(n,e);var o=V(n);o.tag=1,o.payload=t,void 0!==i&&null!==i&&(o.callback=i),U(e,o),Xe(e,n)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var i=Je();i=Ke(i,e);var n=V(i);n.tag=2,void 0!==t&&null!==t&&(n.callback=t),U(e,n),Xe(e,i)}},Ci=Array.isArray,Bi=le(!0),_i=le(!1),Ri=null,Li=null,Vi=!1,qi=dt.ReactCurrentOwner,Ui=void 0,Di=void 0,Fi=void 0;Ft?(Ui=function(){},Di=function(e,t,i,n,o){if((e=e.memoizedProps)!==n){var s=t.stateNode,r=Y(Ti.current);i=Ct(s,i,e,n,o,r),(t.updateQueue=i)&&xe(t)}},Fi=function(e,t,i,n){i!==n&&xe(t)}):jt?(Ui=function(e){var t=e.stateNode;if(null!==e.firstEffect){var i=t.containerInfo,n=ti(i);e:for(var o=e.child;null!==o;){if(7===o.tag||8===o.tag)ii(n,o.stateNode);else if(6!==o.tag&&null!==o.child){o.child.return=o,o=o.child;continue}if(o===e)break e;for(;null===o.sibling;){if(null===o.return||o.return===e)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}t.pendingChildren=n,xe(e),ni(i,n)}},Di=function(e,t,i,n,o){var s=e.stateNode,r=e.memoizedProps;if((e=null===t.firstEffect)&&r===n)t.stateNode=s;else{var a=t.stateNode,c=Y(Ti.current),u=null;r!==n&&(u=Ct(a,i,r,n,o,c)),e&&null===u?t.stateNode=s:(s=ei(s,u,i,r,n,t,e,a),Mt(s,i,n,o,c)&&xe(t),t.stateNode=s,e?xe(t):Oe(s,t))}},Fi=function(e,t,i,n){i!==n&&(e=Y(Ii.current),i=Y(Ti.current),t.stateNode=Rt(n,e,i,t),xe(t))}):(Ui=function(){},Di=function(){},Fi=function(){});var ji={readContext:Z},zi=dt.ReactCurrentOwner,Wi=0,Qi=0,Hi=!1,Ki=null,Xi=null,Gi=0,Zi=!1,Yi=null,Ji=!1,$i=null,en=null,tn=null,nn=0,on=void 0,sn=!1,rn=null,an=0,cn=0,un=!1,ln=!1,dn=null,pn=null,hn=!1,fn=!1,mn=!1,vn=null,gn=Ut(),yn=2+(gn/10|0),bn=yn,kn=50,wn=0,En=null,Nn=1,Pn={updateContainerAtExpirationTime:ct,createContainer:function(e,t,i){return t=new T(5,null,null,t?3:0),e={current:t,containerInfo:e,pendingChildren:null,earliestPendingTime:0,latestPendingTime:0,earliestSuspendedTime:0,latestSuspendedTime:0,latestPingedTime:0,didError:!1,pendingCommitExpirationTime:0,finishedWork:null,timeoutHandle:qt,context:null,pendingContext:null,hydrate:i,nextExpirationTimeToWorkOn:0,expirationTime:0,firstBatch:null,nextScheduledRoot:null},t.stateNode=e},updateContainer:function(e,t,i,n){var o=t.current;return o=Ke(Je(),o),ct(e,t,i,o,n)},flushRoot:function(e,t){sn&&s("253"),rn=e,an=t,nt(e,t,!0),it(1,null)},requestWork:$e,computeUniqueAsyncExpiration:function(){var e=2+25*(1+((Je()-2+500)/25|0));return e<=Wi&&(e=Wi+1),Wi=e},batchedUpdates:function(e,t){var i=hn;hn=!0;try{return e(t)}finally{(hn=i)||sn||it(1,null)}},unbatchedUpdates:function(e,t){if(hn&&!fn){fn=!0;try{return e(t)}finally{fn=!1}}return e(t)},deferredUpdates:function(e){var t=Je(),i=Qi,n=mn;Qi=2+25*(1+((t-2+500)/25|0)),mn=!1;try{return e()}finally{Qi=i,mn=n}},syncUpdates:Ge,interactiveUpdates:function(e,t,i){if(mn)return e(t,i);hn||sn||0===cn||(it(cn,null),cn=0);var n=mn,o=hn;hn=mn=!0;try{return e(t,i)}finally{mn=n,(hn=o)||sn||it(1,null)}},flushInteractiveUpdates:function(){sn||0===cn||(it(cn,null),cn=0)},flushControlled:function(e){var t=hn;hn=!0;try{Ge(e)}finally{(hn=t)||sn||it(1,null)}},flushSync:function(e,t){sn&&s("187");var i=hn;hn=!0;try{return Ge(e,t)}finally{hn=i,it(1,null)}},getPublicRootInstance:function(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 7:return Pt(e.child.stateNode);default:return e.child.stateNode}},findHostInstance:function(e){var t=e._reactInternalFiber;return void 0===t&&("function"==typeof e.render?s("188"):s("268",Object.keys(e))),e=d(t),null===e?null:e.stateNode},findHostInstanceWithNoPortals:function(e){return e=p(e),null===e?null:e.stateNode},injectIntoDevTools:function(e){var t=e.findFiberByHostInstance;return S(ut({},e,{findHostInstanceByFiber:function(e){return e=d(e),null===e?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null}}))}};e.exports=Pn.default||Pn;var Sn=e.exports;return e.exports=t,Sn}},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=e.ticks,i=e.number,n=e.duration,o=e.velocity;e.panning;return{type:"notes",notes:[c.createMidiEvent(t,SongModule.NOTE_ON,i||0,o||0),c.createMidiEvent(t+n,SongModule.NOTE_OFF,i||0,0)]}}function s(e){var t=e.base64;if(t){return{type:"midi",midi:u.bind(this,{base64:t})}}}function r(e,t){var i={Song:function(){return new l(t)},Note:function(){return o(t)},Midi:function(){return s(t)}};return i[e]?i[e]():console.error(e+" ins't a valid element type")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();t.createElement=r,i(10);var c=void 0,u=void 0;c=window.sequencer,u=window.sequencer.createMidiFile;var l=function(){function e(t){n(this,e),this.notes=[],this.midi=null,this.config={metronome:t.metronome||!0,bpm:t.bpm||60,bars:t.bars||4}}return a(e,[{key:"setMIDI",value:function(e){this.midi=e}},{key:"addSequence",value:function(e){this.notes=this.notes.concat(e)}},{key:"render",value:function(){var e=this.notes,t=this.midi,i=this.config,n=i.metronome,o=i.bpm,s=i.bars;if(t)return t().then(function(e){var t=c.createSong(e),i=new CustomEvent("songCreated",{bubbles:!0,detail:t});window.document.body.dispatchEvent(i),t.play()},function(e){console.warn(e)});var r=c.createSong({bars:s,bpm:o,events:e,useMetronome:n});window.reactSong=r;var a=new CustomEvent("songCreated",{bubbles:!0,detail:r});window.document.body.dispatchEvent(a),r.play()}}]),e}()},function(e,t,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e,t,i,n,o,s,r,a=window.alert,c=(window.console,[]),u=!1,l=0,d=["threshold","knee","ratio","reduction","attack","release"],p=navigator.userAgent;if(p.match(/(iPad|iPhone|iPod)/g)?s="ios":-1!==p.indexOf("Android")?s="android":-1!==p.indexOf("Linux")?s="linux":-1!==p.indexOf("Macintosh")?s="osx":-1!==p.indexOf("Windows")&&(s="windows"),-1!==p.indexOf("Chrome")?(r="chrome",-1!==p.indexOf("OPR")?r="opera":-1!==p.indexOf("Chromium")&&(r="chromium")):-1!==p.indexOf("Safari")?r="safari":-1!==p.indexOf("Firefox")?r="firefox":-1!==p.indexOf("Trident")&&(r="Internet Explorer"),"ios"===s&&-1!==p.indexOf("CriOS")&&(r="chrome"),window.AudioContext)i=new window.AudioContext,void 0===i.createGainNode&&(i.createGainNode=i.createGain);else if(window.webkitAudioContext)i=new window.webkitAudioContext;else if(window.oAudioContext)i=new window.oAudioContext;else{if(!window.msAudioContext)return window.sequencer={browser:r,os:s},a("The WebAudio API hasn't been implemented in "+r+", please use any other browser"),void(window.sequencer.ready=function(e){e()});i=new window.msAudioContext}t=i.createBufferSource(),t.start,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame,window.Blob=window.Blob||window.webkitBlob||window.mozBlob,o=i.createDynamicsCompressor(),o.connect(i.destination),n=i.createGainNode(),n.connect(i.destination),n.gain.value=1,e={context:i,masterGainNode:n,masterCompressor:o,useDelta:!1,timedTasks:{},scheduledTasks:{},repetitiveTasks:{},getSampleId:function(){return"S"+l+++(new Date).getTime()},addInitMethod:function(e){c.push(e)},callInitMethods:function(){var e,t=c.length;for(e=0;e<t;e++)c[e]()}},window.sequencer={name:"qambi",protectedScope:e,ui:{},ua:p,os:s,browser:r,legacy:!1,midi:!1,webmidi:!1,webaudio:!0,jazz:!1,ogg:!1,mp3:!1,record_audio:void 0!==navigator.getUserMedia,bitrate_mp3_encoding:128,util:{},debug:4,defaultInstrument:"sinewave",pitch:440,bufferTime:.35,autoAdjustBufferTime:!1,noteNameMode:"sharp",minimalSongLength:6e4,pauseOnBlur:!1,restartOnFocus:!0,defaultPPQ:960,overrulePPQ:!0,precision:3,midiInputs:{},midiOutputs:{},storage:{midi:{id:"midi"},audio:{id:"audio",recordings:{}},instruments:{id:"instruments"},samplepacks:{id:"samplepacks"},assetpacks:{id:"assetpacks"}},getAudioContext:function(){return i},getTime:function(){return i.currentTime},setMasterVolume:function(e){e=e<0?0:e>1?1:e,n.gain.value=e},getMasterVolume:function(){return n.gain.value},getCompressionReduction:function(){return o.reduction.value},enableMasterCompressor:function(e){e?(n.disconnect(0),n.connect(o),o.disconnect(0),o.connect(i.destination)):(o.disconnect(0),n.disconnect(0),n.connect(i.destination))},configureMasterCompressor:function(e){var t,i;for(t=d.length;t>=0;t--)i=d[t],void 0!==e[i]&&(o[i].value=e[i])},unlockWebAudio:function(){if(!0!==u){"function"==typeof i.resume&&i.resume();var e=i.createOscillator(),t=i.createGainNode();t.gain.value=0,e.connect(t),t.connect(i.destination),void 0!==e.noteOn&&(e.start=e.noteOn,e.stop=e.noteOff),e.start(0),e.stop(.001),u=!0}}},Object.defineProperty(sequencer,"ERROR",{value:1}),Object.defineProperty(sequencer,"WARN",{value:2}),Object.defineProperty(sequencer,"INFO",{value:3}),Object.defineProperty(sequencer,"LOG",{value:4})}(),function(){function e(t,i){function n(n){for(v[o.id]=!0,c=y.length-1;c>=0;c--)if(!1!==(l=y[c])&&void 0!==(d=l.taskIds)){for(p=!0,u=d.length-1;u>=0;u--)!0!==v[d[u]]&&(p=!1);if(p){var s=l.method;y[c]=!1,setTimeout(function(){s(n)},0)}}t++,e(t,i)}var o,r,a,c,u,l,d,p;if(t===g.length){for(c=y.length-1;c>=0;c--)if(!1!==(l=y[c])){var b=l.method;setTimeout(function(){b()},0)}return v={},g=[],y=[],m=0,f=!1,void(i&&(h.log("onTaskQueueDone"),i()))}o=g[t],a=o.scope||null,r=o.params||[],"array"!==s(r)&&(r=[r]),r.push(n),o.method.apply(a,r)}var t,i,n,o,s,r,a,c,u,l,d,p=window.sequencer,h=window.console,f=!1,m=0,v={},g=[],y=[];p.removeMidiFile=function(e){var t,n,s,r=[];for("MidiFile"===e.className?(t=e,e=t.localPath):t=i(e,u.midi),"MidiFile"===t.className?r.push(t):(s=t,c(s,function(e){"MidiFile"===e.className&&r.push(e)})),n=r.length-1;n>=0;n--)t=r[n],o(t.localPath,u.midi)},p.removeInstrument=function(e,t){var n,s,r,a,d,p=[];if("InstrumentConfig"===e.className?(n=e,e=n.localPath):n=i(e,u.instruments),"InstrumentConfig"===n.className)p.push(n);else{r=n;for(s in r)r.hasOwnProperty(s)&&(n=r[s],"InstrumentConfig"===n.className&&p.push(n))}for(s=p.length-1;s>=0;s--)n=p[s],a=n.mapping,d=n.sample_path,!0===t&&(c(a,function(e){o(d+"/"+e.n,u.audio)}),o(d,u.samplepacks)),o(n.localPath,u.instruments);l()},p.removeSamplePack=function(e){var t,n,s,r,a,d,p=[];for("SamplePack"===e.className?(t=e,e=t.localPath):t=i(e,u.samplepacks),"SamplePack"===t.className?p.push(t):(d=t,c(d,function(e){"SamplePack"===e.className&&p.push(e)})),n=p.length-1;n>=0;n--){for(t=p[n],s=t.samples,a=s.length-1;a>=0;a--)r=s[a],o(r.folder+"/"+r.id,u.audio);t.reset(),o(t.localPath,u.samplepacks)}l()},p.removeAssetPack=function(e){var t,n;"AssetPack"===e.className?(t=e,e=t.localPath):t=i(e,u.assetpacks),"AssetPack"===t.className?t.unload():(n=t,c(n,function(e){"AssetPack"===e.className&&e.unload()}))},p.startTaskQueue=function(t){!0!==f&&(f=!0,e(0,t))},p.addTask=function(e,t,i){return e.id="task"+m++,g.push(e),void 0!==t&&(!0===i?p.addCallbackAfterTask(t):p.addCallbackAfterTask(t,[e.id])),e.id},p.addCallbackAfterTask=function(e,t){y.push({method:e,taskIds:t})},p.getInstrument=function(e,t){return i(e,u.instruments,t)},p.getMidiFile=function(e,t){return i(e,u.midi,t)},p.getSamplePack=function(e,t){return i(e,u.samplepacks,t)},p.getSample=function(e,t){return i(e,u.audio,t)},p.getAssetPack=function(e,t){return i(e,u.assetpacks,t)},p.getSamplePacks=function(e,t){return d(e,u.samplepacks,t)},p.getAssetPacks=function(e,t){return d(e,u.assetpacks,t)},p.getSamples=function(e,t){return d(e,u.audio,t)},p.getInstruments=function(e,t){return d(e,u.instruments,t)},p.getMidiFiles=function(e,t){return d(e,u.midi,t)},p.protectedScope.addInitMethod(function(){u=p.storage,t=p.protectedScope.loadLoop,i=p.protectedScope.findItem,n=p.protectedScope.storeItem,o=p.protectedScope.deleteItem,s=p.protectedScope.typeString,r=p.protectedScope.getArguments,a=p.protectedScope.isEmptyObject,c=p.protectedScope.objectForEach,l=p.protectedScope.updateInstruments,d=p.protectedScope.findItemsInFolder})}(),function(){function e(e,t){t(!1)}function t(e){var t=c(e.localPath,y.storage.assetpacks,!0),i=e.action;return t&&"AssetPack"===t.className&&"overwrite"!==i?(y.debug>=2&&b.warn("there is already an AssetPack at",e.localPath),!0):(u(e,e.localPath,y.storage.assetpacks),!1)}function i(t,i){void 0!==t.url?s({url:t.url,responseType:"json",onError:function(n){e(t,i)},onSuccess:function(e,o){if(null===e)return void i(!1);t.loaded=!0,void 0!==e.name&&void 0===t.name&&(t.name=e.name),void 0!==e.folder&&void 0===t.folder&&(t.folder=e.folder),void 0===t.name&&(t.name=a(t.url).name),t.localPath=void 0!==t.folder?t.folder+"/"+t.name:t.name,t.filesize=o,e.instruments&&(t.instruments=t.instruments.concat(e.instruments)),e.samplepacks&&(t.samplepacks=t.samplepacks.concat(e.samplepacks)),e.midifiles&&(t.midifiles=t.midifiles.concat(e.midifiles)),n(t,i)}}):(t.localPath=void 0!==t.folder?t.folder+"/"+t.name:t.name,n(t,i))}function n(e,i){var n,o,s,r=t(e),a=e.localPath;if(!0===r)return e=c(a,y.storage.assetpacks,!0),void i(e);if(void 0!==e.url){var u,l,d=y.storage.assetpacks,p=null;for(l in d)if(u=d[l],"AssetPack"===u.className&&u.id!==e.id&&u.url===e.url){p=u;break}if(null!==p)return a=e.localPath,f(a),e=null,e=c(p.localPath,y.storage.assetpacks,!0),void i(e)}for(o=e.midifiles,n=o.length-1;n>=0;n--)s=o[n],s.pack=e,y.addMidiFile(s);for(o=e.instruments,n=o.length-1;n>=0;n--)s=o[n],s.pack=e,y.addInstrument(s);for(o=e.samplepacks,n=o.length-1;n>=0;n--)s=o[n],s.pack=e,y.addSamplePack(s);i(e)}var o,s,r,a,c,u,l,d,p,h,f,m,v,g,y=window.sequencer,b=window.console,k=0;g=function(e){this.id="AP"+k+++(new Date).getTime(),this.name=this.id,this.className="AssetPack",this.loaded=!1,this.midifiles=e.midifiles||[],this.samplepacks=e.samplepacks||[],this.instruments=e.instruments||[],this.url=e.url;var t=this;p(e,function(e,i){t[i]=e})},g.prototype.unload=function(){var e,t,i;for(t=this.midifiles,e=t.length-1;e>=0;e--)i=t[e],h(i.folder+"/"+i.name);for(t=this.instruments,e=t.length-1;e>=0;e--)i=t[e],m(i.folder+"/"+i.name);for(t=this.samplepacks,e=t.length-1;e>=0;e--)i=t[e],v(i.folder+"/"+i.name);l(this.localPath,o.assetpacks)},y.addAssetPack=function(e,t){var n,o,s,r=d(e);if("object"!==r)return y.debug>=2&&b.warn("can't create an AssetPack with this data",e),!1;if(void 0===t&&(t=function(){}),e.json){if(n=e.json,o=e.name,s=e.folder,"string"===d(n))try{n=JSON.parse(n)}catch(t){return y.debug>=2&&b.warn("can't create an AssetPack with this data",e),!1}if(void 0===n.instruments&&void 0===n.midifiles&&void 0===n.samplepacks)return y.debug>=2&&b.warn("can't create an AssetPack with this data",e),!1;e={midifiles:n.midifiles,instruments:n.instruments,samplepacks:n.samplepacks,name:void 0===o?n.name:o,folder:void 0===s?n.folder:s}}y.addTask({type:"load asset pack",method:i,params:new g(e)},function(i){e=null,t(i)},!0),y.startTaskQueue()},y.protectedScope.addInitMethod(function(){s=y.protectedScope.ajax,r=y.protectedScope.round,a=y.protectedScope.parseUrl,c=y.protectedScope.findItem,u=y.protectedScope.storeItem,l=y.protectedScope.deleteItem,d=y.protectedScope.typeString,p=y.protectedScope.objectForEach,o=y.storage,h=y.removeMidiFile,m=y.removeInstrument,v=y.removeSamplePack,f=y.removeAssetPack})}(),function(){function e(e,i,n,s){if("mp3"===i){var r=t(e);n=n||h.bitrate_mp3_encoding,void 0===p&&(p=o(),p.onmessage=function(e){"data"===e.data.cmd&&s({blob:new Blob([new Uint8Array(e.data.buf)],{type:"audio/mp3"}),base64:u(e.data.buf),dataUrl:"data:audio/mp3;base64,"+c(e.data.buf)})}),p.postMessage({cmd:"init",config:{mode:3,channels:1,samplerate:l.sampleRate,bitrate:n}}),p.postMessage({cmd:"encode",buf:r}),p.postMessage({cmd:"finish"})}else"ogg"===i?(h.debug>=h.WARN&&f.warn("support for ogg is not yet implemented"),s(!1)):(h.debug>=h.WARN&&f.warn("unsupported type",i),s(!1))}function t(e){if(1===e.numberOfChannels)return e.getChannelData(0);if(2===e.numberOfChannels){var t,i=e.getChannelData(0),n=e.getChannelData(1),o=i.length,s=new Float32Array(o),r=0;for(t=0;t<o;t++)s[r++]=i[t],s[r++]=n[t];return s}}function i(){void 0!==p&&p.terminate(),void 0!==d&&d.terminate()}function n(){r("https://raw.githubusercontent.com/kobigurk/libmp3lame-js/master/dist/libmp3lame.min.js");var e,t;s.onmessage=function(i){switch(i.data.cmd){case"init":i.data.config||(i.data.config={}),e=a.init(),a.set_mode(e,i.data.config.mode||a.JOINT_STEREO),a.set_num_channels(e,i.data.config.channels||2),a.set_num_samples(e,i.data.config.samples||-1),a.set_in_samplerate(e,i.data.config.samplerate||44100),a.set_out_samplerate(e,i.data.config.samplerate||44100),a.set_bitrate(e,i.data.config.bitrate||128),a.init_params(e);break;case"encode":t=a.encode_buffer_ieee_float(e,i.data.buf,i.data.buf),s.postMessage({cmd:"data",buf:t.data});break;case"finish":t=a.encode_flush(e),s.postMessage({cmd:"end",buf:t.data}),a.close(e),e=null}}}function o(){var e=new Blob(["(",n.toString(),")()"],{type:"application/javascript"});return new Worker(URL.createObjectURL(e))}var s,r,a,c,u,l,d,p,h=window.sequencer,f=window.console;h.encodeAudio=e,h.protectedScope.cleanupAudioEncoder=i,h.protectedScope.addInitMethod(function(){c=h.util.encode64,u=h.util.base64EncArr,l=h.protectedScope.context})}(),function(){var e,t,i=window.console,n=window.sequencer,o=Array.prototype.slice;t=function(t){if(void 0!==t){if(void 0===t.ticks?this.ticks=0:this.ticks=t.ticks,this.buffer=t.buffer,this.sampleId=t.sampleId,this.path=t.path,void 0===this.buffer&&void 0===this.path)return void(n.debug>=n.WARN&&i.warn("please provide an AudioBuffer or a path to a sample in the sequencer.storage object"));if(void 0!==this.buffer&&"audiobuffer"!==e(this.buffer))return void(n.debug>=n.WARN&&i.warn("buffer has to be an AudioBuffer"));if(void 0!==this.path){if("string"!==e(this.path))return void(n.debug>=n.WARN&&i.warn("path has to be a String"));if(this.sampleId=this.path,this.sampleId=this.sampleId.replace(/^\//,""),this.sampleId=this.sampleId.replace(/\/$/,""),this.sampleId=this.sampleId.split("/"),this.sampleId=this.sampleId[this.sampleId.length-1],this.buffer=n.getSample(this.path),!1===this.buffer)return void(n.debug>=n.WARN&&i.warn("no sample found at",this.path));this.buffer=n.getSample(this.path)}this.durationTicks=t.durationTicks,this.durationMillis=t.durationMillis,void 0===this.durationTicks&&void 0===this.durationMillis&&(this.duration=this.buffer.duration,this.durationMillis=1e3*this.duration),this.muted=!1,void 0===t.velocity?this.velocity=127:this.velocity=t.velocity,this.sampleOffsetTicks=t.sampleOffsetTicks,this.sampleOffsetMillis=t.sampleOffsetMillis,void 0===this.sampleOffsetMillis&&void 0===this.sampleOffsetTicks?(this.sampleOffsetTicks=0,this.sampleOffsetMillis=0,this.sampleOffset=0):void 0!==this.sampleOffsetMillis&&(this.sampleOffset=this.sampleOffsetMillis/1e3),this.latencyCompensation=t.latencyCompensation,void 0===this.latencyCompensation&&(this.latencyCompensation=0),this.playheadOffset=0,this.className="AudioEvent",this.time=0,this.type="audio",this.id="A0"+(new Date).getTime()}},t.prototype.update=function(){var e;void 0===this.duration?(e=this.song.getPosition("ticks",this.ticks+this.durationTicks),this.durationMillis=e.millis-this.millis,this.duration=this.durationMillis/1e3):void 0===this.durationTicks&&(e=this.song.getPosition("millis",this.millis+this.durationMillis),this.durationTicks=e.ticks-this.ticks),void 0===this.sampleOffset?(e=this.song.getPosition("ticks",this.ticks+this.sampleOffsetTicks),this.sampleOffsetMillis=e.millis-this.millis,this.sampleOffset=this.sampleOffsetMillis/1e3):void 0===this.sampleOffsetTicks&&(e=this.song.getPosition("millis",this.millis+this.sampleOffsetMillis),this.sampleOffsetTicks=e.ticks-this.ticks),this.endTicks=this.ticks+this.durationTicks,this.endMillis=this.millis+this.durationMillis},t.prototype.stopSample=function(e){this.track.audio.stopSample(this,e)},t.prototype.setSampleOffset=function(e,t){"millis"===e?(this.sampleOffsetMillis=t,this.sampleOffset=t/1e3,this.durationTicks=void 0,void 0!==this.song&&this.update()):"ticks"===e?(this.sampleOffsetTicks=t,this.sampleOffset=void 0,this.sampleOffsetMillis=void 0,void 0!==this.song&&this.update()):n.debug>=n.WARN&&i.warn('you have to provide a type "ticks" or "millis" and a value')},t.prototype.setDuration=function(e,t){"millis"===e?(this.durationMillis=t,this.duration=t/1e3,this.durationTicks=void 0,void 0!==this.song&&this.update()):"ticks"===e?(this.durationTicks=t,this.duration=void 0,this.durationMillis=void 0,void 0!==this.song&&this.update()):n.debug>=n.WARN&&i.warn('you have to provide a type "ticks" or "millis" and a value')},t.prototype.clone=t.prototype.copy=function(){var e,i=new t;for(e in this)this.hasOwnProperty(e)&&("id"!==e&&"eventNumber"!==e&&(i[e]=this[e]),i.song=void 0,i.track=void 0,i.trackId=void 0,i.part=void 0,i.partId=void 0);return i},t.prototype.reset=function(e,t,i){e=void 0===e,t=void 0===t,i=void 0===i,e&&(this.part=void 0,this.partId=void 0),t&&(this.track=void 0,this.trackId=void 0,this.channel=0),i&&(this.song=void 0)},t.prototype.move=function(e){if(isNaN(e))return void(n.debug>=1&&i.error("please provide a number"));this.ticks+=parseInt(e,10),void 0!==this.song&&this.update(),"new"!==this.state&&(this.state="changed"),void 0!==this.part&&(this.part.needsUpdate=!0)},t.prototype.moveTo=function(){var e=o.call(arguments);"ticks"===e[0]&&!1===isNaN(e[1])?this.ticks=parseInt(e[1],10):void 0===this.song?n.debug>=1&&i.error("The audio event has not been added to a song yet; you can only move to ticks values"):(e=this.song.getPosition(e),!1===e?n.debug>=1&&i.error("wrong position data"):this.ticks=e.ticks),void 0!==this.song&&this.update(),"new"!==this.state&&(this.state="changed"),void 0!==this.part&&(this.part.needsUpdate=!0)},n.createAudioEvent=function(e){return"AudioEvent"===e.className?e.clone():new t(e)},n.protectedScope.addInitMethod(function(){e=n.protectedScope.typeString})}(),function(){function e(e){this.track=e,this.song=e.song,this.audioEvents={},this.callback=null,this.worker=r(),this.waveformConfig=e.waveformConfig||f;var i=this;this.worker.onmessage=function(e){t(i,e.data.wavArrayBuffer,e.data.interleavedSamples,e.data.id)}}function t(e,t,i,s){n.decodeAudioData(t,function(n){var r=o(t),c={id:e.recordId,audioBuffer:n,wavArrayBuffer:t,wav:{blob:new Blob([new Uint8Array(t)],{type:"audio/wav"}),base64:r,dataUrl:"data:audio/wav;base64,"+r},waveform:{}};c.interleavedSamples="new"===s?i:d.storage.audio.recordings[e.recordId].interleavedSamples,a(n,e.waveformConfig,function(t){c.waveform={dataUrls:t},d.storage.audio.recordings[e.recordId]=c,null!==e.callback&&(e.callback(c),e.callback=null)})},function(){d.debug>=d.WARN&&p.warn("no valid audiodata")})}function i(e){navigator.getUserMedia({audio:!0},function(t){h=!0,c=t,e()},function(t){d.debug>=d.WARN&&p.log(t),h=!1,e()})}var n,o,s,r,a,c,u,l,d=window.sequencer,p=window.console,h=null,f={height:200,width:800,sampleStep:1,color:"#71DE71",bgcolor:"#000"};e.prototype.prepare=function(e,t){var n=this;this.recordId=e,null===h?i(function(){t(h),void 0!==c&&n.start()}):(t(h),void 0!==c&&this.start())},e.prototype.start=function(){var e=this,t=this.track.song;e.worker.postMessage({command:"init",sampleRate:n.sampleRate}),this.scriptProcessor=n.createScriptProcessor(8192,1,1),this.scriptProcessor.onaudioprocess=function(i){1===i.inputBuffer.numberOfChannels?e.worker.postMessage({command:"record_mono",buffer:i.inputBuffer.getChannelData(0)}):e.worker.postMessage({command:"record_stereo",buffer:[i.inputBuffer.getChannelData(0),i.inputBuffer.getChannelData(1)]}),!1===t.recording&&!1===t.precounting&&e.createAudio()},this.sourceNode=n.createMediaStreamSource(c),this.sourceNode.connect(this.scriptProcessor),this.scriptProcessor.connect(n.destination)},e.prototype.stop=function(e){if(this.stopRecordingTimestamp=1e3*n.currentTime,this.timestamp=window.performance.now(),void 0===this.sourceNode)return void e();this.callback=e},e.prototype.createAudio=function(){this.sourceNode.disconnect(this.scriptProcessor),this.scriptProcessor.disconnect(n.destination),this.scriptProcessor.onaudioprocess=null,this.sourceNode=null,this.scriptProcessors=null;var e=parseInt((this.song.metronome.precountDurationInMillis+this.song.audioRecordingLatency)/u);this.worker.postMessage({command:"get_wavfile",bufferIndexStart:e,bufferIndexEnd:-1})},e.prototype.setAudioRecordingLatency=function(e,t,i){var n=parseInt(t/u);this.callback=i,this.worker.postMessage({command:"update_wavfile",samples:d.storage.audio.recordings[e].interleavedSamples,bufferIndexStart:n,bufferIndexEnd:-1})},e.prototype.cleanup=function(){if(void 0===c)return void this.worker.terminate();this.scriptProcessor.disconnect(),this.scriptProcessor.onaudioprocess=null,this.sourceNode.disconnect(),this.scriptProcessor=null,this.sourceNode=null,this.worker.terminate()},d.protectedScope.createAudioRecorder=function(t){return!1!==d.record_audio&&new e(t)},d.protectedScope.addInitMethod(function(){o=d.util.encode64,n=d.protectedScope.context,a=d.getWaveformData,r=d.protectedScope.createAudioRecorderWorker,u=1/n.sampleRate*1e3,s=d.protectedScope.songDispatchEvent,l=8192*u})}(),function(){function e(){function e(){var e,t,o,s=0;if(1===y?h=i(m,f):2===y&&(h=n(i(m,f),i(v,f))),d>0||l>0){for(-1===d&&(d=h.length),o=new Float32Array(d-l+1),t=l;t<d;t++)o[s++]=h[t];h=o}return e=a(h),e.buffer}function t(){var e,t,i,n=0;for(-1===d&&(d=h.length),i=new Float32Array(d-l+1),t=l;t<d;t++)i[n++]=h[t];return e=a(i),e.buffer}function i(e,t){for(var i=new Float32Array(t),n=0,o=0,s=e.length;o<s;o++)i.set(e[o],n),n+=e[o].length;return i}function n(e,t){for(var i=e.length+t.length,n=new Float32Array(i),o=0,s=0;o<i;)n[o++]=e[s],n[o++]=t[s],s++;return n}function o(e,t){for(var i=e.length,n=new Float32Array(2*i),o=0,s=0;o<i;)n[o++]=e[s++];for(o=0;o<i;)n[o++]=t[s++];return n}function s(e,t,i){for(var n=0;n<i.length;n++,t+=2){var o=Math.max(-1,Math.min(1,i[n]));e.setInt16(t,o<0?32768*o:32767*o,!0)}}function r(e,t,i){for(var n=0;n<i.length;n++)e.setUint8(t+n,i.charCodeAt(n))}function a(e){var t=new ArrayBuffer(44+2*e.length),i=new DataView(t);return r(i,0,"RIFF"),i.setUint32(4,36+2*e.length,!0),r(i,8,"WAVE"),r(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,y,!0),i.setUint32(24,g,!0),i.setUint32(28,g*y*2,!0),i.setUint16(32,2*y,!0),i.setUint16(34,16,!0),r(i,36,"data"),i.setUint32(40,2*e.length,!0),s(i,44,e),i}function c(){var e,t,s,r,c,u=0;if(1===y?r=i(m,f):2===y&&(r=i(m,f),c=i(v,f)),d>0||l>0)for(-1===d&&(d=r.length),s=new Float32Array(d-l+1),2===y&&new Float32Array(d-l+1),t=l;t<d;t++)s[u]=r[t],2===y&&c[t],u++;if(1===y)for(p=r,h=new Float32Array(f),t=0;t<f;t++)h[t]=p[t];else 2===y&&(p=o(r,c),h=n(r,c));return e=a(h),{planarSamples:p.buffer,interleavedSamples:h.buffer,wavArrayBuffer:e.buffer}}var u,l,d,p,h,f,m,v,g,y;self.onmessage=function(i){switch(i.data.command){case"init":g=i.data.sampleRate,f=0,m=[],v=[];break;case"record_mono":y=1,m.push(i.data.buffer),f+=i.data.buffer.length;break;case"record_stereo":y=2,m.push(i.data.buffer[0]),v.push(i.data.buffer[1]),f+=i.data.buffer[0].length;break;case"get_wavfile":l=i.data.bufferIndexStart,d=i.data.bufferIndexEnd,u={id:"new",wavArrayBuffer:e(),interleavedSamples:h},self.postMessage(u,[u.wavArrayBuffer,u.interleavedSamples.buffer]);break;case"get_wavfile2":l=i.data.bufferIndexStart,d=i.data.bufferIndexEnd,u=c(),u.id="new",self.postMessage(u,[u.planarSamples,u.interleavedSamples,u.wavArrayBuffer]);break;case"update_wavfile":l=i.data.bufferIndexStart,d=i.data.bufferIndexEnd,h=i.data.samples,u={id:"update",wavArrayBuffer:t()},self.postMessage(u,[u.wavArrayBuffer])}}}var t=window.sequencer;window.console;t.protectedScope.createAudioRecorderWorker=function(){var t=URL.createObjectURL(new Blob(["(",e.toString(),")()"],{type:"application/javascript"}));return new Worker(t)}}(),function(){var e,t,i,n,o=(window.console,window.sequencer);Array.prototype.slice;n=function(e){this.track=e,this.className="AudioTrack",this.scheduledSamples={},this.recorder=t(e)},i=function(e){delete this.scheduledSamples[e.id],e=null},n.prototype.setAudioRecordingLatency=function(e,t,i){this.recorder.setAudioRecordingLatency(e,t,i)},n.prototype.processEvent=function(e){var t=o.createSample({buffer:e.buffer,track:e.track});e.sample=t,e.offset=e.sampleOffset+e.playheadOffset,e.playheadOffset=0,t.start(e),this.scheduledSamples[t.id]=t},n.prototype.stopSample=function(e,t){void 0!==e.sample&&e.sample.stop(t,i.bind(this))},n.prototype.allNotesOff=function(){var e,t,n=this.scheduledSamples;for(e in n)n.hasOwnProperty(e)&&(t=n[e])&&t.unschedule(0,i.bind(this));this.scheduledSamples={}},n.prototype.prepareForRecording=function(e,t){if(!1===this.recorder)return!1;this.recorder.prepare(e,t)},n.prototype.stopRecording=function(e){this.recorder.stop(function(t){e(t)})},o.protectedScope.createAudioTrack=function(e){return new n(e)},o.protectedScope.addInitMethod(function(){e=o.protectedScope.typeString,t=o.protectedScope.createAudioRecorder})}(),function(){function e(e){this.id="FX"+p+++(new Date).getTime(),this.type=e.type,this.buffer=e.buffer,this.config=e,this.bypass=!1,this.amount=0,this.output=t.createGainNode(),this.wetGain=t.createGainNode(),this.dryGain=t.createGainNode(),this.output.gain.value=1,this.wetGain.gain.value=this.amount,this.dryGain.gain.value=1-this.amount}var t,i,n,o,s,r,a,c,u,l=window.sequencer,d=window.console,p=0;e.prototype.setInput=function(e){e.connect(this.dryGain),this.dryGain.connect(this.output),e.connect(this.node),this.node.connect(this.wetGain),this.wetGain.connect(this.output)},e.prototype.setAmount=function(e){this.amount=e<0?0:e>1?1:e,this.wetGain.gain.value=this.amount,this.dryGain.gain.value=1-this.amount},e.prototype.copy=function(){switch(this.type){case"reverb":return new o(this.config);case"panner":return new s(this.config);case"panner2":return new r(this.config);case"delay":return new a(this.config);case"compressor":return new u(this.config)}},l.createReverb=function(e){var t=n(e);return!1===t?(d.warn("no reverb with id",e,"loaded"),!1):new o({type:"reverb",buffer:t})},l.createPanner=function(e){return e=e||{},e.type="panner",new s(e)},l.createPanner2=function(e){return e=e||{},e.type="panner2",new r(e)},l.createDelay=function(e){return e=e||{},e.type="delay",new a(e)},l.createCompressor=function(e){return e=e||{},e.type="compressor",new u(e)},l.createBiQuadFilter=function(e){return e=e||{},e.type="biquadfilter",new c(e)},l.protectedScope.addInitMethod(function(){t=l.protectedScope.context,i=l.protectedScope.createClass,n=l.getSample,o=i(e,function(e){this.node=t.createConvolver(),this.node.buffer=e.buffer}),s=i(e,function(e){this.node=t.createPanner(),this.node.panningModel="equalpower",this.node.setPosition(1e-17,1e-17,1e-17)}),r=i(e,function(e){this.node=t.createPanner(),this.node.panningModel="HRTF",this.node.setPosition(1e-17,1e-17,1e-17)}),a=i(e,function(e){this.node=t.createDelay(),this.node.delayTime.value=.3}),u=i(e,function(e){this.node=t.createDynamicsCompressor()}),c=i(e,function(e){this.node=t.createBiquadFilter(),this.node.type=0,this.node.Q.value=4,this.node.frequency.value=1600}),s.prototype.setPosition=function(e){var t=e,i=0,n=1-Math.abs(t);t=0===t?1e-17:t,i=0===i?1e-17:i,n=0===n?1e-17:n,this.node.setPosition(t,i,n)},r.prototype.setPosition=function(e){var t,i,n,o=parseInt(e),s=o+90;s>90&&(s=180-s),t=Math.sin(o*(Math.PI/180)),i=0,n=Math.sin(s*(Math.PI/180)),t=0===t?1e-17:t,i=0===i?1e-17:i,n=0===n?1e-17:n,this.node.setPosition(t,i,n)},a.prototype.setTime=function(e){this.node.delayTime.value=e}})}(),function(){var e,t=sequencer.createNote,i=sequencer.findEvent,n=sequencer.protectedScope.round,o=sequencer.protectedScope.getEvents,s=sequencer.protectedScope.typeString,r="max min avg all",a="data1 data2 velocity noteNumber noteName frequency";e=function(){var e,c,u,l,d,p,h,f,m,v,g,y=Array.prototype.slice.call(arguments),b=y.length,k=128,w=-1,E=0,N=0,P=!1;if(u=o(y[0]),0===u.length)return-1;if(l=y[1],"string"!==s(l))return console.error("please provide a search string like for instance get('velocity max bar >= 1 < 8')"),-1;if(b>2&&console.warn("ignoring invalid arguments, please consult documentation"),l=l.split(" "),d=l.length,e=l[0],c=l[1],-1===a.indexOf(e))return console.error("you can't use 'min', 'max' or 'avg'","on the property",e),-1;if(-1===r.indexOf(c))return console.error(c,"is not a valid operator"),-1;for(d>2&&(6===d&&console.warn("ignoring cruft found in search string, please consult documentation"),l.shift(),l.shift(),u=i(u,l.join(" "))),"noteName"===e&&(e="noteNumber",P=!0),p=0,h=u.length;p<h;p++)f=u[p],m=f[e],m>w&&(w=m,g=f.noteName),m<k&&(k=m,v=f.noteName),void 0!==m&&(E+=m);return N=E/h,P&&(N=n(N),N=t(N).name,k=v,w=g),"max"===c?w:"min"===c?k:"avg"===c?N:"all"===c?{min:k,max:w,avg:N}:void 0},sequencer.getStats=e,sequencer.protectedScope.addInitMethod(function(){t=sequencer.createNote,i=sequencer.findEvent,n=sequencer.protectedScope.round,o=sequencer.protectedScope.getEvents,s=sequencer.protectedScope.typeString})}(),function(){var e,t,i,n,o,s,r,a,c,u,l,d,p,h,f,m,v,g,y={barsbeats:["bar","beat","sixteenth","tick"],time:["hour","minute","second","millisecond"]},b="OR AND NOT XOR",k=new RegExp(" "+b.replace(/\s+/g," | ")+" "),w={bar:1,beat:1,sixteenth:1,tick:1,ticks:1,barsbeats:1,musical_time:1,hour:1,minute:1,second:1,millisecond:1,millis:1,time:1,linear_time:1,id:1,type:1,data1:1,data2:1,velocity:1,noteNumber:1,frequency:1,noteName:1};r=function(){var e,i,n,r,a,u,d,p,h,f,y,b,w=Array.prototype.slice.call(arguments);if(h=c(w[0]),f=[],0===h.length)return console.warn("findEvent: no events"),f;if("string"!==t(w[1]))return console.error("please provide a search string like for instance findEvent('beat = 2 AND velocity > 60 < 100');"),f;for(n=w[1],r=n.split(" "),i=r.length,s=[],e=0;e<i;e++)a=r[e],k.test(" "+a+" ")&&s.push(a);for(r=n.split(k),i=r.length,o=[],e=0;e<i;e++)l(r[e].split(" "));for(i=o.length,d=0,p=-1,e=0;e<i;e++)u=o[d++],a=s[p++],"AND"===a?f=g(f,u):"NOT"===a?f=g(f,u,!0):"XOR"===a?(b=g(h,u),f=m(f,b)):(y=g(h,u),f=f.concat(y)),u,a;return v(f)},m=function(e,t){var i,n,o,s,r,a=e.length,c=t.length,u=[];for(i=0;i<a;i++){for(r=!0,o=e[i],s=o.id,n=0;n<c;n++)if(t[n].id===s){r=!1;break}r&&u.push(o)}for(n=0;n<c;n++){for(r=!0,o=t[n],s=o.id,i=0;i<a;i++)if(e[i].id===s){r=!1;break}r&&u.push(o)}return u},v=function(e){var t,i,n,o,s=e.length,r=[];for(e.sort(function(e,t){return e.eventNumber-t.eventNumber}),t=0;t<s;t++)i=e[t],n=i.id,n!==o&&r.push(i),o=n;return r},g=function(e,t,i){var n,o,s=[],r=t.property,a=t.operator1,c=t.operator2,u=t.value1,l=t.value2,d=e.length;for(i=i||!1,i&&(a=f(a),c=f(c)),o=0;o<d;o++)n=e[o],p(r,n[r],a,u,c,l)&&s.push(n);return s},p=function(e,i,o,s,r,a){var c=!1,u=!1;if(void 0===i)return c;switch(e){case"noteName":if("="===o)return 3===s.length&&4===i.length?c=0===i.indexOf(s):4===s.length&&5===i.length&&(c=0===i.indexOf(s)),c;break;case"type":"number"!==t(s)&&isNaN(s)&&(s=n(s))}switch("string"===t(i)?("string"!==t(s)&&(s="'"+s+"'"),a&&"string"!==t(a)&&(a="'"+a+"'"),u=!0):"number"===t(i)&&("number"!==t(s)&&(s=parseInt(s)),a&&"number"!==t(a)&&(a=parseInt(a))),o){case"=":case"==":case"===":c=i===s;break;case"*=":c=-1!==i.indexOf(s);break;case"^=":c=0===i.indexOf(s);break;case"$=":c=i.indexOf(s)===i.length-s.length;break;case"%=":c=!u&&i%s==0;break;case"!*=":c=!(-1!==i.indexOf(s));break;case"!^=":c=!(0===i.indexOf(s));break;case"!$=":c=!(i.indexOf(s)===i.length-s.length);break;case"!%=":c=!!u||!(i%s==0);break;case"!=":case"!==":c=u?-1===i.indexOf(s):i!==s;break;case">":c=r?h(i,o,s,r,a):i>s;break;case">=":c=r?h(i,o,s,r,a):i>=s;break;case"<":c=r?h(i,o,s,r,a):i<s;break;case"<=":c=r?h(i,o,s,r,a):i<=s;break;default:console.warn("eval is evil!")}return c},h=function(e,t,i,n,o){var s=!1;switch(t){case">":switch(n){case"<":s=e>i&&e<o;break;case"<=":s=e>i&&e<=o}break;case">=":switch(n){case"<":s=e>=i&&e<o;break;case"<=":s=e>=i&&e<=o}break;case"<":switch(n){case">":s=e<i||e>o;break;case">=":s=e<i||e>=o}break;case"<=":switch(n){case">":s=e<=i||e>o;break;case">=":s=e<=i||e>=o}}return s},c=function(e){var i=[];return"array"===t(e)?i=e:void 0===e.className?console.warn(e):"Track"===e.className||"Part"===e.className?i=e.events:"Song"===e.className&&(i=e.eventsMidiTime),i},l=function(e){var t,i={property:e[0],operator1:e[1],value1:e[2],operator2:e[3],value2:e[4]},n=e[0],r=e[1],a=e[2],c=e[3],l=e[4];if(1!==w[n])return console.error(n,"is not a supported property"),!1;if(i=d(i),"barsbeats"===n||"time"===n){for(a=u(a,n),t=0;t<4;t++)i={},i.property=y[n][t],i.operator1=r,i.value1=a[t],o.push(i),s.push("AND");if(s.pop(),l){for(l=u(l,n),t=0;t<4;t++)i={},i.property=y[n][t],i.operator2=c,i.value2=l[t],o.push(i),s.push("AND");s.pop()}}else o.push(i)},u=function(e,i){switch(e=e.replace(/(\[|\])/g,""),"array"!==t(e)&&("barsbeats"===i?e=-1===e.indexOf(",")?[e,1,1,0]:e.split(","):"time"===i&&(e=-1===e.indexOf(",")?[0,e,0,0]:e.split(","))),e.length){case 1:"barsbeats"===i?e.push(1,1,0):"time"===i&&e.push(0,0,0);break;case 2:"barsbeats"===i?e.push(1,0):"time"===i&&e.push(0,0);break;case 3:e.push(0)}return e},d=function(t){var i=t.operator1,n=t.operator2,o=function(e){return"<"===e||">"===e||"<="===e||">="===e},s=function(e){return"="===e||"=="===e||"==="===e};return"noteName"===t.property&&(o(i)||s(i))&&(t.property="noteNumber",t.value1=e(t.value1).number),"noteName"===t.property&&(o(n)||s(n))&&(t.property="noteNumber",t.value2=e(t.value2).number),o(i)&&!o(n)&&(delete t.operator2,delete t.value2),t},f=function(e){var t;switch(e){case"=":case"==":case"===":t="!==";break;case"!=":case"!==":t="===";break;case"<":t=">=";break;case">":t="<=";break;case"<=":t=">";break;case">=":t="<";break;case"*=":case"^=":case"&=":case"%=":t="!"+e;break;default:t=e}return t},a=function(){var e,t,n,o,s=r.apply(this,arguments),a=s.length,c={},u=[];for(e=0;e<a;e++)t=s[e],t.type===sequencer.NOTE_ON?(void 0===c[t.noteNumber]&&(c[t.noteNumber]=[]),c[t.noteNumber].push(t)):t.type===sequencer.NOTE_OFF&&(o=c[t.noteNumber],o&&(n=o.shift(),u.push(i(n,t))),0===o.length&&delete c[t.noteNumber]);return u.sort(function(e,t){return e.sortIndex-t.sortIndex}),u},sequencer.findEvent=r,sequencer.findNote=a,sequencer.protectedScope.getEvents=c,sequencer.protectedScope.addInitMethod(function(){e=sequencer.createNote,t=sequencer.protectedScope.typeString,i=sequencer.createMidiNote,n=sequencer.midiEventNumberByName})}(),function(){function e(e){null}function t(e,i,n,o){var s;for(i=0;i<n;i++)void 0!==(s=e[i])&&("MidiNote"===s.className?o.push(s.noteOn):"array"===u(s)&&t(s,0,s.length))}function i(e){return{getValue:function(e){return Math.sin(2*e*Math.PI)}}}var n,o,s,r,a,c,u,l,d,p,h,f,m,v,g,y,b,k,w,E=window.sequencer,N=window.console;E.debug;k=function(e){this.className="Instrument",this.config=e,this.scheduledEvents={},this.scheduledSamples={},this.sustainPedalDown=!1,this.sustainPedalSamples={},this.sampleDataByNoteNumber={},this.sampleData=[],this.info=e.info||e.instrument_info,this.author=e.author||e.instrument_author,this.license=e.license||e.instrument_license,this.pack=e.pack,this.parse()},k.prototype.reset=function(){var e=E.getInstrument(this.config.localPath);!1!==E.getSamplePack(this.config.sample_path)&&!1!==e||(this.scheduledEvents={},this.scheduledSamples={},this.sustainPedalSamples={},this.sampleDataByNoteNumber={},this.sampleData=[],this.update&&delete r[this.updateTaskId],!1===e&&this.track.setInstrument())},k.prototype.parse=function(){function e(e){var t,i;if(e.n)v=T[e.n];else for(g=[f,h,h.toLowerCase()],i=2;i>=0;i--)if(void 0!==(v=T[g[i]])){x[y]={n:g[i]};break}if(void 0===v)return E.debug&&N.log("no buffer found for "+y+" ("+O.name+")"),void(P=!1);P={noteNumber:f,buffer:v,bufferId:e.n,autopan:O.autopan},!0===A.sustain&&(P.sustain=!0,w=!0),void 0!==e.s?(P.sustain_start=e.s[0],P.sustain_end=e.s[1],P.sustain=!0,w=!0):!0===A.sustain&&(t=S.samplesById[e.n].sustain,void 0!==t?(P.sustain_start=t[0],P.sustain_end=t[1]):P.sustain=!1),void 0!==A.release_duration&&(P.release_duration=A.release_duration,P.release_envelope=A.release_envelope||O.releaseEnvelope,P.release=!0,w=!0),void 0!==e.r&&("array"===u(e.r)?(P.release_duration=e.r[0],P.release_envelope=e.r[1]||O.releaseEnvelope):isNaN(e.r)||(P.release_duration=e.r,P.release_envelope=O.releaseEnvelope),P.release=!0,w=!0),void 0!==e.p&&(P.panPosition=e.p,P.panning=!0)}var t,n,s,a,c,l,d,p,h,f,m,v,g,y,b,k,w,P,S,T,A=this.config,I=void 0===A.notename_mode?E.noteNameMode:A.notename_mode,x=A.mapping,O=this;if(void 0===A.name)return N.error("instruments must have a name",A),!1;if(void 0===x)return N.error("instruments must have a mapping to samples",A),!1;for(this.name=A.name,this.folder=A.folder||"",this.autopan=A.autopan||!1,this.singlePitch=A.single_pitch||!1,this.samplePath=A.sample_path||this.name,this.keyScalingRelease=A.keyscaling_release,this.keyScalingPanning=A.keyscaling_panning,this.keyRange=A.keyrange||A.key_range,m=this.samplePath.split("/"),S=o.samplepacks,t=0,n=m.length;t<n;t++){if(void 0===S)return void(E.debug&&N.log("sample pack not found",m.join("/")));S=S[m[t]]}T=o.audio;try{for(t=0,n=m.length;t<n;t++)T=T[m[t]]}catch(e){return void(E.debug&&N.log('sample pack "'+m[t]+'" is not loaded'))}if(void 0===T)return void(E.debug&&N.log("sample pack not found",m.join("/")));if("array"===u(x))for(this.keyRange=x,x={},t=this.keyRange[0];t<=this.keyRange[1];t++)x[t]="";void 0===this.keyRange?(this.lowestNote=128,this.highestNote=-1):(this.lowestNote=this.keyRange[0],this.highestNote=this.keyRange[1],this.numNotes=this.highestNote-this.lowestNote),void 0!==A.release_duration?this.releaseDuration=A.release_duration:this.releaseDuration=0,this.releaseEnvelope=A.release_envelope||"equal power",this.autopan&&(this.autoPanner=i()),this.samplepack=S;for(y in x)if(x.hasOwnProperty(y))if(b=x[y],isNaN(y)?(l=y.length,d=y.substring(l-1),p=y.substring(0,l-1),h=y,f=E.getNoteNumber(p,d)):(h=E.getNoteNameFromNoteNumber(y,I),h=h.join(""),f=y),f=parseInt(f,10),void 0===this.keyRange&&(this.lowestNote=f<this.lowestNote?f:this.lowestNote,this.highestNote=f>this.highestNote?f:this.highestNote),"array"===u(b))for(this.multiLayered=!0,t=0,n=b.length;t<n;t++){for(k=b[t],e(k),void 0===this.sampleDataByNoteNumber[f]&&(this.sampleDataByNoteNumber[f]=[]),a=k.v[0],c=k.v[1],s=a;s<=c;s++)this.sampleDataByNoteNumber[f][s]=P;this.sampleData.push(P)}else e(b),this.sampleDataByNoteNumber[f]=P,this.sampleData.push(P);if(void 0===this.keyRange&&(this.numNotes=this.highestNote-this.lowestNote,this.keyRange=[this.lowestNote,this.highestNote]),this.config.mapping=x,this.singlePitch)for(t=127;t>=0;t--)this.sampleData[t]=P,this.sampleDataByNoteNumber[t]=P;w&&(this.updateTaskId="update_"+this.name+"_"+(new Date).getTime(),r[this.updateTaskId]=function(){O.autopan?O.update(this.autoPanner.getValue()):O.update()})},k.prototype.getInfoAsHTML=function(){var e="",t="",i="",n=this.samplepack;return void 0!==this.info&&(t+="<tr><td>info</td><td>"+this.info+"</td></tr>"),void 0!==this.author&&(t+="<tr><td>author</td><td>"+this.author+"</td></tr>"),void 0!==this.license&&(t+="<tr><td>license</td><td>"+this.license+"</td></tr>"),t+="<tr><td>keyrange</td><td>"+this.lowestNote+"("+E.getFullNoteName(this.lowestNote)+")",t+=" - "+this.highestNote+"("+E.getFullNoteName(this.highestNote)+")</td></tr>",""!==t&&(t='<table><th colspan="2">instrument</th>'+t+"</table>",e+=t),void 0===n?e:(void 0!==n.info&&(i+="<tr><td>info</td><td>"+n.info+"</td></tr>"),void 0!==n.author&&(i+="<tr><td>author</td><td>"+n.author+"</td></tr>"),void 0!==n.license&&(i+="<tr><td>license</td><td>"+n.license+"</td></tr>"),void 0!==n.compression&&(i+="<tr><td>compression</td><td>"+n.compression+"</td></tr>"),void 0!==n.filesize&&(i+="<tr><td>filesize</td><td>"+g(n.filesize/1024/1024,2)+" MiB</td></tr>"),""!==i&&(i='<table><th colspan="2">samplepack</th>'+i+"</table>",e+=i),e)},k.prototype.getInfo=function(){var e={instrument:{},samplepack:{}};return void 0!==this.info&&(e.instrument.info=this.info),void 0!==this.author&&(e.instrument.author=this.author),void 0!==this.license&&(e.instrument.license=this.license),void 0!==this.keyrange&&(e.instrument.keyrange=this.keyrange),void 0!==this.info&&(e.samplepack.info=this.info),void 0!==this.author&&(e.samplepack.author=this.author),void 0!==this.license&&(e.samplepack.license=this.license),void 0!==this.compression&&(e.samplepack.compression=this.compression),void 0!==this.filesize&&(e.samplepack.filesize=g(this.samplepack.filesize/1024/1024,2)),e},k.prototype.createSample=function(e){var t=e.noteNumber,i=e.velocity,n=this.sampleDataByNoteNumber[t];return"array"===u(n)&&(n=n[i]),void 0===n||!1===n?{start:function(){N.warn("no audio data loaded for",t)},stop:function(){},update:function(){},addData:function(){},unschedule:function(){}}:(n.track=e.track,h(n))},k.prototype.setKeyScalingPanning=function(e,t){var i,n,o,s,r=this.sampleData.length;if(!1===e)for(i=0;i<r;i++)n=this.sampleData[i],n.panning=!1;if(!1===isNaN(e)&&!1===isNaN(t))for(o=(t-e)/this.numNotes,s=e,i=0;i<r;i++)n=this.sampleData[i],n.panning=!0,n.panPosition=s,s+=o},k.prototype.setRelease=function(e,t){if(void 0!==e){this.releaseEnvelope=t||this.releaseEnvelope,this.keyScalingRelease=void 0;var i,n,o=this.sampleData.length;for(i=0;i<o;i++)n=this.sampleData[i],n.release=!0,n.release_duration=e,n.release_envelope=this.releaseEnvelope;this.releaseDuration=e}},k.prototype.setKeyScalingRelease=function(e,t,i){var n,o,s,r,a=this.sampleData.length;if(this.releaseEnvelope=i||this.releaseEnvelope,!1===isNaN(e)&&!1===isNaN(t))for(this.keyScalingRelease=[e,t],this.releaseDuration=0,s=(t-e)/this.numNotes,r=e,n=0;n<a;n++)o=this.sampleData[n],o.release_duration=r,o.release_envelope=r,r+=s},k.prototype.transpose=function(e,t,i){function n(s,r){var a;i&&i("transposing sample "+(s+1)+" of "+o),s<o?(a=r[s],setTimeout(function(){b(a.buffer,e,function(e){a.buffer=e,n(++s,r)})},10)):t&&(N.log("ready"),t())}if(void 0===b)return void N.log("transpose is still experimental");var o=this.sampleData.length;n(0,this.sampleData)},k.prototype.processEvent=function(e){var t,i,n,o,s=e.type;void 0===e.time&&(e.time=0),128===s||144===s?128===s?(!0===this.sustainPedalDown&&(e.sustainPedalDown=!0),this.stopNote(e)):this.playNote(e):176===e.type&&(t=e.data1,i=e.data2,64===t?127===i?(this.sustainPedalDown=!0,m(this.track.song,"sustain_pedal","down")):0===i&&(this.sustainPedalDown=!1,m(this.track.song,"sustain_pedal","up"),this.stopSustain(e.time)):10===t?(n=this.track,n.setPanning(v(i,0,127,-1,1))):7===t&&(n=this.track,o=n.output,o.gain.setValueAtTime(i/127,e.time)))},k.prototype.stopSustain=function(e){var t,i=this.scheduledSamples,n=this.sustainPedalSamples;p(n,function(n){void 0!==n&&(t=n.midiNote,t.noteOn.sustainPedalDown=void 0,t.noteOff.sustainPedalDown=void 0,n.stop(e,function(e){i[e.sourceId]=null,delete i[e.sourceId]}))}),this.sustainPedalSamples={}},k.prototype.playNote=function(e){var t,i;if(!e.midiNote)return void(E.debug&&N.warn("playNote() no midi note"));i=e.midiNote.id,t=this.scheduledSamples[i],void 0!==t&&t.unschedule(0),t=this.createSample(e),t.addData({midiNote:e.midiNote,noteName:e.midiNote.note.fullName,sourceId:i}),this.scheduledSamples[i]=t,t.start(e)},k.prototype.stopNote=function(e){if(void 0===e.midiNote)return void(E.debug&&N.warn("stopNote() no midi note",e.ticks,e.noteNumber));var t=e.midiNote.id,i=this.scheduledSamples[t],n=this.scheduledSamples,o=this.sustainPedalSamples;if(!0===e.sustainPedalDown)return void(o[t]=i);void 0!==i&&i.stop(e.time,function(){n[t]=null,delete n[t]})},k.prototype.hasScheduledSamples=function(){return d(this.scheduledSamples)},k.prototype.reschedule=function(t){var i,n,o,s=t.millis,r=s+1e3*E.bufferTime,a=this.scheduledSamples;for(i in a)if(a.hasOwnProperty(i))if(o=a[i],void 0===(n=o.midiNote)||"removed"===n.state)o.unschedule(0,e),delete a[i];else{if(n.noteOn.millis>=s&&n.noteOff.millis<r&&o.noteName===n.fullName)continue;delete a[i],o.unschedule(null,e)}},k.prototype.unschedule=function(){var i,n,o,r,a=Array.prototype.slice.call(arguments),c=[];for(t(a,0,a.length,c),i=c.length-1;i>=0;i--)n=c[i],void 0!==n.midiNote?(o=n.midiNote.id,void 0!==(r=this.scheduledSamples[o])&&(r.unschedule(0,e),delete this.scheduledSamples[o])):"MidiEvent"===n.className&&(o=n.id,delete s["event_"+o],delete this.scheduledEvents[o])},k.prototype.allNotesOff=function(){var t,i,n=this.scheduledSamples;if(this.stopSustain(0),this.sustainPedalDown=!1,void 0!==n&&!0!==d(n)){for(i in n)n.hasOwnProperty(i)&&(t=n[i])&&t.unschedule(0,e);this.scheduledSamples={},p(this.scheduledEvents,function(e,t){delete s["event_"+t]}),this.scheduledEvents={}}},k.prototype.allNotesOffPart=function(t){var i,n,o=this.scheduledSamples;if(this.stopSustain(0),this.sustainPedalDown=!1,void 0!==o&&!0!==d(o)){for(n in o)o.hasOwnProperty(n)&&(i=o[n])&&i.unschedule(0,e);this.scheduledSamples={},p(this.scheduledEvents,function(e,t){delete s["event_"+t]}),this.scheduledEvents={}}},k.prototype.update=function(e){var t,i;for(t in this.scheduledSamples)this.scheduledSamples.hasOwnProperty(t)&&(i=this.scheduledSamples[t])&&i.update(e)},E.createInstrument=function(e){var t,i,n=u(e);return"object"===n?("Instrument"===e.className?i=e:"InstrumentConfig"===e.className&&(i="sinewave"===e.name?new w(e):new k(e)),i):("string"===n&&(t=a(e,o.instruments)),i="sinewave"===t.name?new w(t):new k(t))},E.protectedScope.addInitMethod(function(){var e=E.protectedScope;o=E.storage,h=E.createSample,f=E.createReverb,m=E.protectedScope.songDispatchEvent,n=e.context,s=e.timedTasks,r=e.repetitiveTasks,p=e.objectForEach,d=e.isEmptyObject,a=e.findItem,c=e.storeItem,u=e.typeString,l=e.pathToArray,b=e.transpose,w=e.createClass(k),v=E.util.remap,g=E.util.round,y=E.util.getEqualPowerCurve,w.prototype.parse=function(){var e=this,t=this.config;this.name="SineWave",this.waveForm=t.wave_form||"sine",this.autopan=t.autopan||!1,this.folder=t.folder||"heartbeat",this.releaseDuration=t.release_duration||1500,this.autopan&&(this.autoPanner=i()),r["update_"+this.name+"_"+(new Date).getTime()]=function(){e.autopan?e.update(Math.sin(2*n.currentTime*Math.PI)):e.update()}},w.prototype.createSample=function(e){var t={oscillator:!0,track:e.track,event:e,autopan:this.autopan,wave_form:this.waveForm,release_envelope:"equal power",release_duration:this.releaseDuration};return h(t)},E.createSimpleSynth=function(e){return e=e||{},new w(e)}})}(),function(){var e,t,i,n,o,s,r,a,c=window.sequencer,u=window.console;c.debug;a=function(e){this.className="Instrument",this.id="I0"+(new Date).getTime(),this.config=e,this.scheduledEvents={},this.scheduledSamples={},this.sustainPedalDown=!1,this.sustainPedalSamples={},this.sampleDataByNoteNumber={},this.sampleData=[],this.info=e.info||{},void 0!==this.info.samples&&void 0!==this.info.sample.filesize&&(this.info.samples.filesize=n(this.samplepack.filesize/1024/1024,2))},a.prototype.reset=function(){},a.prototype.parse=function(){function i(e){if(e.n&&(v=P.samples[e.n]),void 0===v)return c.debug&&u.log("no buffer found for "+g+" ("+P.name+")"),void(w=!1);w={noteNumber:m,buffer:v,autopan:P.autopan},!0===E.sustain&&(w.sustain=!0,k=!0),void 0!==e.s&&(w.sustain_start=e.s[0],w.sustain_end=e.s[1],w.sustain=!0,k=!0),void 0!==E.release_duration&&(w.release_duration=E.release_duration,w.release_envelope=E.release_envelope||P.releaseEnvelope,w.release=!0,k=!0),void 0!==e.r&&("array"===t(e.r)?(w.release_duration=e.r[0],w.release_envelope=e.r[1]||P.releaseEnvelope):isNaN(e.r)||(w.release_duration=e.r,w.release_envelope=P.releaseEnvelope),w.release=!0,k=!0),void 0!==e.p&&(w.panPosition=e.p,w.panning=!0)}var n,o,r,a,l,d,p,h,f,m,v,g,y,b,k,w,E=this.config,N=void 0===E.notename_mode?c.noteNameMode:E.notename_mode,P=this;if(this.name=E.name||this.id,this.autopan=E.autopan||!1,this.singlePitch=E.single_pitch||!1,this.keyScalingRelease=E.keyscaling_release,this.keyScalingPanning=E.keyscaling_panning,this.keyRange=E.keyrange||E.key_range,this.mapping=E.mapping,void 0===this.keyRange?(this.lowestNote=128,this.highestNote=-1):(this.lowestNote=this.keyRange[0],this.highestNote=this.keyRange[1],this.numNotes=this.highestNote-this.lowestNote),void 0!==E.release_duration?this.releaseDuration=E.release_duration:this.releaseDuration=0,this.releaseEnvelope=E.release_envelope||"equal power",this.autopan&&(this.autoPanner=s()),void 0===this.mapping){this.mapping={};for(g in this.samples)this.samples.hasOwnProperty(g)&&(this.mapping[g]={n:g})}for(g in this.mapping)if(this.mapping.hasOwnProperty(g))if(y=this.mapping[g],isNaN(g)?(d=g.length,p=g.substring(d-1),h=g.substring(0,d-1),f=g,m=c.getNoteNumber(h,p)):(f=c.getNoteNameFromNoteNumber(g,N),f=f.join(""),m=g),m=parseInt(m,10),void 0===this.keyRange&&(this.lowestNote=m<this.lowestNote?m:this.lowestNote,this.highestNote=m>this.highestNote?m:this.highestNote),"string"===t(y))v=this.samples[y];else if("array"===t(y))for(this.multiLayered=!0,n=0,o=y.length;n<o;n++){for(b=y[n],i(b),void 0===this.sampleDataByNoteNumber[m]&&(this.sampleDataByNoteNumber[m]=[]),a=b.v[0],l=b.v[1],r=a;r<=l;r++)this.sampleDataByNoteNumber[m][r]=w;this.sampleData.push(w)}else i(y),this.sampleDataByNoteNumber[m]=w,this.sampleData.push(w);if(void 0===this.keyRange&&(this.numNotes=this.highestNote-this.lowestNote,this.keyRange=[this.lowestNote,this.highestNote]),this.singlePitch)for(n=127;n>=0;n--)this.sampleData[n]=w,this.sampleDataByNoteNumber[n]=w;k&&(this.updateTaskId="update_"+this.name+"_"+(new Date).getTime(),e[this.updateTaskId]=function(){P.autopan?P.update(this.autoPanner.getValue()):P.update()})},a.prototype.getInfoAsHTML=function(){var e="",t="",i="",n={},o={};return void 0!==this.info&&(o=this.info.samples,n=this.info.instrument),void 0!==n.descriptiom&&(t+="<tr><td>info</td><td>"+n.description+"</td></tr>"),void 0!==n.author&&(t+="<tr><td>author</td><td>"+n.author+"</td></tr>"),void 0!==n.license&&(t+="<tr><td>license</td><td>"+n.license+"</td></tr>"),t+="<tr><td>keyrange</td><td>"+this.lowestNote+"("+c.getFullNoteName(this.lowestNote)+")",t+=" - "+this.highestNote+"("+c.getFullNoteName(this.highestNote)+")</td></tr>",""!==t&&(t='<table><th colspan="2">instrument</th>'+t+"</table>",e+=t),void 0!==o.description&&(i+="<tr><td>info</td><td>"+o.description+"</td></tr>"),void 0!==o.author&&(i+="<tr><td>author</td><td>"+o.author+"</td></tr>"),void 0!==o.license&&(i+="<tr><td>license</td><td>"+o.license+"</td></tr>"),void 0!==o.compression&&(i+="<tr><td>compression</td><td>"+o.compression+"</td></tr>"),void 0!==o.filesize&&(i+="<tr><td>filesize</td><td>"+o.filesize+" MiB</td></tr>"),""!==i&&(i='<table><th colspan="2">samplepack</th>'+i+"</table>",e+=i),e},a.prototype.createSample=function(e){var n=e.noteNumber,o=e.velocity,s=this.sampleDataByNoteNumber[n];return"array"===t(s)&&(s=s[o]),void 0===s||!1===s?{start:function(){u.warn("no audio data loaded for",n)},stop:function(){},update:function(){},addData:function(){},unschedule:function(){}}:(s.track=e.track,i(s))},c.createInstrument2=function(e){function t(t,i){var n;void 0===e.samples&&i("instruments must have samples",e),n="sinewave"===e.name?r(e):new a(e),o(e.samples).then(function(i){e.samples=null,n.samples=i,n.parse(),t(n)},function(e){i(e)})}return new Promise(t)},c.protectedScope.addInitMethod(function(){var s=c.protectedScope;i=c.createSample,e=s.repetitiveTasks,t=s.typeString,n=c.util.round,r=c.createSimpleSynth,o=c.util.parseSamples,["createAutoPanner","setKeyScalingPanning","setKeyScalingRelease","setRelease","transposeSamples","processEvent","stopSustain","playNote","stopNote","allNotesOff","allNotesOffPart","update","hasScheduledSamples","reschedule","unschedule"].forEach(function(e){var t=s[e];a.prototype[e]=function(){t.apply(this,arguments)}})})}(),function(){function e(e,t){t&&t(!1)}function t(t){var i=s(t.localPath,l.storage.instruments,!0),n=t.action;i&&"InstrumentConfig"===i.className&&"overwrite"!==n?l.debug>=2&&(d.warn("there is already an Instrument at",t.localPath),e(t)):r(t,t.localPath,l.storage.instruments)}function i(t,i){if(void 0===t.url)return t.localPath=void 0!==t.folder?t.folder+"/"+t.name:t.name,void i();n({url:t.url,responseType:"json",onError:function(){e(t,i)},onSuccess:function(e){if(null===e)return void i(!1);void 0!==e.name&&void 0===t.name&&(t.name=e.name),void 0!==e.folder&&void 0===t.folder&&(t.folder=e.folder),void 0===t.name&&(t.name=o(t.url).name),t.localPath=void 0!==t.folder?t.folder+"/"+t.name:t.name,c(e,function(e,i){"name"!==i&&"folder"!==i&&(t[i]=e)}),i()}})}var n,o,s,r,a,c,u,l=window.sequencer,d=window.console,p=0;u=function(e){this.id="IC"+p+++(new Date).getTime(),this.className="InstrumentConfig";var t=this;c(e,function(e,i){t[i]=e})},l.addInstrument=function(e,n,o){var s,r,c,p,h=a(e);if("object"!==h)return l.debug>=2&&d.warn("can't add an Instrument with this data",e),!1;if(e.json){if(r=e.json,c=e.name,p=e.folder,"string"===a(r))try{r=JSON.parse(r)}catch(t){return l.debug>=2&&d.warn("can't add an Instrument with this data",e),!1}if(void 0===r.mapping)return l.debug>=2&&d.warn("can't add an Instrument with this data",e),!1;e={mapping:r.mapping,name:void 0===c?r.name:c,folder:void 0===p?r.folder:p}}s=new u(e),l.addTask({type:"load instrument config",method:i,params:s},function(e){t(s),n&&n(s)},o),l.startTaskQueue()},l.protectedScope.addInitMethod(function(){n=l.protectedScope.ajax,s=l.protectedScope.findItem,o=l.protectedScope.parseUrl,r=l.protectedScope.storeItem,a=l.protectedScope.typeString,c=l.protectedScope.objectForEach})}(),function(){function e(e){null}function t(e,i,o,s){var r;for(i=0;i<o;i++)void 0!==(r=e[i])&&("MidiNote"===r.className?s.push(r.noteOn):"array"===n(r)&&t(r,0,r.length))}function i(e){return{getValue:function(e){return Math.sin(2*e*Math.PI)}}}var n,o,s,r,a,c,u,l,d,p,h,f,m,v,g,y,b,k,w,E,N,P,S,T=window.sequencer,A=window.console;p=function(e,t){var i,n,o,s,r=this.sampleData.length;if(!1===e)for(i=0;i<r;i++)n=this.sampleData[i],n.panning=!1;if(!1===isNaN(e)&&!1===isNaN(t))for(o=(t-e)/this.numNotes,s=e,i=0;i<r;i++)n=this.sampleData[i],n.panning=!0,n.panPosition=s,s+=o},f=function(e,t){if(void 0!==e){this.releaseEnvelope=t||this.releaseEnvelope,this.keyScalingRelease=void 0;var i,n,o=this.sampleData.length;for(i=0;i<o;i++)n=this.sampleData[i],n.release=!0,n.release_duration=e,n.release_envelope=this.releaseEnvelope;this.releaseDuration=e}},h=function(e,t,i){var n,o,s,r,a=this.sampleData.length;if(this.releaseEnvelope=i||this.releaseEnvelope,!1===isNaN(e)&&!1===isNaN(t))for(this.keyScalingRelease=[e,t],this.releaseDuration=0,s=(t-e)/this.numNotes,r=e,n=0;n<a;n++)o=this.sampleData[n],o.release_duration=r,o.release_envelope=r,r+=s},m=function(e,t,i){function n(s,r){var a;i&&i("transposing sample "+(s+1)+" of "+o),s<o?(a=r[s],setTimeout(function(){u(a.buffer,e,function(e){a.buffer=e,n(++s,r)})},10)):t&&(A.log("ready"),t())}if(void 0===u)return void A.log("transpose is still experimental");var o=this.sampleData.length;n(0,this.sampleData)},v=function(e){var t,i,n,s,r=e.type;void 0===e.time&&(e.time=0),128===r||144===r?128===r?(!0===this.sustainPedalDown&&(e.sustainPedalDown=!0),this.stopNote(e)):this.playNote(e):176===r&&(t=e.data1,i=e.data2,64===t?127===i?(this.sustainPedalDown=!0,d(this.track.song,"sustain_pedal","down")):0===i&&(this.sustainPedalDown=!1,d(this.track.song,"sustain_pedal","up"),this.stopSustain(e.time)):10===t?(n=this.track,n.setPanning(o(i,0,127,-1,1))):7===t&&(n=this.track,s=n.output,s.gain.setValueAtTime(i/127,e.time)))},g=function(e){var t,i=this.scheduledSamples,n=this.sustainPedalSamples;a(n,function(n){void 0!==n&&(t=n.midiNote,t.noteOn.sustainPedalDown=void 0,t.noteOff.sustainPedalDown=void 0,n.stop(e,function(e){i[e.sourceId]=null,delete i[e.sourceId]}))}),this.sustainPedalSamples={}},y=function(e){var t,i;if(!e.midiNote)return void(T.debug&&A.warn("playNote() no midi note"));i=e.midiNote.id,t=this.scheduledSamples[i],void 0!==t&&t.unschedule(0),t=this.createSample(e),t.addData({midiNote:e.midiNote,noteName:e.midiNote.note.fullName,sourceId:i}),this.scheduledSamples[i]=t,t.start(e)},b=function(e){if(void 0===e.midiNote)return void(T.debug&&A.warn("stopNote() no midi note"));var t=e.midiNote.id,i=this.scheduledSamples[t],n=this.scheduledSamples,o=this.sustainPedalSamples;if(!0===e.sustainPedalDown)return void(o[t]=i);void 0!==i&&i.stop(e.time,function(){n[t]=null,delete n[t]})},N=function(){return c(this.scheduledSamples)},P=function(t){var i,n,o,s=t.millis,r=s+1e3*T.bufferTime,a=this.scheduledSamples;for(i in a)if(a.hasOwnProperty(i))if(o=a[i],void 0===(n=o.midiNote)||"removed"===n.state)o.unschedule(0,e),delete a[i];else{if(n.noteOn.millis>=s&&n.noteOff.millis<r&&o.noteName===n.fullName)continue;delete a[i],o.unschedule(null,e)}},S=function(){var i,n,o,r,a=Array.prototype.slice.call(arguments),c=[];for(t(a,0,a.length,c),i=c.length-1;i>=0;i--)n=c[i],void 0!==n.midiNote?(o=n.midiNote.id,void 0!==(r=this.scheduledSamples[o])&&(r.unschedule(0,e),delete this.scheduledSamples[o])):"MidiEvent"===n.className&&(o=n.id,delete s["event_"+o],delete this.scheduledEvents[o])},k=function(){var t,i,n=this.scheduledSamples;if(this.stopSustain(0),this.sustainPedalDown=!1,void 0!==n&&!0!==c(n)){for(i in n)n.hasOwnProperty(i)&&(t=n[i])&&t.unschedule(0,e);this.scheduledSamples={},a(this.scheduledEvents,function(e,t){delete s["event_"+t]}),this.scheduledEvents={}}},w=function(t){var i,n,o=this.scheduledSamples;if(this.stopSustain(0),this.sustainPedalDown=!1,void 0!==o&&!0!==c(o)){for(n in o)o.hasOwnProperty(n)&&(i=o[n])&&i.unschedule(0,e);this.scheduledSamples={},a(this.scheduledEvents,function(e,t){delete s["event_"+t]}),this.scheduledEvents={}}},E=function(e){var t,i;for(t in this.scheduledSamples)this.scheduledSamples.hasOwnProperty(t)&&(i=this.scheduledSamples[t])&&i.update(e)},T.protectedScope.createAutoPanner=i,T.protectedScope.setKeyScalingPanning=p,T.protectedScope.setKeyScalingRelease=h,T.protectedScope.setRelease=f,T.protectedScope.transposeSamples=m,T.protectedScope.processEvent=v,T.protectedScope.stopSustain=g,T.protectedScope.playNote=y,T.protectedScope.stopNote=b,T.protectedScope.allNotesOff=k,T.protectedScope.allNotesOffPart=w,T.protectedScope.update=E,T.protectedScope.hasScheduledSamples=N,T.protectedScope.reschedule=P,T.protectedScope.unschedule=S,T.protectedScope.addInitMethod(function(){n=T.protectedScope.typeString,s=T.protectedScope.timedTasks,r=T.createReverb,a=T.protectedScope.objectForEach,c=T.protectedScope.isEmptyObject,u=T.protectedScope.transpose,l=T.util.getEqualPowerCurve,o=T.util.remap,d=T.protectedScope.songDispatchEvent})}(),function(){var e,t,i,n,o,s,r,a,c,u,l,d,p,h,f,m,v=window.sequencer,g=window.console,y=window.requestAnimationFrame,b="newEvents newNotes newParts changedEvents changedNotes changedParts removedEvents removedNotes removedParts".split(" "),k=Math.ceil;e=function(e,i){this.song=e,this.song.keyEditor=this,this.playhead=n(this.song,"barsbeats ticks millis","keyeditor"),this.numBars=e.bars,this.newNumBars=this.numBars,this.eventListeners={},this.interrupt=!1,this.iteratorFactory=t(this.song,this),this.verticalLine=this.iteratorFactory.createVerticalLineIterator(this),this.horizontalLine=this.iteratorFactory.createHorizontalLineIterator(this),this.eventIterator=this.iteratorFactory.createEventIterator(this),this.noteIterator=this.iteratorFactory.createNoteIterator(this),this.partIterator=this.iteratorFactory.createPartIterator(this),this.exactFitVertical=i.exactFitVertical||!1,this.exactFitHorizontal=i.exactFitHorizontal||!1,this.activeEvents=[],this.activeNotes=[],this.activeParts=[],this.newEvents=[],this.newNotes=[],this.newParts=[],this.changedEvents=[],this.changedNotes=[],this.changedParts=[],this.removedEvents=[],this.removedNotes=[],this.removedParts=[],this.recordedNotesObj={},this.recordedEventsObj={},this.snapshot={activeEvents:this.activeEvents,activeNotes:this.activeNotes,activeParts:this.activeParts,newEvents:this.newEvents,newNotes:this.newNotes,newParts:this.newParts,changedEvents:this.changedEvents,changedNotes:this.changedNotes,changedParts:this.changedParts,removedEvents:this.removedEvents,removedNotes:this.removedNotes,removedParts:this.removedParts},i.paginate?(this.paginate=!0,this.pageNo=0,this.barsPerPage=i.barsPerPage,this.pageWidth=i.pageWidth,this.pageHeight=i.pageHeight,this.width=this.pageWidth,this.lowestNote=i.lowestNote||e.lowestNote,this.highestNote=i.highestNote||e.highestNote,this.pitchRange=this.highestNote-this.lowestNote,this.exactFitVertical?(this.pitchHeight=this.height/this.pitchRange,this.height=this.pageHeight):(this.pitchHeight=i.pitchHeight||10,this.height=this.pitchHeight*this.pitchRange),p(this,0),h(this)):(this.setStartPosition(i.startPosition||1),this.setEndPosition(i.endPosition||e.bars+1),this.numTicks=this.endTicks-this.startTicks,i.width?(this.width=i.width,this.tickWidth=this.width/this.numTicks):i.tickWidth?(this.tickWidth=i.tickWidth,this.width=this.numTicks*this.tickWidth,this.exactFitHorizontal=!1):i.barsPerPage&&i.viewportWidth?(this.barsPerPage=i.barsPerPage,this.viewportWidth=i.viewportWidth,this.tickWidth=this.viewportWidth/(this.startPosition.ticksPerBar*this.barsPerPage),this.width=this.numTicks*this.tickWidth,this.scrollX=0,this.scrollPosition=0,this.viewportTicks=this.viewportWidth/this.tickWidth,this.maxScrollPosition=k(this.width/this.viewportWidth),this.scrollLimit=this.viewportWidth/this.tickWidth,f(this),this.exactFitHorizontal=!1):i.viewportWidth?(this.viewportWidth=this.width=i.viewportWidth,this.tickWidth=this.viewportWidth/this.numTicks,this.exactFitHorizontal=!0):(this.tickWidth=.1,this.width=this.numTicks*this.tickWidth,this.exactFitHorizontal=!1),this.lowestNote=i.lowestNote||e.lowestNote,this.highestNote=i.highestNote||e.highestNote,this.pitchRange=i.pitchRange||this.highestNote-this.lowestNote+1,i.height?(this.height=i.height,this.pitchHeight=this.height/this.pitchRange):i.pitchHeight?(this.pitchHeight=i.pitchHeight,this.height=this.pitchRange*this.pitchHeight,this.exactFitVertical=!1):i.viewportHeight?(this.viewportHeight=this.height=i.viewportHeight,this.pitchHeight=this.viewportHeight/this.pitchRange,this.exactFitVertical=!0):(this.pitchHeight=10,this.height=this.pitchRange*this.pitchHeight,this.exactFitVertical=!1)),this.scrollX=0,this.scrollY=0,this.currentPage=1,this.numPages=k(this.width/this.viewportWidth),this.snapValueX=void 0===i.snapX?0:i.snapX,this.snapValueY=void 0===i.snapY?"chromatic":i.snapY,this.setSnapX(this.snapValueX),this.setSnapY(this.snapValueY)},e.prototype.setBarsPerPage=function(e){this.interrupt=!0;var t=u(this.scrollX/(this.viewportWidth/this.barsPerPage));this.barsPerPage=e,this.tickWidth=this.viewportWidth/(this.startPosition.ticksPerBar*this.barsPerPage),this.viewportTicks=this.viewportWidth/this.tickWidth,this.width=this.numTicks*this.tickWidth,this.verticalLine.reset(),this.horizontalLine.reset(),this.eventIterator.reset(),this.partIterator.reset(),this.scrollLimit=this.viewportWidth/this.tickWidth,this.maxScrollPosition=k(this.width/this.viewportWidth),this.snapWidth=this.tickWidth*this.snapTicks,this.numPages=k(this.numBars/this.barsPerPage),this.currentPage=l(this.song.ticks/(this.barsPerPage*this.song.ticksPerBar))+1,m(this,"scale",{}),this.song.playing?this.scrollPosition=l(this.song.ticks/this.viewportTicks):(this.scrollPosition=this.viewportWidth/this.barsPerPage*t/this.viewportWidth,m(this,"scroll",{x:this.scrollPosition*this.viewportWidth})),this.interrupt=!1},e.prototype.setViewport=function(e,t){var i=!1;this.barsPerPage&&e!==this.viewportWidth?(this.viewportWidth=e,this.tickWidth=this.viewportWidth/(this.startPosition.ticksPerBar*this.barsPerPage),this.viewportTicks=this.viewportWidth/this.tickWidth,this.width=this.numTicks*this.tickWidth,i=!0):!0===this.exactFitHorizontal&&e!==this.width&&(this.viewportWidth=this.width=e,this.tickWidth=this.width/this.numTicks,i=!0),!0===this.exactFitVertical&&t!==this.height&&(this.viewportHeight=this.height=t,this.pitchHeight=this.height/this.pitchRange,i=!0),i&&(this.verticalLine.reset(),this.horizontalLine.reset(),this.eventIterator.reset(),this.noteIterator.reset(),this.partIterator.reset(),m(this,"draw",{}))},e.prototype.updateSong=function(e){this.iteratorFactory.updateSong();var t,i,n,o,s=0;for(s=b.length-1;s>=0;s--)switch(t=b[s]){case"newNotes":case"changedNotes":for(n=e[t],i=n.length-1;i>=0;i--)o=n[i],o.bbox=this.getNoteRect(o);break;case"newParts":case"changedParts":for(n=e[t],i=n.length-1;i>=0;i--)o=n[i],o.bbox=this.getPartRect(o)}this.newNumBars=e.numBars,this.newEvents=this.newEvents.concat(e.newEvents),this.changedEvents=this.changedEvents.concat(e.changedEvents),this.removedEvents=this.removedEvents.concat(e.removedEvents),this.removedEventsObj=a(this.removedEvents,"id"),this.newNotes=this.newNotes.concat(e.newNotes),this.changedNotes=this.changedNotes.concat(e.changedNotes),this.removedNotes=this.removedNotes.concat(e.removedNotes),this.removedNotesObj=a(this.removedNotes,"id"),this.newParts=this.newParts.concat(e.newParts),this.changedParts=this.changedParts.concat(e.changedParts),this.removedParts=this.removedParts.concat(e.removedParts),this.removedPartsObj=a(this.removedParts,"id")},e.prototype.setStartPosition=function(e){"array"!==s(e)&&(e=["barsandbeats",e,1,1,0]),this.startPosition=i(this.song,e),this.startTicks=this.startPosition.ticks,this.startMillis=this.startPosition.millis},e.prototype.setEndPosition=function(e){"array"!==s(e)&&(e=["barsandbeats",e,1,1,0]),this.endPosition=i(this.song,e),this.endTicks=this.endPosition.ticks,this.endMillis=this.endPosition.millis},e.prototype.addEventListener=function(e,t){var i,n,o=e.split(" "),s=this;o.forEach(function(e){i=s.eventListeners[e],void 0===i&&(s.eventListeners[e]=[],i=s.eventListeners[e]),n=e+"-"+i.length,i.push(t)})},e.prototype.nextPage=function(){p(this,this.startBar+this.barsPerPage),m(this,"pagechange",{pageNo:this.pageNo,lastPage:this.lastPage})},e.prototype.prevPage=function(){p(this,this.startBar-this.barsPerPage),m(this,"pagechange",{pageNo:this.pageNo,lastPage:this.lastPage})},e.prototype.gotoPage=function(e){g.warn("ooops, not implemented yet!")},e.prototype.scroll=function(e){var t,i=u(this.scrollX/(this.viewportWidth/this.barsPerPage));switch(this.scrollPosition=this.viewportWidth/this.barsPerPage*i/this.viewportWidth,e){case">":this.scrollPosition+=1,this.scrollPosition=this.scrollPosition>this.maxScrollPosition?this.maxScrollPosition:this.scrollPosition;break;case">>":this.scrollPosition=this.maxScrollPosition;break;case"<":this.scrollPosition-=1,this.scrollPosition=this.scrollPosition<0?0:this.scrollPosition;break;case"<<":this.scrollPosition=0;break;default:if(isNaN(e))return;this.scrollPosition=parseInt(e)}t=this.scrollPosition*this.viewportWidth,this.scrollLimit=(t+this.viewportWidth)/this.tickWidth,this.currentPage=k(t/this.viewportWidth)+1,0===this.currentPage?this.currentPage=1:this.currentPage>this.maxScrollPosition&&(this.currentPage=this.maxScrollPosition),m(this,"scroll",{x:t})},e.prototype.updateScroll=function(e,t){this.scrollX=e,this.scrollY=t,this.scrollLimit=(e+this.viewportWidth)/this.tickWidth},e.prototype.getEventRect=function(e){var t=this.ticksToX(e.ticks-this.startTicks,!1),i=this.pitchToY(e.number),n=2*this.tickWidth,o=this.pitchHeight;return{x:t,y:i,width:n,height:o,top:i,left:t,bottom:i+o,right:t+n}},e.prototype.getNoteRect=function(e){var t,i,n,o=this.ticksToX(e.ticks-this.startTicks,!1),s=this.pitchToY(e.number),r=e.durationTicks*this.tickWidth,a=this.pitchHeight;if(e.endless&&(r=(this.song.ticks-e.noteOn.ticks)*this.tickWidth),this.paginate){if(t=e.ticks,i=e.noteOff.ticks,!(t<this.startTicks))return!1;n=this.startTicks-t,t=t+n-this.startTicks,o=t*this.tickWidth,i=i>this.endTicks?this.endTicks:i,r=(i-this.startTicks)*this.tickWidth}return{x:o,y:s,width:r,height:a,top:s,left:o,bottom:s+a,right:o+r}},e.prototype.getPartRect=function(e){var t=e.getStats("noteNumber all"),i={top:this.pitchToY(t.max),bottom:this.pitchToY(t.min)+this.pitchHeight,left:this.ticksToX(e.start.ticks-this.startTicks,!1),right:this.ticksToX(e.end.ticks-this.startTicks,!1)};return i.x=i.left,i.y=i.top,i.width=i.right-i.left,i.height=i.bottom-i.top,e.bbox=i,e.stats=t,i},e.prototype.getBBox=function(e){var t,i;if("string"===s(e))switch(e.substring(0,1)){case"E":if(t="event",144!==event.type||void 0===event.endEvent)return void g.error("argument not supported, please check documentation");i=this.song.findEvent("id = "+e);break;case"P":t="part",i=this.song.getPart(e);break;case"T":t="track";break;default:return void g.error("argument not supported, please check documentation")}else switch(e.className){case"AudioEvent":t="audio";break;case"MidiEvent":t="event";break;case"Part":t="part";break;case"Track":t="track";break;default:return void g.error("argument not supported, please check documentation")}if(void 0===i)return void g.error(e,"could not be found");switch(t){case"event":return this.getNoteRect(i);case"part":return this.getPartRect(i)}},e.prototype.startMoveNote=function(e,t,i){if("MidiNote"!==e.className)return void(v.debug>=v.WARN&&g.warn(e,"is not a MidiNote"));this.selectedNote=e,this.gripX=t-this.selectedNote.bbox.x},e.prototype.stopMoveNote=function(){this.selectedNote=void 0},e.prototype.moveNote=function(e,t){if(void 0!==this.selectedNote){var i=this.yToPitch(t).number,n=this.selectedNote.pitch,o=this.xToTicks(e-this.gripX),s=this.selectedNote.ticks,r=this.selectedNote.part,a=!1;i!==n&&(r.transposeNote(this.selectedNote,i-n),a=!0),o!==s&&(r.moveNote(this.selectedNote,o-s),a=!0),!0===a&&this.song.update()}},e.prototype.startMovePart=function(e,t,i){if("Part"!==e.className)return void(v.debug>=v.WARN&&g.warn(e,"is not a Part"));this.selectedPart=e,this.selectedPart.pitch=this.yToPitch(i).number,this.gripX=t-this.selectedPart.bbox.x},e.prototype.stopMovePart=function(){this.selectedPart=void 0},e.prototype.movePart=function(e,t){if(void 0!==this.selectedPart){var i=this.yToPitch(t).number,n=this.selectedPart.pitch,o=this.xToTicks(e-this.gripX),s=this.selectedPart.ticks,r=!1;i!==n&&(this.selectedPart.track.transposePart(this.selectedPart,i-n),this.selectedPart.pitch=i,r=!0),o!==s&&(this.selectedPart.track.movePart(this.selectedPart,o-s),r=!0),!0===r&&this.song.update()}},e.prototype.getTicksAt=e.prototype.xToTicks=function(e,t){var i=(e+this.scrollX)/this.width*this.numTicks;return!1!==t&&0!==this.snapTicks&&(i=u(i/this.snapTicks)*this.snapTicks),i},e.prototype.getPitchAt=e.prototype.yToPitch=function(e){var t=this.highestNote-u((e+this.scrollY)/this.height*this.pitchRange);return t=d(t)},e.prototype.getXAt=e.prototype.ticksToX=function(e,t){var i=(e-this.startTicks)*this.tickWidth;return!1!==t&&0!==this.snapWidth&&(i=u(i/this.snapWidth)*this.snapWidth),i},e.prototype.getYAt=e.prototype.pitchToY=function(e){return this.height-(e-this.lowestNote+1)*this.pitchHeight},e.prototype.getPositionAt=function(e){var t=this.getTicksAt(e);return this.playhead.set("ticks",t,!1),this.playhead.get()},e.prototype.getPlayheadX=function(e){var t=this.song.ticks/this.song.durationTicks*this.width;return t=!0===e?t-this.scrollX:t},e.prototype.setPlayheadToX=function(e){var t=this.xToTicks(e,!1);this.song.setPlayhead("ticks",t)},e.prototype.getPlayheadPosition=function(e){var t=this.song.ticks/this.song.durationTicks*this.width;return t=!0===e?t-this.scrollX:t},e.prototype.setPlayheadPosition=function(e,t){var n;switch(e){case"x":n=this.xToTicks(t,!1);break;case"ticks":n=t;break;case"millis":n=this.playhead.set("millis",t).ticks;break;case"barsbeats":case"barsandbeats":n=i(this.song,["barsbeats",t]).ticks}this.song.setPlayhead("ticks",n)},e.prototype.getEventAt=function(e,t){this.getSongPosition(e),this.getPitchAt(t)},e.prototype.getEventsInRect=function(e,t,i,n){this.getSongPosition(e),this.getSongPosition(e+i),this.getPitchAt(t+n),this.getPitchAt(t)},e.prototype.getNoteAt=function(e,t){this.getSongPosition(e),this.getPitchAt(t)},e.prototype.getNotesInRect=function(e,t,i,n){this.getSongPosition(e),this.getSongPosition(e+i),this.getPitchAt(t+n),this.getPitchAt(t)},e.prototype.snap=function(e,t){return{x:this.snapX(e),y:this.snapY(t)}},e.prototype.snapX=function(e){return u((e+this.scrollX)/this.snapWidth)*this.snapWidth},e.prototype.snapY=function(e){return u((e+this.scrollY)/this.snapHeight)*this.snapHeight},e.prototype.setSnapX=function(e){if(void 0!==e){var t=4/this.song.denominator;"off"===e?this.snapTicks=0:"tick"===e?this.snapTicks=1:"beat"===e?this.snapTicks=this.song.ppq*t:"bar"===e?this.snapTicks=this.song.ppq*this.song.nominator*t:isNaN(e)&&-1!==e.indexOf("ticks")?(this.snapTicks=e.replace(/ticks/,""),isNaN(this.snapTicks)?this.snapTicks=this.song.ppq/4:this.snapTicks=parseInt(this.snapTicks)):isNaN(e)||0===e?(e=0,this.snapTicks=0):(e=parseInt(e),this.snapTicks=4/e*this.song.ppq),this.snapValueX=e,this.snapWidth=this.tickWidth*this.snapTicks}},e.prototype.setSnapY=function(e){void 0!==e&&(this.snapValueY=e,this.snapHeight=this.pitchHeight)},e.prototype.removeNote=function(e){e.part.removeEvents(e.noteOn,e.noteOff),this.song.update()},e.prototype.removePart=function(e){e.track.removePart(e),this.song.update()},e.prototype.prepareForRecording=function(){this.recordedEventsObj={},this.recordedNotesObj={}},e.prototype.getSnapshot=function(){var e,t,n,o,s,r,a,c,u,d,p,h=[],f=[],m=[],v=[].concat(this.activeEvents),y=[].concat(this.activeNotes),b=[].concat(this.activeParts),w=[],E=[],N=[];this.activeEvents=[],this.activeNotes=[],this.activeParts=[],this.activeStateChangedEvents=[],this.activeStateChangedNotes=[],this.activeStateChangedParts=[],this.newNumBars!==this.numBars&&(d=this.numBars,p=this.song.lastBar+1,this.endPosition=i(this.song,["barsbeats",p,1,1,0,!0]),this.verticalLine.reset(i(this.song,["barsbeats",d,1,1,0,!0]),this.endPosition),this.numBars=this.song.bars,this.endTicks=this.endPosition.ticks,this.numTicks=this.song.durationTicks,this.width=this.numTicks*this.tickWidth,this.maxScrollPosition=k(this.width/this.viewportWidth),this.numPages=k(this.numBars/this.barsPerPage)),e=this.song.activeEvents;for(a in e)e.hasOwnProperty(a)&&(c=e[a],this.activeEvents.push(c),!0!==c.active&&(c.active=!0,this.activeStateChangedEvents.push(c)));t=this.song.activeNotes;for(a in t)t.hasOwnProperty(a)&&(c=t[a],this.activeNotes.push(c),!0!==c.active&&(c.active=!0,this.activeStateChangedNotes.push(c)));n=this.song.activeParts;for(a in n)n.hasOwnProperty(a)&&(c=n[a],this.activeParts.push(c),!0!==c.active&&(c.active=!0,this.activeStateChangedParts.push(c)));if(s=this.song.recordedEvents)for(u=s.length,a=0;a<u;a++)c=s[a],void 0===this.recordedEventsObj[c.id]&&(c.bbox=this.getEventRect(c),w.push(c),this.recordedEventsObj[c.id]=c);if(o=this.song.recordedNotes)for(u=o.length,a=0;a<u;a++)c=o[a],void 0===this.recordedNotesObj[c.id]?(this.recordedNotesObj[c.id]=c,c.bbox=this.getNoteRect(c),E.push(c)):!0===c.endless?(c.bbox=this.getNoteRect(c),N.push(c)):!1===c.endless&&(c.bbox=this.getNoteRect(c),N.push(c),c.endless=void 0);for(a=v.length-1;a>=0;a--)c=v[a],void 0!==c?void 0===e[c.id]&&(h.push(c),!1!==c.active&&(c.active=!1,this.activeStateChangedEvents.push(c))):g.warn("event is undefined");for(a=y.length-1;a>=0;a--)c=y[a],void 0!==c?void 0===t[c.id]&&(f.push(c),!1!==c.active&&(c.active=!1,this.activeStateChangedNotes.push(c))):g.warn("note is undefined");for(a=b.length-1;a>=0;a--)c=b[a],void 0!==c?void 0===n[c.id]&&(m.push(c),!1!==c.active&&(c.active=!1,this.activeStateChangedParts.push(c))):g.warn("part is undefined");return this.song.playing&&(this.currentPage=l(this.song.ticks/(this.barsPerPage*this.song.ticksPerBar))+1),r={events:{active:this.activeEvents,inActive:this.nonActiveEvents,recorded:w,new:this.newEvents,changed:this.changedEvents,removed:this.removedEvents,stateChanged:this.activeStateChangedEvents},notes:{active:this.activeNotes,inActive:f,recorded:E,recording:N,new:this.newNotes,changed:this.changedNotes,removed:this.removedNotes,stateChanged:this.activeStateChangedNotes},parts:{active:this.activeParts,inActive:m,new:this.newParts,changed:this.changedParts,removed:this.removedParts,stateChanged:this.activeStateChangedParts},hasNewBars:d!==p,newWidth:this.width,pageNo:this.currentPage,lastPage:this.numPages},this.newEvents=[],this.changedEvents=[],this.removedEvents=[],this.newNotes=[],this.changedNotes=[],this.removedNotes=[],this.newParts=[],this.changedParts=[],this.removedParts=[],r},p=function(e,t){e.numTicks=0,e.startBar=t>0?t:0,e.startBar=e.startBar>e.numBars-e.barsPerPage?e.numBars-e.barsPerPage:e.startBar,e.endBar=t+e.barsPerPage,e.endBar=e.endBar>e.numBars?e.numBars:e.endBar,e.endBar=e.endBar<e.barsPerPage?e.barsPerPage:e.endBar,g.log(t,e.startBar,e.endBar,e.numBars,e.numBars-e.barsPerPage);var i;for(i=e.startBar;i<e.endBar;i++)e.numTicks+=e.bars[i].ticksPerBar;e.tickWidth=e.pageWidth/e.numTicks,e.startPosition=e.bars[e.startBar],e.endPosition=e.bars[e.endBar],e.startTicks=e.startPosition.ticks,e.endTicks=e.endPosition.ticks,e.verticalLine.reset(),e.horizontalLine.reset(),e.eventIterator.reset()},h=function(e){e.song.playing()&&e.song.ticks>=e.endTicks&&e.nextPage(),y(function(){h(e)})},f=function(e){if(e.song.playing&&!1===e.interrupt)if(e.song.ticks>=e.scrollLimit)m(e,"scroll",{x:e.scrollX+e.viewportWidth}),e.scrollLimit+=e.viewportWidth/e.tickWidth;else{var t=l(e.song.ticks/e.viewportTicks)*e.viewportTicks*e.tickWidth;e.scrollX!==t&&m(e,"scroll",{x:t})}y(function(){f(e)})},m=function(e,t,i){var n=e.eventListeners[t];n&&n.forEach(function(e){e(i)})},v.createKeyEditor=function(t,i){return new e(t,i)},v.protectedScope.addInitMethod(function(){i=v.protectedScope.getPosition,n=v.protectedScope.createPlayhead,d=v.createNote,c=v.debug,l=v.protectedScope.floor,u=v.protectedScope.round,s=v.protectedScope.typeString,r=v.protectedScope.objectToArray,a=v.protectedScope.arrayToObject,o=v.protectedScope.getScaffoldingBars,t=v.protectedScope.createKeyEditorIteratorFactory})}(),function(){function e(e,i){this.song=e,this.editor=i,this.position=t(this.song,"all","iterators"),this.updateSong()}var t,i,n=window.sequencer;e.prototype.updateSong=function(){this.events=this.song.events,this.numEvents=this.events.length,this.notes=this.song.notes,this.numNotes=this.notes.length,this.parts=this.song.parts,this.numParts=this.parts.length,this.position.updateSong()},e.prototype.createVerticalLineIterator=function(){var e,t,i,n,o,s,r,a,c,u,l,d,p,h,f,m,v,g,y,b={},k=this.editor,w=this.position;return g=function(){h=w.update("ticks",o),b.bar=h.ticksPerBar,b.beat=h.ticksPerBeat,b.sixteenth=h.ticksPerSixteenth,u=h.nominator,l=h.numSixteenth},f=function(d){switch(d&&(n=d,t<.02?n="bar":t<.042&&(n="beat")),n){case"sixteenth":e="sixteenth",c++,c>l&&(e="beat",c=1,++a>u&&(e="bar",a=1,r++));break;case"beat":e="beat",c=1,a++,a>u&&(e="bar",a=1,r++);break;case"bar":e="bar",c=1,a=1,r++}return o+=b[n],g(),!(o>s)&&{x:o*t-i,bar:r,beat:a,sixteenth:c,type:e,position:h}},m=function(e){var i=s-o,r=!1;switch(e&&(n=e,t<.02?n="bar":t<.042&&(n="beat")),n){case"bar":case"beat":case"sixteenth":r=i>=b[n]}return r},v=function(e,u){d=e||k.startPosition,p=u||k.endPosition,o=d.ticks,r=d.bar,a=d.beat,c=d.sixteenth,s=p.ticks,t=k.tickWidth,i=0,w.set("ticks",o),t<.02?n="bar":t<.042&&(n="beat"),g()},y=function(e){n=e,t<.02?n="bar":t<.042&&(n="beat")},{next:f,reset:v,hasNext:m,setType:y}},e.prototype.createHorizontalLineIterator=function(){var e,t,n,o,s,r,a,c={},u=this.editor;return s=function(n){return c={note:i(t),y:e*o},t--,e++,c},r=function(t){var i=!1;switch(t){case"chromatic":i=e<n}return i},a=function(){e=0,t=u.highestNote,n=u.pitchRange,o=u.pitchHeight},{next:s,reset:a,hasNext:r}},e.prototype.createEventIterator=function(){var e,t,i,o,s,r,a,c,u,l=this.editor,d=this.position,p=this.events,h=this.numEvents,f="";return a=function(e){return f=e||f,i=!0,++o!==h&&(s=p[o],""===f&&s.ticks<=t)},r=function(e){return f=e||f,i||a(f),i=!1,s},c=function(){e=l.startTicks,t=l.endTicks,i=!1,!0===l.paginate&&!0===n.isPlaying()||(o=d.get().eventIndex-2)},u=function(){Array.prototype.slice.call(arguments).forEach(function(e){f+=e+" "})},{next:r,reset:c,hasNext:a,setTypes:u}},e.prototype.createNoteIterator=function(){var e,t,i,o,s,r,a,c,u,l=this.editor,d=this.song,p=this.notes,h=this.numNotes,f="";return c=function(n){if(f=n||f,i=!0,++o===this.numNotes)return!1;for(s=!1;o<h&&(r=p[o],!(r.ticks>=t));o++)if(l.paginate){if(r.ticks<e&&r.noteOff.ticks>e?s=!0:r.ticks<t&&(s=!0),s)break}else if(s=r.ticks<=t)break;return s},a=function(e){return f=e||f,i||c(f),i=!1,r.bbox=l.getNoteRect(r),r},u=function(){var s;if(e=l.startTicks,t=l.endTicks,p=d.notes,h=d.numNotes,i=!1,!0!==l.paginate||!0!==n.isPlaying()){for(o=0;o<h&&(s=p[o],!(s.ticks>=e));o++);o--}},{next:a,reset:u,hasNext:c}},e.prototype.createPartIterator=function(){var e,t,i,n,o,s,r=this.editor,a=this.song,c=this.parts;return n=function(t){return i=c[e++],i.bbox=r.getPartRect(i),i},o=function(i){return e<t},s=function(){c=a.parts,t=a.numParts,e=0},{next:n,reset:s,hasNext:o}},n.protectedScope.createKeyEditorIteratorFactory=function(t,i){return new e(t,i)},n.protectedScope.addInitMethod(function(){i=n.createNote,t=n.protectedScope.createPlayhead})}(),function(){function e(e){return isNaN(e)?(l.debug&&d.log("please provide a number"),!1):e<0||e>127?(l.debug&&d.log("please provide a number between 0 and 127"),!1):e}function t(e,t,i,n){var s,a,c,u,d,p,h,f,m,v,g=0,y=[],b=e.song;for(s=t;s<=i;s++)for(c=o(b,["barsbeats",s]),h=c.nominator,f=c.ticksPerBeat,a=0;a<h;a++)p=0===a?e.noteNumberAccented:e.noteNumberNonAccented,d=0===a?e.noteLengthAccented:e.noteLengthNonAccented,u=0===a?e.velocityAccented:e.velocityNonAccented,m=l.createMidiEvent(g,144,p,u),v=l.createMidiEvent(g+d,128,p,0),"precount"===n&&(m.part={id:"precount"},m.track=e.track,v.part={id:"precount"},v.track=e.track),r(m,v),y.push(m,v),g+=f;return y}var i,n,o,s,r,a,c,u,l=window.sequencer,d=window.console,p={volume:"setVolume",instrument:"setInstrument",noteNumberAccentedTick:"setNoteNumberAccentedTick",noteNumberNonAccentedTick:"setNoteNumberNonAccentedTick",velocityAccentedTick:"setVelocityAccentedTick",velocityNonAccentedTick:"setVelocityNonAccentedTick",noteLengthAccentedTick:"setNoteLengthAccentedTick",noteLengthNonAccentedTick:"setNoteLengthNonAccentedTick"};u=function(e){this.song=e,this.track=l.createTrack(this.song.id+"_metronome","metronome"),this.part=l.createPart(),this.track.addPart(this.part),this.track.connect(this.song.gainNode),this.events=[],this.precountEvents=[],this.noteNumberAccented=61,this.noteNumberNonAccented=60,this.volume=1,this.velocityNonAccented=100,this.velocityAccented=100,this.noteLengthNonAccented=e.ppq/4,this.noteLengthAccented=e.ppq/4,this.track.setInstrument("heartbeat/metronome"),this.precountDurationInMillis=0,this.bars=0},u.prototype.init=function(e,i,n){e=void 0===e?"init":e,this.part.numEvents>0&&this.part.removeEvents(this.part.events),this.events=t(this,i,n,e),this.numEvents=this.events.length,this.part.addEvents(this.events),this.bars=this.song.bars,c(this.song,this.events)},u.prototype.update=function(e,t){0===e&&(e=1),void 0!==e&&void 0!==t?this.init("update",e,t):this.init("update",1,this.song.bars)},u.prototype.updateConfig=function(){this.init("configure",1,this.bars),this.allNotesOff(),this.song.scheduler.updateSong()},u.prototype.configure=function(e){var t=this;s(e,function(e,i){t[p[i]](e)}),this.updateConfig()},u.prototype.setInstrument=function(e){"Instrument"!==e.className&&(e=l.createInstrument(e)),!1!==e?this.track.setInstrument(e):this.track.setInstrument("heartbeat/metronome"),this.updateConfig()},u.prototype.setNoteLengthAccentedTick=function(e){isNaN(e)&&l.debug>=2&&d.warn("please provide a number"),this.noteLengthAccented=e,this.updateConfig()},u.prototype.setNoteLengthNonAccentedTick=function(e){isNaN(e)&&l.debug>=2&&d.warn("please provide a number"),this.noteLengthNonAccented=e,this.updateConfig()},u.prototype.setVelocityAccentedTick=function(t){t=e(t),!1!==t?this.velocityAccented=t:l.debug>=2&&d.warn("please provide a number"),this.updateConfig()},u.prototype.setVelocityNonAccentedTick=function(t){t=e(t),!1!==t?this.velocityNonAccented=t:l.debug>=2&&d.warn("please provide a number"),this.updateConfig()},u.prototype.setNoteNumberAccentedTick=function(t){t=e(t),!1!==t?this.noteNumberAccented=t:l.debug>=2&&d.warn("please provide a number"),this.updateConfig()},u.prototype.setNoteNumberNonAccentedTick=function(t){t=e(t),!1!==t?this.noteNumberNonAccented=t:l.debug>=2&&d.warn("please provide a number"),this.updateConfig()},u.prototype.reset=function(){this.volume=1,this.track.setInstrument("heartbeat/metronome"),this.noteNumberAccented=61,this.noteNumberNonAccented=60,this.velocityAccented=100,this.velocityNonAccented=100,this.noteLengthAccented=this.song.ppq/4,this.noteLengthNonAccented=this.song.ppq/4},u.prototype.allNotesOff=function(){this.track.instrument&&this.track.instrument.allNotesOff()},u.prototype.createPrecountEvents=function(e){if(!(e<=0)){var i=this.song.getPosition("barsbeats",this.song.bar+e);this.index=0,this.millis=0,this.startMillis=this.song.millis,this.precountDurationInMillis=i.millis-this.startMillis,this.precountEvents=t(this,this.song.bar,i.bar-1,"precount"),a(this.song,this.precountEvents)}},u.prototype.getPrecountEvents=function(e){var t,i,n=this.precountEvents,o=n.length,s=[];for(t=this.index;t<o&&(i=n[t],i.millis<e);t++)i.time=this.startTime+i.millis,s.push(i),this.index++;return s},u.prototype.setVolume=function(e){this.track.setVolume(e)},l.protectedScope.createMetronome=function(e){return new u(e)},l.protectedScope.addInitMethod(function(){i=l.protectedScope.context,n=l.protectedScope.findItem,o=l.protectedScope.getPosition,r=l.createMidiNote,s=l.util.objectForEach,a=l.protectedScope.parseEvents,c=l.protectedScope.parseMetronomeEvents})}(),function(){var e,t,i,n=window.sequencer,o=window.console,s=Array.prototype.slice,r=0;i=function(i){var s,a;if(this.className="MidiEvent",this.id="M"+r+(new Date).getTime(),this.eventNumber=r,this.channel="any",this.time=0,this.muted=!1,r++,i){if("midimessageevent"===t(i[0]))return void o.log("midimessageevent");if("array"===t(i[0]))s=i[0];else{if("number"!==t(i[0])||"number"!==t(i[1]))return n.debug>=1&&o.error("wrong number of arguments, please consult documentation"),!1;s=[i[0],i[1]],i.length>=3&&"number"===t(i[2])&&s.push(i[2]),4===i.length&&"number"===t(i[3])&&s.push(i[3]),5===i.length&&"number"===t(i[4])&&s.push(i[4])}switch(this.ticks=s[0],this.status=s[1],this.type=16*(this.status>>4),this.type>=128?(this.command=this.type,this.channel=1+(15&this.status)):(this.type=this.status,this.channel=s[4]||"any"),this.sortIndex=this.type+this.ticks,this.type){case 0:break;case 128:this.data1=s[2],a=e(this.data1),this.note=a,this.noteName=a.fullName,this.noteNumber=a.number,this.octave=a.octave,this.frequency=a.frequency,this.data2=0,this.velocity=this.data2;break;case 144:this.data1=s[2],this.data2=s[3],0===this.data2&&(this.type=128),a=e(this.data1),this.note=a,this.noteName=a.fullName,this.noteNumber=a.number,this.octave=a.octave,this.frequency=a.frequency,this.velocity=this.data2;break;case 81:this.bpm=s[2];break;case 88:this.nominator=s[2],this.denominator=s[3];break;case 176:this.data1=s[2],this.data2=s[3],this.controllerType=s[2],this.controllerValue=s[3];break;case 192:this.data1=s[2],this.programNumber=s[2];break;case 208:case 224:this.data1=s[2],this.data2=s[3];break;case 47:break;default:o.warn("not a recognized type of midi event!")}}},i.prototype.clone=i.prototype.copy=function(){var e,t=new i;for(e in this)this.hasOwnProperty(e)&&("id"!==e&&"eventNumber"!==e&&"midiNote"!==e&&(t[e]=this[e]),t.song=void 0,t.track=void 0,t.trackId=void 0,t.part=void 0,t.partId=void 0);return t},i.prototype.transpose=function(i){if(128!==this.type&&144!==this.type)return void(n.debug>=1&&o.error("you can only transpose note on and note off events"));if("array"===t(i)){var s=i[0];"hertz"===s||"semi"!==s&&"semitone"!==s||(i=i[1])}else if(!0===isNaN(i))return void(n.debug>=1&&o.error("please provide a number"));var r=this.data1+parseInt(i,10);r<0?r=0:r>127&&(r=127),this.data1=r;var a=e(this.data1);this.note=a,this.noteName=a.fullName,this.noteNumber=a.number,this.octave=a.octave,this.frequency=a.frequency,void 0!==this.midiNote&&(this.midiNote.pitch=this.data1),"new"!==this.state&&(this.state="changed"),void 0!==this.part&&(this.part.needsUpdate=!0)},i.prototype.setPitch=function(i){if(128!==this.type&&144!==this.type)return void(n.debug>=1&&o.error("you can only set the pitch of note on and note off events"));if("array"===t(i)){var s=i[0];"hertz"===s||"semi"!==s&&"semitone"!==s||(i=i[1])}else if(!0===isNaN(i))return void(n.debug>=1&&o.error("please provide a number"));this.data1=parseInt(i,10);var r=e(this.data1);this.note=r,this.noteName=r.fullName,this.noteNumber=r.number,this.octave=r.octave,this.frequency=r.frequency,void 0!==this.midiNote&&(this.midiNote.pitch=this.data1),"new"!==this.state&&(this.state="changed"),void 0!==this.part&&(this.part.needsUpdate=!0)},i.prototype.move=function(e){if(isNaN(e))return void(n.debug>=1&&o.error("please provide a number"));this.ticks+=parseInt(e,10),"new"!==this.state&&(this.state="changed"),void 0!==this.part&&(this.part.needsUpdate=!0)},i.prototype.moveTo=function(){var e=s.call(arguments);"ticks"===e[0]&&!1===isNaN(e[1])?this.ticks=parseInt(e[1],10):void 0===this.song?n.debug>=1&&o.error("The midi event has not been added to a song yet; you can only move to ticks values"):(e=this.song.getPosition(e),!1===e?n.debug>=1&&o.error("wrong position data"):this.ticks=e.ticks),"new"!==this.state&&(this.state="changed"),void 0!==this.part&&(this.part.needsUpdate=!0)},i.prototype.reset=function(e,t,i){e=void 0===e,t=void 0===t,i=void 0===i,e&&(this.part=void 0,this.partId=void 0),t&&(this.track=void 0,this.trackId=void 0,this.channel=0),i&&(this.song=void 0)},i.prototype.update=function(){},n.createMidiEvent=function(){var e=s.call(arguments);return"MidiEvent"===e[0].className?e[0].copy():new i(e)},n.protectedScope.addInitMethod(function(){e=n.createNote,t=n.protectedScope.typeString})}(),function(){function e(e){var t=!1;return e=e.replace(/_/g," "),!1!==(t=n[e]||!1)?t:(e=e.replace(/\s/g,"_"),t=o[e]||!1,!1===t&&!0===sequencer.debug&&console.warn(e,"is not a valid (or supported) midi event name, please consult documentation"),t)}function t(e,t){var i=!1;return"lower"===(t=t||"upper")?(i=s[e]||!1,!1===i&&!0===sequencer.debug&&console.warn(e,"is not a valid (or supported) midi event number, please consult documentation"),i):(i=r[e]||!1,!1===i&&!0===sequencer.debug&&console.warn(e,"is not a valid (or supported) midi event number, please consult documentation"),i)}function i(i){return isNaN(i)?e(i):t(i)}var n={"note off":128,"note on":144,"poly pressure":160,"control change":176,"program change":192,"channel pressure":208,"pitch bend":224,tempo:81,"time signature":88,"end of track":47},o={NOTE_OFF:128,NOTE_ON:144,POLY_PRESSURE:160,CONTROL_CHANGE:176,PROGRAM_CHANGE:192,CHANNEL_PRESSURE:208,PITCH_BEND:224,TEMPO:81,TIME_SIGNATURE:88,END_OF_TRACK:47},s={128:"note off",144:"note on",160:"poly pressure",176:"control change",192:"program change",208:"channel pressure",224:"pitch bend",81:"tempo",88:"time signature",47:"end of track"},r={128:"NOTE_OFF",144:"NOTE_ON",160:"POLY_PRESSURE",176:"CONTROL_CHANGE",192:"PROGRAM_CHANGE",208:"CHANNEL_PRESSURE",224:"PITCH_BEND",81:"TEMPO",88:"TIME_SIGNATURE",47:"END_OF_TRACK"};Object.defineProperty(sequencer,"DUMMY_EVENT",{value:0}),Object.defineProperty(sequencer,"MIDI_NOTE",{value:112}),Object.defineProperty(sequencer,"NOTE_OFF",{value:128}),Object.defineProperty(sequencer,"NOTE_ON",{value:144}),Object.defineProperty(sequencer,"POLY_PRESSURE",{value:160}),Object.defineProperty(sequencer,"CONTROL_CHANGE",{value:176}),Object.defineProperty(sequencer,"PROGRAM_CHANGE",{value:192}),Object.defineProperty(sequencer,"CHANNEL_PRESSURE",{value:208}),Object.defineProperty(sequencer,"PITCH_BEND",{value:224}),Object.defineProperty(sequencer,"SYSTEM_EXCLUSIVE",{value:240}),Object.defineProperty(sequencer,"MIDI_TIMECODE",{value:241}),Object.defineProperty(sequencer,"SONG_POSITION",{value:242}),Object.defineProperty(sequencer,"SONG_SELECT",{value:243}),Object.defineProperty(sequencer,"TUNE_REQUEST",{value:246}),Object.defineProperty(sequencer,"EOX",{value:247}),Object.defineProperty(sequencer,"TIMING_CLOCK",{value:248}),Object.defineProperty(sequencer,"START",{value:250}),Object.defineProperty(sequencer,"CONTINUE",{value:251}),Object.defineProperty(sequencer,"STOP",{value:252}),Object.defineProperty(sequencer,"ACTIVE_SENSING",{value:254}),Object.defineProperty(sequencer,"SYSTEM_RESET",{value:255}),Object.defineProperty(sequencer,"TEMPO",{value:81}),Object.defineProperty(sequencer,"TIME_SIGNATURE",{value:88}),Object.defineProperty(sequencer,"END_OF_TRACK",{value:47}),sequencer.checkEventType=i,sequencer.midiEventNameByNumber=t,sequencer.midiEventNumberByName=e}(),function(){function e(e,t){t&&t(!1)}function t(e,t,i){var n,o,s,r,a,c,u,l,d,v,b,k,w,E,N,P,S,T,A,I,x;for(t=new Uint8Array(t),n=p(t),e.base64="",e.numTracks=0,o=0,u=n.tracks.length,!0===g.overrulePPQ&&!1===isNaN(g.defaultPPQ)&&g.defaultPPQ>0?(P=g.defaultPPQ/n.header.ticksPerBeat,e.ppq=g.defaultPPQ):(P=1,e.ppq=n.header.ticksPerBeat),E=[],e.tracks=[];o<u;){for(l=n.tracks[o],r=l.length,v=0,b=0,k=-1,a=f(),c=h(),w=[],s=0,A=0,I=0,x=0,{},{},s=0;s<r;s++){switch(d=l[s],b+=d.deltaTime*P,-1===k&&void 0!==d.channel&&(k=d.channel,c.channel=k),S=d.subtype,"noteOn"===S?A++:"noteOff"===S?I++:x++,d.subtype){case"trackName":c.name=d.text;break;case"instrumentName":d.text&&(c.instrumentName=d.text);break;case"noteOn":w.push(m(b,144,d.noteNumber,d.velocity));break;case"noteOff":w.push(m(b,128,d.noteNumber,d.velocity));break;case"endOfTrack":break;case"setTempo":N=6e7/d.microsecondsPerBeat,b===v&&T===S&&(g.debug>=3&&y.info("tempo events on the same tick",s,b,N),E.pop()),void 0===e.bpm&&(e.bpm=N),E.push(m(b,81,N));break;case"timeSignature":b===v&&T===S&&(g.debug>=3&&y.info("time signature events on the same tick",s,b,d.numerator,d.denominator),E.pop()),void 0===e.nominator&&(e.nominator=d.numerator,e.denominator=d.denominator),E.push(m(b,88,d.numerator,d.denominator));break;case"controller":w.push(m(b,176,d.controllerType,d.value));break;case"programChange":w.push(m(b,192,d.programNumber));break;case"channelAftertouch":w.push(m(b,208,d.amount));break;case"pitchBend":w.push(m(b,224,d.value))}T=S,v=b}w.length>0&&(c.addPart(a),a.addEvents(w),e.tracks.push(c),e.numTracks++),o++}e.timeEvents=E,e.autoSize=!0,e.loaded=!0,i(e)}function i(i,n){return void 0!==i.base64?void t(i,r(i.base64),n):void 0!==i.arraybuffer?void t(i,i.arraybuffer,n):void c({url:i.url,responseType:i.responseType,onError:function(){e(i,n)},onSuccess:function(o){if("json"===i.responseType){if(null===o)return void n(!1);if(void 0===o.base64)return e(i,n),void(g.debug&&y.warn("no base64 data"));void 0!==o.name&&void 0===i.name&&(i.name=o.name),void 0!==o.folder&&void 0===i.folder&&(i.folder=o.folder),void 0===i.name&&(i.name=s(i.url).name),i.localPath=void 0!==i.folder?i.folder+"/"+i.name:i.name,t(i,r(o.base64),n)}else void 0===i.name&&(i.name=s(i.url).name),i.localPath=void 0!==i.folder?i.folder+"/"+i.name:i.name,t(i,o,n)}})}function n(t){var i=u(t.localPath,g.storage.midi,!0),n=t.action;i&&"MidiFile"===i.className&&"overwrite"!==n?g.debug>=2&&(y.warn("there is already a midifile at",t.localPath),e(t)):l(t,t.localPath,g.storage.midi)}function o(e){function i(i,o){n.addEventListener("loadend",function(){t({},n.result,function(e){i(e)})}),n.addEventListener("error",function(e){o(e)}),void 0!==e.blob?n.readAsArrayBuffer(e.blob):void 0!==e.arraybuffer?t({},e.arraybuffer,function(e){i(e)}):void 0!==e.base64&&t({},r(e.base64),function(e){i(e)})}var n=new FileReader;this._promise=new Promise(i)}var s,r,a,c,u,l,d,p,h,f,m,v,g=window.sequencer,y=window.console,b=0;v=function(e){this.id="MF"+b+++(new Date).getTime(),this.className="MidiFile",this.url=e.url,this.json=e.json,this.base64=e.base64,this.arraybuffer=e.arraybuffer,this.name=e.name,this.folder=e.folder,void 0!==this.url?this.responseType=this.url.indexOf(".json")===this.url.lastIndexOf(".")?"json":"arraybuffer":void 0===this.name&&void 0===this.folder?(this.name=this.id,this.localPath=this.id):this.localPath=void 0!==this.folder?this.folder+"/"+this.name:this.name},g.addMidiFile=function(e,t){var o,s,r,c,u=a(e);if("object"!==u)return g.debug>=2&&y.warn("can't create a MidiFile with this data",e),!1;if(e.json){if(s=e.json,r=e.name,c=e.folder,"string"===a(s))try{s=JSON.parse(s)}catch(t){return g.debug>=2&&y.warn("can't create a MidiFile with this data",e),!1}if(void 0===s.base64)return g.debug>=2&&y.warn("can't create a MidiFile with this data",e),!1;e={base64:s.base64,name:void 0===r?s.name:r,folder:void 0===c?s.folder:c}}o=new v(e),g.addTask({type:"load midifile",method:i,params:o},function(){n(o),t&&t(o)}),g.startTaskQueue()},g.createMidiFile=function(e){return new o(e)._promise},g.protectedScope.addInitMethod(function(){c=g.protectedScope.ajax,u=g.protectedScope.findItem,l=g.protectedScope.storeItem,d=g.protectedScope.deleteItem,s=g.protectedScope.parseUrl,a=g.protectedScope.typeString,p=g.protectedScope.parseMidiFile,r=g.protectedScope.base64ToBinary,f=g.createPart,h=g.createTrack,m=g.createMidiEvent})}(),function(){var e,t,i,n=window.sequencer,o=window.console,s=0;e=function(e){var i,r,a,c,u,l,d=e.length;if(1===d){if(void 0===(i=e[0]))return void o.error("please provide at least a note on event");this.noteOn=i}else if(2===d){if(i=e[0],r=e[1],void 0===i)return void o.error("please provide at least a note on event");if("MidiEvent"===i.className&&r&"MidiEvent"===r.className){if(i.ticks>=r.ticks)return void o.error("MidiNote has wrong duration");this.noteOn=i,this.noteOff=r}}else{if(4!==d)return void o.error("wrong number of arguments, please consult documentation");if(a=e[0],c=e[1],u=e[2],l=e[3],a&&c&&a>=c)return void o.error("MidiNote has wrong duration");if(u<0||u>127)return void o.error("MidiNote has wrong note number");if(l<0||l>127)return void o.error("MidiNote has wrong velocity");i=t(a,n.NOTE_ON,u,l),r&&(r=t(c,n.NOTE_OFF,u,0))}i.midiNote=this,this.noteOn=i,void 0===r?this.endless=!0:(r.midiNote=this,this.endless=!1,this.noteOff=r,this.durationTicks=r.ticks-i.ticks,this.durationMillis=r.millis-i.millis),this.note=i.note,this.number=i.noteNumber,this.ticks=i.ticks,this.pitch=i.data1,this.velocity=i.velocity,this.id="N"+s+(new Date).getTime(),this.name=i.noteName,this.className="MidiNote",this.type=n.MIDI_NOTE,s++},e.prototype.addNoteOff=function(e){void 0!==this.noteOff&&(o.log(e.ticks,e.noteNumber,this.id,"override note off event"),this.noteOff.midiNote=void 0);var t=this.noteOn;e.midiNote=this,this.endless=!1,this.noteOff=e,this.durationTicks=e.ticks-t.ticks,this.durationMillis=e.millis-t.millis,this.endless=!1},e.prototype.setPitch=function(e){e<0||e>127||(this.noteOn.setPitch(e),!1===this.endless&&this.noteOff.setPitch(e),this.number=this.noteOn.noteNumber,this.name=this.noteOn.noteName,this.pitch=e)},e.prototype.mute=function(e){this.mute=void 0!==e?e:!this.mute},n.protectedScope.addInitMethod(function(){t=n.createMidiEvent,i=n.protectedScope.typeString}),n.createMidiNote=function(){return new e(Array.prototype.slice.call(arguments))}}(),function(){function e(e){var t=e.read(4,!0),i=e.readInt32();return{id:t,length:i,data:e.read(i,!1)}}function t(e){var t={};t.deltaTime=e.readVarInt();var i,r=e.readInt8();if(240==(240&r)){if(255==r){t.type="meta";var a=e.readInt8();switch(i=e.readVarInt(),a){case 0:if(t.subtype="sequenceNumber",2!==i)throw"Expected length for sequenceNumber event is 2, got "+i;return t.number=e.readInt16(),t;case 1:return t.subtype="text",t.text=e.read(i),t;case 2:return t.subtype="copyrightNotice",t.text=e.read(i),t;case 3:return t.subtype="trackName",t.text=e.read(i),o=t.text,t;case 4:return t.subtype="instrumentName",t.text=e.read(i),s=t.text,t;case 5:return t.subtype="lyrics",t.text=e.read(i),t;case 6:return t.subtype="marker",t.text=e.read(i),t;case 7:return t.subtype="cuePoint",t.text=e.read(i),t;case 32:if(t.subtype="midiChannelPrefix",1!==i)throw"Expected length for midiChannelPrefix event is 1, got "+i;return t.channel=e.readInt8(),t;case 47:if(t.subtype="endOfTrack",0!==i)throw"Expected length for endOfTrack event is 0, got "+i;return t;case 81:if(t.subtype="setTempo",3!==i)throw"Expected length for setTempo event is 3, got "+i;return t.microsecondsPerBeat=(e.readInt8()<<16)+(e.readInt8()<<8)+e.readInt8(),t;case 84:if(t.subtype="smpteOffset",5!==i)throw"Expected length for smpteOffset event is 5, got "+i;var c=e.readInt8();return t.frameRate={0:24,32:25,64:29,96:30}[96&c],t.hour=31&c,t.min=e.readInt8(),t.sec=e.readInt8(),t.frame=e.readInt8(),t.subframe=e.readInt8(),t;case 88:if(t.subtype="timeSignature",4!==i)throw"Expected length for timeSignature event is 4, got "+i;return t.numerator=e.readInt8(),t.denominator=Math.pow(2,e.readInt8()),t.metronome=e.readInt8(),t.thirtyseconds=e.readInt8(),t;case 89:if(t.subtype="keySignature",2!==i)throw"Expected length for keySignature event is 2, got "+i;return t.key=e.readInt8(!0),t.scale=e.readInt8(),t;case 127:return t.subtype="sequencerSpecific",t.data=e.read(i),t;default:return t.subtype="unknown",t.data=e.read(i),t}return t.data=e.read(i),t}if(240==r)return t.type="sysEx",i=e.readVarInt(),t.data=e.read(i),t;if(247==r)return t.type="dividedSysEx",i=e.readVarInt(),t.data=e.read(i),t;throw"Unrecognised MIDI event type byte: "+r}var u;0==(128&r)?(u=r,r=n):(u=e.readInt8(),n=r);var l=r>>4;switch(t.channel=15&r,t.type="channel",l){case 8:return t.subtype="noteOff",t.noteNumber=u,t.velocity=e.readInt8(),t;case 9:return t.noteNumber=u,t.velocity=e.readInt8(),0===t.velocity?t.subtype="noteOff":t.subtype="noteOn",t;case 10:return t.subtype="noteAftertouch",t.noteNumber=u,t.amount=e.readInt8(),t;case 11:return t.subtype="controller",t.controllerType=u,t.value=e.readInt8(),t;case 12:return t.subtype="programChange",t.programNumber=u,t;case 13:return t.subtype="channelAftertouch",t.amount=u,t;case 14:return t.subtype="pitchBend",t.value=u+(e.readInt8()<<7),t;default:return t.value=e.readInt8(),t.subtype="unknown",t}}function i(i){var n,s,a,c,u,l,d,p,h,f=[],m=[];if(p=e(i),"MThd"!==p.id||6!==p.length)throw"Bad .mid file - header not found";if(h=r(p.data),n=h.readInt16(),s=h.readInt16(),32768&(a=h.readInt16()))throw"Expressing time division in SMTPE frames is not supported yet";c=a;var v={formatType:n,trackCount:s,ticksPerBeat:c};for(u=0;u<s;u++){if(f[u]=[],m[u]=o,l=e(i),"MTrk"!==l.id)throw"Unexpected chunk - expected MTrk, got "+l.id;for(d=r(l.data);!d.eof();){var g=t(d);f[u].push(g)}}return{header:v,tracks:f,trackNames:m}}var n,o,s,r,a=window.sequencer;window.console;a.protectedScope.parseMidiFile=function(e){return i(r(e))},a.protectedScope.addInitMethod(function(){r=a.protectedScope.createStream})}(),function(){function e(e){function t(t,n){var o,s;if(n=void 0===n||n){for(o="",s=0;s<t;s++,c++)o+=i(e[c]);return o}for(o=[],s=0;s<t;s++,c++)o.push(e[c]);return o}function n(){var t=(e[c]<<24)+(e[c+1]<<16)+(e[c+2]<<8)+e[c+3];return c+=4,t}function o(){var t=(e[c]<<8)+e[c+1];return c+=2,t}function s(t){var i=e[c];return t&&i>127&&(i-=256),c+=1,i}function r(){return c>=e.length}function a(){for(var e=0;;){var t=s();if(!(128&t))return e+t;e+=127&t,e<<=7}}var c=0;return{eof:r,read:t,readInt32:n,readInt16:o,readInt8:s,readVarInt:a}}var t=window.sequencer,i=(window.console,String.fromCharCode);t.protectedScope.createStream=e}(),function(){function e(e){if(!0===S)return void e();S=!0,void 0!==navigator.requestMIDIAccess?navigator.requestMIDIAccess().then(function(i){void 0!==i._jazzInstances?(E.jazz=i._jazzInstances[0]._Jazz.version,E.midi=!0):(E.webmidi=!0,E.midi=!0),b=i,b.onstatechange=t,t(),e()},function(t){N.log("MIDI could not be initialized:",t),e()}):("chrome"===E.browser?N.log("Web MIDI API not enabled"):N.log("Web MIDI API not supported"),e())}function t(e){var t,i;k=[],w=[],t=b.inputs,t.forEach(function(e){k.push({name:e.name,id:e.id}),E.midiInputs[e.id]=e}),k.sort(function(e,t){var i=e.name.toLowerCase(),n=t.name.toLowerCase();return i<n?-1:i>n?1:0}),E.numMidiInputs=k.length,i=b.outputs,i.forEach(function(e){w.push({name:e.name,id:e.id}),E.midiOutputs[e.id]=e}),w.sort(function(e,t){var i=e.name.toLowerCase(),n=t.name.toLowerCase();return i<n?-1:i>n?1:0}),E.numMidiOutputs=w.length}function i(e){y=function(t){s(t,e,this)},m(E.midiInputs,function(t){t.onmidimessage=y,e.midiInputs[t.id]=t}),m(E.midiOutputs,function(t){e.midiOutputs[t.id]=t}),e.numMidiInputs=E.numMidiInputs,e.numMidiOutputs=E.numMidiOutputs}function n(e,t,i){var n,o,s=E.midiInputs[e],r=i.tracks,a=i.numTracks-1;if(t=void 0===t||t,void 0===s)return void(!0===E.debug&&N.log("no midi input with id",e,"found"));for(!1===t?(delete i.midiInputs[e],s.onmidimessage=null,i.numMidiInputs--):void 0!==s&&(i.midiInputs[e]=s,s.onmidimessage=y,i.numMidiInputs++),n=a;n>=0;n--)o=r[n],o.setMidiInput(e,t)}function o(e,t,i){var n,o,s,r=E.midiOutputs[e],a=i.tracks,c=i.numTracks-1;if(t=void 0===t||t,void 0===r)return void(!0===E.debug&&N.log("no midi output with id",e,"found"));for(!1===t?(delete i.midiOutputs[e],i.numMidiOutputs--,s=i.scheduler.lastEventTime+100,r.send([176,123,0],s),r.send([176,121,0],s)):void 0!==r&&(i.midiOutputs[e]=r,i.numMidiOutputs++),n=c;n>=0;n--)o=a[n],o.setMidiOutput(e,t)}function s(e,t,i){var n,o,s,a,c=e.data,u=t.tracks,l=t.numTracks;for(s=g(t.ticks,c[0],c[1],c[2]),n=0;n<l;n++)o=u[n],!0===o.monitor&&void 0!==o.midiInputs[i.id]&&r(s,o,i);void 0!==(a=t.midiEventListeners[s.type])&&m(a,function(e){e(s,i)})}function r(e,t,i){var n,o,s,r=t.song;if(e.recordMillis=1e3*h.currentTime,e.state="recorded",144===e.type)n=v(e),t.recordingNotes[e.data1]=n;else if(128===e.type){if(void 0===(n=t.recordingNotes[e.data1]))return;n.addNoteOff(e),delete t.recordingNotes[e.data1]}(r.prerolling||r.recording)&&"midi"===t.recordEnabled?(144===e.type&&t.song.recordedNotes.push(n),t.recordPart.addEvent(e),t.song.recordedEvents.push(e)):t.enableRetrospectiveRecording&&t.retrospectiveRecording.push(e),o=t.midiEventListeners[e.type],void 0!==o&&m(o,function(t){t(e,i)}),s=t.channel,"any"!==s&&void 0!==s&&!0!==isNaN(s)||(s=0),m(t.midiOutputs,function(t){128!==e.type&&144!==e.type&&176!==e.type||t.send([e.type,e.data1,e.data2])}),!1===t.routeToMidiOut&&(e.track=t,t.instrument.processEvent(e))}function a(e,t){e=P.call(e);var i,n,o=T++,s={},r=[];return n=function(e,t,o){for(t=0;t<o;t++){var r=e[t],a=f(r);"array"===a?n(r,0,r.length):"function"===a?i=r:!1===isNaN(r)?(r=parseInt(r,10),!1!==E.checkEventType(r)&&(s[r]=r)):"string"===a&&!1!==E.checkEventType(r)&&(r=E.midiEventNumberByName(r),s[r]=r)}},n(e,0,e.length),m(s,function(e){void 0===t.midiEventListeners[e]&&(t.midiEventListeners[e]={}),t.midiEventListeners[e][o]=i,r.push(e+"_"+o)}),1===r.length?r[0]:r}function c(e,t){var i;e=e.split("_"),i=e[0],e=e[1],delete t.midiEventListeners[i][e]}function u(){}function l(e,t){var i,n,o=document.createElement("select"),s=e.type,r=e.id||s,a=e.div,c=e.firstOption;return"input"!==s&&"output"!==s?void N.log('please set type to "input" or "output"'):(void 0===c&&(c="input"===s?"choose MIDI in":"choose MIDI out"),o.id=r,n="input"===s?t.midiInputs:t.midiOutputs,!1!==c&&(i=document.createElement("option"),i.value=-1,i.innerHTML=c,o.appendChild(i)),m(n,function(e){i=document.createElement("option"),i.value=e.id,i.innerHTML=e.name,o.appendChild(i)}),a&&a.appendChild(o),o)}function d(e,t){var i,n;if(t===E)for(i=0,n=k.length;i<n;i++)e(t.midiInputs[k[i].id],i);else m(t.midiInputs,function(t){e(t,i)})}function p(e,t){var i,n;if(t===E)for(i=0,n=w.length;i<n;i++)e(t.midiOutputs[w[i].id],i);else m(t.midiOutputs,function(t,i){e(t,i)})}var h,f,m,v,g,y,b,k,w,E=window.sequencer,N=window.console,P=Array.prototype.slice,S=!1,T=0;E.getMidiPortsAsDropdown=function(){l(E)},E.getMidiInputsAsDropdown=function(e){return e=e||{type:"input"},l(e,E)},E.getMidiOutputsAsDropdown=function(e){return e=e||{type:"output"},l(e,E)},E.getMidiInputs=function(e){d(e,E)},E.getMidiOutputs=function(e){p(e,E)},E.protectedScope.addInitMethod(function(){h=E.protectedScope.context,v=E.createMidiNote,g=E.createMidiEvent,f=E.protectedScope.typeString,m=E.protectedScope.objectForEach}),E.protectedScope.initMidi=e,E.protectedScope.initMidiSong=i,E.protectedScope.getMidiInputs=d,E.protectedScope.getMidiOutputs=p,E.protectedScope.setMidiInputSong=n,E.protectedScope.setMidiOutputSong=o,E.protectedScope.addMidiEventListener=a,E.protectedScope.getMidiPortsAsDropdown=l,E.protectedScope.removeMidiEventListener=c,E.protectedScope.removeMidiEventListeners=u,E.protectedScope.handleMidiMessageTrack=r}(),function(){function e(e){var n,o,s,r,a,p,h=[].concat(c,u,l),f=e.tracks,m=e.tracks.length+1;for(h=h.concat(i(m.toString(16),2),d),h=h.concat(t(e.timeEvents,e.durationTicks,"tempo")),n=0,o=f.length;n<o;n++)s=f[n],h=h.concat(t(s.events,e.durationTicks,s.name,s.instrumentId));for(o=h.length,a=new ArrayBuffer(o),p=new Uint8Array(a),n=0;n<o;n++)p[n]=h[n];r=new Blob([p],{type:"application/x-midi",endings:"transparent"}),saveAs(r,e.name)}function t(e,t,s,r){var c,u,l,d,h,f,m=0,v=0,g=[];for(s&&(g.push(0),g.push(255),g.push(3),g=g.concat(n(s.length)),g=g.concat(o(s))),r&&(g.push(0),g.push(255),g.push(4),g=g.concat(n(r.length)),g=g.concat(o(r))),u=0,l=e.length;u<l;u++){if(d=e[u],v=d.ticks-m,v=n(v),g=g.concat(v),128===d.type||144===d.type)h=d.type+d.channel,g.push(h),g.push(d.noteNumber),g.push(d.velocity);else if(81===d.type){g.push(255),g.push(81),g.push(3);var y=Math.round(6e7/d.bpm);g=g.concat(i(y.toString(16),3))}else if(88===d.type){var b=d.denominator;2===b?b=1:4===b?b=2:8===b?b=3:16===b?b=4:32===b&&(b=5),g.push(255),g.push(88),g.push(4),g.push(d.nominator),g.push(b),g.push(a/d.nominator),g.push(8)}m=d.ticks}return v=t-m,v=n(v),g=g.concat(v),g.push(255),g.push(47),g.push(0),f=g.length,c=i(f.toString(16),4),[].concat(p,c,g)}function i(e,t){if(t)for(;e.length/2<t;)e="0"+e;for(var i=[],n=e.length-1;n>=0;n-=2){var o=0===n?e[n]:e[n-1]+e[n];i.unshift(parseInt(o,16))}return i}function n(e){for(var t=127&e;e>>=7;)t<<=8,t|=127&e|128;for(var i=[];;){if(i.push(255&t),!(128&t))break;t>>=8}return i}function o(e){return r.map.call(e,function(e){return e.charCodeAt(0)})}var s=window.sequencer,r=(window.console,Array.prototype),a=s.defaultPPQ,c=["M".charCodeAt(0),"T".charCodeAt(0),"h".charCodeAt(0),"d".charCodeAt(0)],u=[0,0,0,6],l=[0,1],d=i(a.toString(16),2),p=["M".charCodeAt(0),"T".charCodeAt(0),"r".charCodeAt(0),"k".charCodeAt(0)];s.protectedScope.saveToMidiFile=e,s.saveSongAsMidiFile=e}(),function(){function e(e,i,n){void 0!==e&&void 0!==i||c.debug>=c.WARN&&u.warn("please provide an url and a callback method"),o({url:e+"?"+(new Date).getTime(),method:"GET",onError:function(){i(!1)},onSuccess:function(e){i(!0===n?e:t(e))},responseType:"xml"})}function t(e){var t=new DOMParser,o=t.parseFromString(e,"application/xml"),s=o.firstChild.nextSibling.nodeName;return a=o.createNSResolver(null===o.ownerDocument?o.documentElement:o.ownerDocument.documentElement),"score-partwise"===s?i(o):"score-timewise"===s?n(o):(u.log("unknown type",s),!1)}function i(e){for(var t,i,n,o,s,u,l,d,p,h,f,m,v,g,y,b,k,w,E,N,P,S,T,A,I,x,O,M,C,B,_,R,L=e.evaluate("//score-part",e,a,XPathResult.ANY_TYPE,null),V=[],q=[],U={},D=c.defaultPPQ;null!==(t=L.iterateNext());){for(b=e.evaluate("@id",t,a,XPathResult.STRING_TYPE,null).stringValue,y=e.evaluate("part-name",t,a,XPathResult.STRING_TYPE,null).stringValue,x=e.evaluate("midi-instrument/volume",t,a,XPathResult.NUMBER_TYPE,null).numberValue,x=parseInt(x/100*127),R=0,f=c.createTrack(y),m=c.createPart(),f.addPart(m),V.push(f),h=[],i=e.evaluate('//part[@id="'+b+'"]/measure',t,a,XPathResult.ANY_TYPE,null);null!==(n=i.iterateNext());)for(e.evaluate("@number",n,a,XPathResult.NUMBER_TYPE,null).numberValue,k=e.evaluate("attributes/divisions",n,a,XPathResult.NUMBER_TYPE,null).numberValue,isNaN(k)||(C=k),k=e.evaluate("attributes/time/beats",n,a,XPathResult.NUMBER_TYPE,null).numberValue,w=e.evaluate("attributes/time/beat-type",n,a,XPathResult.NUMBER_TYPE,null).numberValue,isNaN(k)||(B=k,_=w,q.push(c.createMidiEvent(R,c.TIME_SIGNATURE,B,_))),o=e.evaluate("*[self::note or self::backup or self::forward]",n,a,XPathResult.ANY_TYPE,null);null!==(s=o.iterateNext());){for(u=!1,l=!1,d=e.evaluate("tie",s,a,XPathResult.ANY_TYPE,null);null!==(p=d.iterateNext());)k=e.evaluate("@type",p,a,XPathResult.STRING_TYPE,null).stringValue,"start"===k?u=!0:"stop"===k&&(l=!0);if(O=e.evaluate("rest",s,a,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,M=e.evaluate("chord",s,a,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,null!==O)T=e.evaluate("duration",s,a,XPathResult.NUMBER_TYPE,null).numberValue,R+=T/C*D;else if("note"===s.nodeName){if(E=e.evaluate("pitch/step",s,a,XPathResult.STRING_TYPE,null).stringValue,N=e.evaluate("pitch/alter",s,a,XPathResult.NUMBER_TYPE,null).numberValue,S=e.evaluate("voice",s,a,XPathResult.NUMBER_TYPE,null).numberValue,P=e.evaluate("pitch/octave",s,a,XPathResult.NUMBER_TYPE,null).numberValue,T=e.evaluate("duration",s,a,XPathResult.NUMBER_TYPE,null).numberValue,e.evaluate("type",s,a,XPathResult.STRING_TYPE,null).stringValue,A=E,""!==E){if(!isNaN(N))switch(N){case-2:A+="bb";break;case-1:A+="b";break;case 1:A+="#";break;case 2:A+="##"}I=r(A,P),v=c.createMidiEvent(R,c.NOTE_ON,I,x),R+=T/C*D,g=c.createMidiEvent(R,c.NOTE_OFF,I,0),null!==M&&(R-=T/C*D),!1===u&&!1===l?h.push(v,g):!0===u&&!1===l?(U[S+"-"+I]=g,h.push(v,g)):!0===u&&!0===l?U[S+"-"+I].ticks+=T/C*D:!1===u&&!0===l&&(U[S+"-"+I].ticks+=T/C*D,delete U[S+"-"+I])}}else"backup"===s.nodeName?(T=e.evaluate("duration",s,a,XPathResult.NUMBER_TYPE,null).numberValue,R-=T/C*D):"forward"===s.nodeName&&(T=e.evaluate("duration",s,a,XPathResult.NUMBER_TYPE,null).numberValue,R+=T/C*D)}m.addEvents(h)}return c.createSong({bpm:110,tracks:V[0],timeEvents:q,useMetronome:!1})}function n(e){return e}var o,s,r,a,c=window.sequencer,u=window.console;c.loadMusicXML=e,c.parseMusicXML=t,c.protectedScope.addInitMethod(function(){o=c.protectedScope.ajax,s=c.protectedScope.typeString,r=c.getNoteNumber})}(),function(){var e,t,i,n,o,s,r,a,c,u=Math.pow;t={sharp:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],flat:["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],"enharmonic-sharp":["B#","C#","C##","D#","D##","E#","F#","F##","G#","G##","A#","A##"],"enharmonic-flat":["Dbb","Db","Ebb","Eb","Fb","Gbb","Gb","Abb","Ab","Bbb","Bb","Cb"]},r=function(){var t,r,u,l,d,p,h=Array.prototype.slice.call(arguments),f=h.length,m=!1,v=!1,g=h[0],y=h[1],b=h[2];return 1!==f||isNaN(g)?1===f&&"string"===e(g)?(t=o(g),t?(u=t[0],r=t[1],l=i(u,r),l?(l<0||l>127)&&(v="please provide a note between C0 and G10"):v=g+" is not a valid note name, please use letters A - G and if necessary an accidental like #, ##, b or bb, followed by a number for the octave"):v=g+" is not a valid note name, please use letters A - G and if necessary an accidental like #, ##, b or bb, followed by a number for the octave"):2!==f||"string"!==e(g)||isNaN(y)?2===f&&"string"===e(g)&&"string"===e(y)?(t=o(g),t?(d=a(y),d||(d=sequencer.noteNameMode,m=y+" is not a valid note name mode, using "+d),u=t[0],r=t[1],l=i(u,r),l?(l<0||l>127)&&(v="please provide a note between C0 and G10"):v=u+" is not a valid note name, please use letters A - G and if necessary an accidental like #, ##, b or bb, followed by a number for the octave",u=n(l,d)[0]):v=g+" is not a valid note name, please use letters A - G and if necessary an accidental like #, ##, b or bb, followed by a number for the octave"):2===f&&"number"===e(g)&&"string"===e(y)?g<0||g>127?v="please provide a note number >= 0 and <= 127":(d=a(y),d||(d=sequencer.noteNameMode,m=y+" is not a valid note name mode, using "+d),l=g,t=n(l,d),u=t[0],r=t[1],u=n(l,d)[0]):3!==f||"string"!==e(g)||isNaN(y)||"string"!==e(b)?v="wrong arguments, please consult documentation":(t=o(g,y),t?(d=a(b),d||(d=sequencer.noteNameMode,m=b+" is not a valid note name mode, using "+d),u=t[0],r=t[1],l=i(u,r),l?(l<0||l>127)&&(v="please provide a note between C0 and G10"):v=u+" is not a valid note name, please use letters A - G and if necessary an accidental like #, ##, b or bb, followed by a number for the octave",u=n(l,d)[0]):v=g+" is not a valid note name, please use letters A - G and if necessary an accidental like #, ##, b or bb, followed by a number for the octave"):(t=o(g,y),t?(u=t[0],r=t[1],l=i(u,r),l?(l<0||l>127)&&(v="please provide a note between C0 and G10"):v=u+" is not a valid note name, please use letters A - G and if necessary an accidental like #, ##, b or bb"):v=g+" is not a valid note name, please use letters A - G and if necessary an accidental like #, ##, b or bb"):g<0||g>127?v="please provide a note number >= 0 and <= 127":(l=g,t=n(l),u=t[0],r=t[1]),v?(console.error(v),!1):(m&&console.warn(m),p=s(l),{name:u,octave:r,fullName:u+r,number:l,frequency:p,blackKey:c(l)})},n=function(e,i){i=i||sequencer.noteNameMode;var n=Math.floor(e/12-1);return[t[i][e%12],n]},i=function(e,i,n){var o,s,r,a;for(o in t)if(t.hasOwnProperty(o))for(n=t[o],r=0,a=n.length;r<a;r+=1)if(n[r]===e){s=r;break}return-1!==s&&s+12+12*i},s=function(e){return sequencer.pitch*u(2,(e-69)/12)},o=function(){var t,i,n,o,s,r=Array.prototype.slice.call(arguments),a=r.length,c=r[0],u=r[1];if(1===a&&"string"===e(c)){for(t=c.length,o="",s="",i=0;i<t;i++)n=c[i],isNaN(n)&&"-"!==n?o+=n:s+=n;""===s&&(s=0)}else{if(2!==a||"string"!==e(c)||isNaN(u))return!1;o=c,s=u}return s=parseInt(s,10),o=o.substring(0,1).toUpperCase()+o.substring(1),[o,s]},a=function(e){var t=!1;switch(e){case"sharp":case"flat":case"enharmonic-sharp":case"enharmonic-flat":t=e}return t},c=function(e){var t;switch(!0){case e%12==1:case e%12==3:case e%12==6:case e%12==8:case e%12==10:t=!0;break;default:t=!1}return t},sequencer.getNoteNumber=function(){var e=r.apply(this,arguments);return!!e&&e.number},sequencer.getNoteName=function(){var e=r.apply(this,arguments);return!!e&&e.name},sequencer.getNoteNameFromNoteNumber=function(e,t){return n(e,t)},sequencer.getNoteOctave=function(){var e=r.apply(this,arguments);return!!e&&e.octave},sequencer.getFullNoteName=function(){var e=r.apply(this,arguments);return!!e&&e.fullName},sequencer.getFrequency=function(){var e=r.apply(this,arguments);return!!e&&e.frequency},sequencer.isBlackKey=function(){var e=r.apply(this,arguments);return!!e&&e.blackKey},Object.defineProperty(sequencer,"SHARP",{value:"sharp"}),Object.defineProperty(sequencer,"FLAT",{value:"flat"}),Object.defineProperty(sequencer,"ENHARMONIC_SHARP",{value:"enharmonic-sharp"}),Object.defineProperty(sequencer,"ENHARMONIC_FLAT",{value:"enharmonic-flat"}),sequencer.createNote=r,sequencer.protectedScope.addInitMethod(function(){e=sequencer.protectedScope.typeString})}(),function(){function e(e,y){var b,k,w,E,N=0;for(k=y.length,y.sort(function(e,t){return e.sortIndex-t.sortIndex}),t(e.timeEvents[0]),E=0;E<k;E++){for(b=y[E],w=b.ticks-N,u+=w;u>=p;)for(c++,u-=p;c>h;)for(c-=h,a++;a>o;)a-=o,r++;switch(b.type){case 81:g=b.bpm,v=b.millis,f=b.millisPerTick,m=b.secondsPerTick;break;case 88:n=b.factor,o=b.nominator,s=b.denominator,h=b.numSixteenth,l=b.ticksPerBar,d=b.ticksPerBeat,p=b.ticksPerSixteenth,v=b.millis;break;default:v+=w*f,i(b)}N=b.ticks}e.lastEventTmp=b}function t(e){g=e.bpm,n=e.factor,o=e.nominator,s=e.denominator,l=e.ticksPerBar,d=e.ticksPerBeat,p=e.ticksPerSixteenth,h=e.numSixteenth,f=e.millisPerTick,m=e.secondsPerTick,v=e.millis,r=e.bar,a=e.beat,c=e.sixteenth,u=e.tick}function i(e){var t,i;t=y.getNiceTime(v),e.bpm=g,e.factor=n,e.nominator=o,e.denominator=s,e.ticksPerBar=l,e.ticksPerBeat=d,e.ticksPerSixteenth=p,e.numSixteenth=h,e.millisPerTick=f,e.secondsPerTick=m,e.millis=b(v*k)/k,e.hour=t.hour,e.minute=t.minute,e.second=t.second,e.millisecond=t.millisecond,e.timeAsString=t.timeAsString,e.timeAsArray=t.timeAsArray,e.bar=r,e.beat=a,e.sixteenth=c,e.tick=u,i=0===u?"000":u<10?"00"+u:u<100?"0"+u:u,e.barsAsString=r+":"+a+":"+c+":"+i,e.barsAsArray=[r,a,c,u],e.state="clean",e.update()}var n,o,s,r,a,c,u,l,d,p,h,f,m,v,g,y=window.sequencer,b=(window.console,Math.round),k=Math.pow(10,y.precision);y.protectedScope.parseEvents=e,y.protectedScope.addInitMethod(function(){})}(),function(){function e(){b=1/d*60/a/r,y=1e3*b}function t(){c=4/l,N=4*c,k=r*c,w=k*u,E=r/4}function i(i){var s,r,c,d=0;if(void 0===i)return P=[],void I.log("reset",P);for(n(i),e(),t(),P.sort(function(e,t){return e.ticks-t.ticks}),d=0;d<S;d++){for(r=P[d],r.song=i,s=r.ticks-v,m+=s,v=r.ticks,c=r.type,g+=s*y;m>=E;)for(f++,m-=E;f>N;)for(f-=N,h++;h>u;)h-=u,p++;switch(c){case 81:a=r.bpm,e();break;case 88:u=r.nominator,l=r.denominator,t();break;default:continue}o(r)}i.lastEventTmp=r}function n(e){d=e.playbackSpeed,P=e.timeEvents,S=P.length,r=e.ppq,a=e.bpm,u=e.nominator,l=e.denominator,T=0,p=1,h=1,f=1,m=0,v=0,g=0}function o(e){e.bpm=a,e.nominator=u,e.denominator=l,e.ticksPerBar=w,e.ticksPerBeat=k,e.ticksPerSixteenth=E,e.factor=c,e.numSixteenth=N,e.secondsPerTick=b,e.millisPerTick=y,e.ticks=v,e.millis=g,e.seconds=g/1e3,e.bar=p,e.beat=h,e.sixteenth=f,e.tick=m;var t=0===m?"000":m<10?"00"+m:m<100?"0"+m:m;e.barsAsString=p+":"+h+":"+f+":"+t,e.barsAsArray=[p,h,f,m];var i=A.getNiceTime(g);e.hour=i.hour,e.minute=i.minute,e.second=i.second,e.millisecond=i.millisecond,e.timeAsString=i.timeAsString,e.timeAsArray=i.timeAsArray}var s,r,a,c,u,l,d,p,h,f,m,v,g,y,b,k,w,E,N,P,S,T,A=window.sequencer,I=window.console;A.protectedScope.parseTimeEvents=i,A.protectedScope.addInitMethod(function(){s=A.createMidiEvent})}(),function(){var e,t,i,n,o,s,r,a,c,u,l,d,p,h,f,m,v=window.sequencer,g=window.console,y=0;m=function(e){this.className="Part",this.id="P"+y+++(new Date).getTime(),this.partIndex=y,this.name=e||this.id,this.events=[],this.eventsById={},this.numEvents=0,this.notes=[],this.notesById={},this.numNotes=0,this.dirtyEvents={},this.dirtyNotes={},this.song=void 0,this.autoSize="right",this.ticks=0,this.millis=0,this.start={ticks:this.ticks,millis:this.millis},this.end={ticks:0,millis:0},this.duration={ticks:0,millis:0},this.startPosition=void 0,this.endPosition=void 0,this.needsUpdate=!1,this.state="clean",this.mute=!1,this.solo=!1,this.keepWhenEmpty=!0},p=function(e,t){e=Array.prototype.slice.call(e);var i,o,s,r=0,c=0,u=e[0],l=[],d=[];if("array"===n(u)){for(c=u.length-1;c>=0;c--)s=u[c],(o=a(s,t))&&l.push(o);r=0===l.length?0:1}for(i=e.length,c=r;c<i;c++)s=e[c],o=a(s,t),o?l.push(o):d.push(s);return 0===l.length?(v.debug&&g.warn("no events added",t.name),!1):(1===d.length&&"array"===n(d[0])&&(d=d[0]),{events:l,config:d})},a=function(e,i){var o=!1;return e?"MidiEvent"===e.className||"AudioEvent"===e.className?o=e:"array"===n(e)&&4===e.length?o=t(e):"string"===n(e)?o=i.eventsById[e]:!1===isNaN(e)&&(o=i.events[e]):o=!1,o},c=function(e,t,i){if(!1!==e){var n,o,s=e.events,r=t.ticks,a=s.length,c=t.track,u=t.eventsById;for(n=0;n<a;n++)o=s[n],o.type===v.END_OF_TRACK||"MidiEvent"!==o.className&&"AudioEvent"!==o.className||("AudioEvent"===o.className&&!0!==t.hasAudioEvents&&(t.hasAudioEvents=!0),void 0!==o.part&&(o=o.clone()),o.part=t,o.partId=t.id,i&&(r+=o.ticks,o.ticks=r),o.track=c,o.trackId=c?c.id:void 0,o.song=void 0,void 0!==c&&(o.song=c.song),"recorded"!==o.state&&(o.state="new"),u[o.id]=o);"new"!==t.state&&(t.state="changed"),t.needsUpdate=!0}},d=function(e,t){if(!1!==e){var i,n,o=e.events,s=e.config[0];for(i=o.length-1;i>=0;i--)n=o[i],n.transpose(s);"new"!==t.state&&void 0!==t.track&&(t.state="changed",t.track.needsUpdate=!0)}},u=function(e,t){if(!1!==e){var i,n,o,s=e.events,r=e.config[0];if(isNaN(r))return void g.warn("Part.moveEvent(s) -> please provide a number");for(i=s.length-1;i>=0;i--)n=s[i],o=n.ticks+r,o<0&&(o=0),n.ticks=o,"new"!==n.state&&(n.state="changed");t.needsUpdate=!0,"new"!==t.state&&t.track&&(t.state="changed",t.track.needsUpdate=!0)}},l=function(e,t){var i,n,o=[];for(i=e.length-1;i>=0;i--)!1!==(n=a(e[i],t))&&(n.part===t?(n.state="removed",n.reset(),o.push(n)):g.warn("can't remove: this event belongs to part",n.part.id));return void 0!==t.track&&(t.track.needsUpdate=!0),t.needsUpdate=!0,o},h=function(e){var t,i,n,o,s=e.notes,r=e.lowestNote,a=e.highestNote;for(n=s.length-1;n>=0;n--)o=s[n],o.setPitch(r+(a-o.number)),t=o.noteOn,i=o.noteOff,t.state="changed",i.state="changed",o.state="changed";e.needsUpdate=!0,"new"!==e.state&&e.track&&(e.state="changed",e.track.needsUpdate=!0)},f=function(e,t){var i,n,o,s,r,a,c=e.notes;for(t=t||e.duration.ticks,a=c.length-1;a>=0;a--)i=c[a],n=i.noteOn,o=i.noteOff,s=t-o.ticks,r=t-n.ticks,n.ticks=s,o.ticks=r,i.ticks=s,n.state="changed",o.state="changed",i.state="changed";e.needsUpdate=!0,"new"!==e.state&&e.track&&(e.state="changed",e.track.needsUpdate=!0)},m.prototype.addEvent=m.prototype.addEvents=function(){var e=p(arguments,this);c(e,this,!1)},m.prototype.addEventsRelative=function(){var e=p(arguments,this);c(e,this,!0)},m.prototype.removeEvent=m.prototype.removeEvents=function(){var e=p(arguments,this);return!1!==e&&l(e.events,this)},m.prototype.moveEvent=m.prototype.moveEvents=function(){var e=p(arguments,this);u(e,this)},m.prototype.moveAllEvents=function(e){u({events:this.events,config:[e]},this)},m.prototype.moveNote=function(e,t){u({events:[e.noteOn,e.noteOff],config:[t]},this)},m.prototype.transposeEvents=function(){var e=p(arguments,this);d(e,this)},m.prototype.transposeAllEvents=function(e){d({events:this.events,config:[e]},this)},m.prototype.transposeNote=function(e,t){d({events:[e.noteOn,e.noteOff],config:[t]},this)},m.prototype.reverseByTicks=function(e){this.needsUpdate&&this.update(),f(this,e)},m.prototype.reverseByPitch=function(){this.needsUpdate&&this.update(),h(this)},m.prototype.findEvents=function(e){return o(this,e)},m.prototype.findNotes=function(e){return s(this,e)},m.prototype.getStats=function(e){return r(this,e)},m.prototype.getIndex=function(){var e,t,i;if(this.track)for(e=this.track.parts,i=this.track.numParts-1;i>=0;i--)if(t=e[i],t.id===this.id)return i;return-1},m.prototype.copy=function(){var e,t,n,o=new m(i(this.name)),s=this.ticks,r=this.eventsById,a=[];o.song=void 0,o.track=void 0,o.trackId=void 0;for(t in r)r.hasOwnProperty(t)&&(n=r[t],e=n.copy(),e.ticks=e.ticks-s,a.push(e));return o.addEvents(a),o},m.prototype.setSolo=function(e){void 0===e&&(e=!this.solo),this.mute=!1,this.solo=e,this.allNotesOff(),this.track&&this.track.setPartSolo(this,e)},m.prototype.allNotesOff=function(){void 0!==this.track&&this.track.instrument.allNotesOffPart(this.id)},m.prototype.reset=function(e,t){var i,n,o=this.eventsById;t&&(this.song=void 0),e&&(this.track=void 0),this.trackId=void 0,this.start.millis=void 0,this.end.millis=void 0;for(i in o)o.hasOwnProperty(i)&&(n=o[i],n.ticks-=this.ticks,n.reset(!1,e,t));this.ticks=0,this.needsUpdate=!0},m.prototype.update=function(){var t,i,n,o,s,r,a,c,u,l=[],d=this,p=this.id,h=this.track,f=this.track?this.track.id:void 0;this.events=[];for(n in this.eventsById)this.eventsById.hasOwnProperty(n)&&(o=this.eventsById[n],"clean"!==o.state&&(this.dirtyEvents[o.id]=o),"removed"!==o.state&&this.events.push(o));for(this.events.sort(function(e,t){return e.sortIndex-t.sortIndex}),t=0,i=this.notes.length;t<i;t++)r=this.notes[t],"removed"===r.noteOn.state||void 0!==r.noteOff&&"removed"===r.noteOff.state?(r.state="removed",this.dirtyNotes[r.id]=r,delete this.notesById[r.id]):("changed"===r.noteOn.state||void 0!==r.noteOff&&"changed"===r.noteOff.state)&&(r.state="changed",this.dirtyNotes[r.id]=r);for(t=0,i=this.events.length;t<i;t++)if(o=this.events[t],s=o.noteNumber,o.type===v.NOTE_ON)void 0===o.midiNote&&(r=e(o),r.part=d,r.partId=p,r.track=h,r.trackId=f,r.state="new",this.notesById[r.id]=r,this.dirtyNotes[r.id]=r,void 0===l[s]&&(l[s]=[]),l[s].push(r));else if(o.type===v.NOTE_OFF)if(void 0===o.midiNote){if(void 0===l[s])continue;var m=l[s].length-1;if(r=l[s][m],void 0!==r.noteOff&&r.durationTicks>0)continue;if(null===r)continue;if(void 0===r.noteOn)continue;"new"!==r.state&&(r.state="changed"),this.dirtyNotes[r.id]=r,r.addNoteOff(o)}else void 0===this.notesById[o.midiNote.id]&&(r=o.midiNote,r.part=d,r.partId=p,r.track=h,r.trackId=f,this.notesById[r.id]=r);this.notes=[],l=null;for(n in this.notesById)this.notesById.hasOwnProperty(n)&&(r=this.notesById[n],this.notes.push(r));if(this.notes.sort(function(e,t){return e.ticks-t.ticks}),this.numEvents=this.events.length,this.numNotes=this.notes.length,a=this.events[0],c=this.events[this.numEvents-1],a)switch(a.ticks<this.ticks&&(this.autoSize="both"),this.autoSize){case"right":this.start.ticks=this.ticks,this.end.ticks=c.ticks,this.duration.ticks=c.ticks-this.start.ticks;break;case"both":this.start.ticks=a.ticks,this.end.ticks=c.ticks,this.duration.ticks=c.ticks-a.ticks}else this.start.ticks=this.ticks,this.end.ticks=this.ticks+100,this.duration.ticks=100;u=this.getStats("noteNumber all"),this.lowestNote=u.min,this.highestNote=u.max,this.ticks=this.start.ticks,"clean"===this.state&&(this.state="changed"),this.needsUpdate=!1},v.createPart=function(){return new m},v.protectedScope.addInitMethod(function(){e=v.createMidiNote,t=v.createMidiEvent,i=v.protectedScope.copyName,n=v.protectedScope.typeString,o=v.findEvent,s=v.findNote,r=v.getStats})}(),function(){var e,t,i,n,o=window.sequencer,s=window.console,r=0;t=function(e,t,i,n){this.id="POS"+r+++(new Date).getTime(),this.song=e,this.type=t||"",this.name=i||this.id,this.data=n||{},this.lastEvent=void 0,this.activeParts=[],this.activeNotes=[],this.activeEvents=[]},t.prototype.set=function(e,t){return this.unit=e,this.currentValue=t,this.eventIndex=0,this.noteIndex=0,this.partIndex=0,this.calculate(),this.data},t.prototype.get=function(){return this.data},t.prototype.update=function(e,t){return 0===t?this.data:(this.unit=e,this.currentValue+=t,this.calculate(),this.data)},t.prototype.updateSong=function(){this.events=this.song.eventsMidiTime,this.numEvents=this.events.length,this.notes=this.song.notes,this.numNotes=this.song.numNotes,this.parts=this.song.parts,this.numParts=this.song.numParts,this.set("millis",this.song.millis||0)},t.prototype.setType=function(e){this.type=e,this.set(this.unit,this.currentValue)},t.prototype.addType=function(e){this.type+=" "+e,this.set(this.unit,this.currentValue)},t.prototype.removeType=function(e){var t=this.type.split(" ");this.type="",t.forEach(function(t){t!==e&&(this.type+=e+" ")}),this.type.trim(),this.set(this.currentValue)},t.prototype.calculate=function(){var e,t,r,a,c,u=[],l=[],d=[],p=[],h=[],f=[];for(e=this.eventIndex;e<this.numEvents&&(t=this.events[e],t[this.unit]<=this.currentValue);e++)t.type!==o.MIDI_NOTE&&t.type!==o.DUMMY_EVENT&&f.push(t),this.lastEvent=t,this.eventIndex++;if(void 0===this.lastEvent&&(this.lastEvent=this.song.timeEvents[0]),c=i(this.song,this.unit,this.currentValue,"all",this.lastEvent),this.data.eventIndex=this.eventIndex,this.data.millis=c.millis,this.data.ticks=c.ticks,-1!==this.type.indexOf("all")){var m=this.data;n(c,function(e,t){m[t]=e})}else-1!==this.type.indexOf("barsbeats")?(this.data.bar=c.bar,this.data.beat=c.beat,this.data.sixteenth=c.sixteenth,this.data.tick=c.tick,this.data.barsAsString=c.barsAsString,this.data.ticksPerBar=c.ticksPerBar,this.data.ticksPerBeat=c.ticksPerBeat,this.data.ticksPerSixteenth=c.ticksPerSixteenth,this.data.numSixteenth=c.numSixteenth):-1!==this.type.indexOf("time")?(this.data.hour=c.hour,this.data.minute=c.minute,this.data.second=c.second,this.data.millisecond=c.millisecond,this.data.timeAsString=c.timeAsString):-1!==this.type.indexOf("percentage")&&(this.data.percentage=c.percentage);if(-1!==this.type.indexOf("events")||-1!==this.type.indexOf("all")){for(this.collectedEvents=f,e=this.activeEvents.length-1;e>=0;e--)t=this.activeEvents[e],81!==t.type&&88!==t.type&&0!==t.state.indexOf("removed")&&void 0!==this.song.eventsById[t.id]&&t[this.unit]<=this.currentValue&&t[this.unit]>this.currentValue-10&&d.push(t);for(this.activeEvents=[].concat(d),e=f.length-1;e>=0;e--)t=f[e],t[this.unit]>this.currentValue-10&&this.activeEvents.push(t);for(this.song.activeEvents={},e=this.activeEvents.length-1;e>=0;e--)t=this.activeEvents[e],this.song.activeEvents[t.id]=t}if(-1!==this.type.indexOf("notes")||-1!==this.type.indexOf("all")){for(e=this.noteIndex;e<this.numNotes&&(r=this.notes[e],r.noteOn[this.unit]<=this.currentValue);e++)h.push(r),this.noteIndex++;for(e=this.activeNotes.length-1;e>=0;e--)r=this.activeNotes[e],0!==r.noteOn.state.indexOf("removed")&&void 0!==this.song.notesById[r.id]&&(void 0!==r.noteOff?r.noteOn[this.unit]<=this.currentValue&&r.noteOff[this.unit]>this.currentValue&&l.push(r):o.debug&&s.warn("note with id",r.id,"has no noteOff event",r.noteOn.track.name));for(this.activeNotes=[].concat(l),e=h.length-1;e>=0;e--)r=h[e],void 0!==r.noteOff?r.noteOff[this.unit]>this.currentValue&&this.activeNotes.push(r):o.debug&&s.warn("note with id",r.id,"has no noteOff event",r.noteOn.track.name);for(this.song.activeNotes={},e=this.activeNotes.length-1;e>=0;e--)r=this.activeNotes[e],this.song.activeNotes[r.id]=r}if(-1!==this.type.indexOf("parts")||-1!==this.type.indexOf("all")){for(e=this.partIndex;e<this.numParts&&(a=this.parts[e],a.start[this.unit]<=this.currentValue);e++)p.push(a),this.partIndex++;for(e=this.activeParts.length-1;e>=0;e--)a=this.activeParts[e],a.start[this.unit]<=this.currentValue&&a.end[this.unit]>this.currentValue&&u.push(a);for(this.activeParts=[].concat(u),e=p.length-1;e>=0;e--)a=p[e],a.end[this.unit]>this.currentValue&&this.activeParts.push(a);for(this.song.activeParts={},e=this.activeParts.length-1;e>=0;e--)a=this.activeParts[e],this.song.activeParts[a.id]=a}!0===this.busy&&(this.busy=!1)},o.protectedScope.createPlayhead=function(e,i,n,o){return new t(e,i,n,o)},o.protectedScope.addInitMethod(function(){i=o.protectedScope.getPosition2,n=o.protectedScope.objectForEach,e=o.debug})}(),function(){function e(e,t,i){var n,o,s=e.timeEvents;for(n=s.length-1;n>=0;n--)if(o=s[n],o[t]<=i)return N=n,o}function t(e,t,i,n,o){return"millis"===t?L(e,i,o):"ticks"===t&&V(e,i,o),"all"===n&&B(),C(e)}var i,n,o,s,r,a,c,u,l,d,p,h,f,m,v,g,y,b,k,w,E,N,P,S,T,A,I,x,O,M,C,B,_,R,L,V,q,U=window.sequencer,D=window.console,F="barsandbeats barsbeats time millis ticks perc percentage",j="barsandbeats barsbeats time millis ticks all",z="all",W=!0;P=function(e,t,i){return W=void 0===i,L(e,t),f},S=function(e,t,i){return W=void 0===i,V(e,t),m},T=function(e,t,i){return t=["barsbeats"].concat(t),_(e,t,"millis",i),m},A=function(e,t,i){return t=["barsbeats"].concat(t),_(e,t,"ticks",i),f},I=function(e,t,i){return W=void 0===i,V(e,t),B(),z="barsandbeats",C()},x=function(e,t,i){return W=void 0===i,L(e,t),B(),z="barsandbeats",C()},L=function(t,i,n){var o=t.lastEvent;return!1===W&&i>o.millis&&(i=o.millis),void 0===n&&(n=e(t,"millis",i)),M(n),n.millis===i?(g=0,v=0):(g=i-n.millis,v=g/d),m+=g,f+=v},V=function(t,i,n){var o=t.lastEvent;return!1===W&&i>o.ticks&&(i=o.ticks),void 0===n&&(n=e(t,"ticks",i)),M(n),n.ticks===i?(v=0,g=0):(v=i-f,g=v*d),f+=v,m+=g},q=function(t,i,n,o,s,a){var p,E,P,S,T=0,A=t.lastEvent;for(!1===W&&i>A.bar&&(i=A.bar),i=O(i),n=O(n),o=O(o),s=O(s,!0),void 0===a&&(a=e(t,"bar",i)),M(a);s>=l;)o++,s-=l;for(;o>h;)n++,o-=h;for(;n>r;)i++,n-=r;for(a=e(t,"bar",i),T=N;T>=0;T--)if(a=t.timeEvents[T],a.bar<=i){M(a);break}S=s-w,P=o-k,E=n-b,p=i-y,g=p*u*d,g+=E*c*d,g+=P*l*d,g+=S*d,v=g/d,y=i,b=n,k=o,w=s,m+=g,f+=v},B=function(){for(var e=i(v);e>=l;)for(k++,e-=l;k>h;)for(k-=h,b++;b>r;)b-=r,y++;w=i(e)},M=function(e){s=e.bpm,r=e.nominator,a=e.denominator,u=e.ticksPerBar,c=e.ticksPerBeat,l=e.ticksPerSixteenth,h=e.numSixteenth,d=e.millisPerTick,p=e.secondsPerTick,y=e.bar,b=e.beat,k=e.sixteenth,w=e.tick,f=e.ticks,m=e.millis},C=function(e){var t,n,o={};switch(z){case"millis":o.millis=i(1e3*m)/1e3,o.millisRounded=i(m);break;case"ticks":o.ticks=i(f);break;case"barsbeats":case"barsandbeats":o.bar=y,o.beat=b,o.sixteenth=k,o.tick=w,n=0===w?"000":w<10?"00"+w:w<100?"0"+w:w,o.barsAsString=y+":"+b+":"+k+":"+n;break;case"time":t=U.getNiceTime(m),o.hour=t.hour,o.minute=t.minute,o.second=t.second,o.millisecond=t.millisecond,o.timeAsString=t.timeAsString;break;case"all":o.millis=i(1e3*m)/1e3,o.millisRounded=i(m),o.ticks=i(f),o.bar=y,o.beat=b,o.sixteenth=k,o.tick=w,n=0===w?"000":w<10?"00"+w:w<100?"0"+w:w,o.barsAsString=y+":"+b+":"+k+":"+n,t=U.getNiceTime(m),o.hour=t.hour,o.minute=t.minute,o.second=t.second,o.millisecond=t.millisecond,o.timeAsString=t.timeAsString,o.bpm=i(s*e.playbackSpeed,3),o.nominator=r,o.denominator=a,o.ticksPerBar=u,o.ticksPerBeat=c,o.ticksPerSixteenth=l,o.numSixteenth=h,o.millisPerTick=d,o.secondsPerTick=p,o.percentage=f/e.durationTicks}return o},O=function(e,t){return e=isNaN(e)?t?0:1:e,e=i(e),e=t?e<0?0:e:e<1?1:e},R=function(e){if(z="all",W=!0,"array"===o(e)){var t,i,n,s,r=e.length;if(E=e[0],"array"===o(e[0])&&(e=e[0],E=e[0],r=e.length),t=[E],-1!==F.indexOf(E)){for(i=1;i<r;i++)if(!0===(n=e[i])||!1===n)W=n;else if(isNaN(n)){if(-1===j.indexOf(n))return!1;z=n}else t.push(n);return(2===(s=t.length)||3===s||5===s)&&t}}return!1},_=function(e,t){var i,o,s,r=R(t);if(!1===r)return D.error("wrong position data"),!1;switch(E){case"barsbeats":case"barsandbeats":return q(e,r[1],r[2],r[3],r[4]),C(e);case"time":return i=0,o=r[1]||0,i+=60*o*60*1e3,o=r[2]||0,i+=60*o*1e3,o=r[3]||0,i+=1e3*o,o=r[4]||0,i+=o,L(e,i),B(),C(e);case"millis":return L(e,r[1]),B(),C(e);case"ticks":return V(e,r[1]),B(),C(e);case"perc":case"percentage":return s=r[2],f=r[1]*e.durationTicks,void 0!==s&&(f=n(f/s)*s),V(e,f),B(),o=C(e)}return!1},U.protectedScope.getPosition=_,U.protectedScope.getPosition2=t,U.protectedScope.checkPosition=R,U.protectedScope.millisToTicks=P,U.protectedScope.ticksToMillis=S,U.protectedScope.ticksToBars=I,U.protectedScope.millisToBars=x,U.protectedScope.barsToTicks=A,U.protectedScope.barsToMillis=T,U.protectedScope.addInitMethod(function(){i=U.protectedScope.round,n=U.protectedScope.floor,o=U.protectedScope.typeString})}(),function(){var e,t,i,n,o,s,r,a,c,u,l,d,p,h,f=window.sequencer,m=window.console,v=function(t){this.id=o(),this.output=e.createGainNode(),this.output.connect(t.track.input),this.buffer=t.buffer,this.buffer&&(this.duration=this.buffer.duration),this.noteNumber=t.noteNumber,this.stopCallback=function(){},this.track=t.track};a=function(e,t){e.source.onended=function(){e.stopCallback(e)},t=t||0;try{e.source.stop(t)}catch(e){m.log(e)}},c=function(t){var i,n,o,s=e.currentTime;if(t.release_duration>0)try{switch(t.releaseEnvelope){case"linear":t.output.gain.linearRampToValueAtTime(t.volume,s),t.output.gain.linearRampToValueAtTime(0,s+t.releaseDuration);break;case"equal power":i=r(100,"fadeOut",t.volume),t.output.gain.setValueCurveAtTime(i,s,t.releaseDuration);break;case"array":for(o=t.releaseEnvelopeArray.length,i=new Float32Array(o),n=0;n<o;n++)i[n]=t.releaseEnvelopeArray[n]*t.volume;t.output.gain.setValueCurveAtTime(i,s,t.releaseDuration)}}catch(e){m.error(t.id,e)}},v.prototype.addData=function(e){this.sourceId=e.sourceId,this.noteName=e.noteName,this.midiNote=e.midiNote},v.prototype.createSource=function(){this.source=e.createBufferSource(),this.source.buffer=this.buffer},v.prototype.route=function(){this.source.connect(this.output)},v.prototype.start=function(e){if(void 0!==this.source)return void m.error("this should never happen");this.volume=e.velocity/127,this.output.gain.value=this.volume,this.createSource(),this.phase="decay",this.route(),!0===i&&(this.source.start=this.source.noteOn,this.source.stop=this.source.noteOff);try{this.source.start(e.time,e.offset||0,e.duration||this.duration)}catch(e){m.warn(e)}},v.prototype.stop=function(e,t){if(void 0===this.source)return void(f.debug&&m.log("Sample.stop() source is undefined"));0!==e&&void 0!==e||(e=f.getTime()),this.stopCallback=t||function(){},this.release?(this.source.loop=!1,this.startReleasePhase=e,this.stopTime=e+this.releaseDuration):a(this,e)},v.prototype.unschedule=function(i,n){var o=e.currentTime,s=this,r=null===i?100:i;this.source.onended=void 0;try{this.output.gain.cancelScheduledValues(0),this.output.gain.linearRampToValueAtTime(0,o+r/1e3),t["unschedule_"+this.id]={time:o+r/1e3,execute:function(){if(!s)return void m.log("sample is gone");s.panner&&s.panner.node.disconnect(0),void 0!==s.source&&(s.source.disconnect(0),s.source=void 0),n&&n(s)}}}catch(e){m.log(e)}},v.prototype.update=function(t){var i="Sonata # 3"===this.track.name&&this.track.song.bar>=6&&this.track.song.bar<=10;this.autopan&&this.panner.setPosition(t),void 0!==this.startReleasePhase&&e.currentTime>=this.startReleasePhase&&"decay"===this.phase?(!0===i&&m.log(this.phase,"-> release",this.releaseDuration),this.phase="release",c(this)):void 0!==this.stopTime&&e.currentTime>=this.stopTime&&"release"===this.phase&&(!0===i&&m.log(this.phase,"-> stopped",this.stopTime,e.currentTime),this.phase="stopped",a(this))},f.createSample=function(e){return e.oscillator?new u(e):e.sustain&&e.release&&e.panning?new h(e):e.release&&e.panning?new p(e):e.release&&e.sustain?new d(e):e.release?new l(e):new v(e)},f.protectedScope.addInitMethod(function(){var a=f.protectedScope.createClass;e=f.protectedScope.context,t=f.protectedScope.timedTasks,r=f.util.getEqualPowerCurve,i=f.legacy,o=f.protectedScope.getSampleId,n=f.protectedScope.typeString,s=f.createPanner,l=a(v,function(e){this.release=!0,this.releaseDuration=e.release_duration/1e3,this.releaseEnvelope=e.release_envelope}),d=a(v,function(e){this.release=!0,this.sustainStart=e.sustain_start/1e3,this.sustainEnd=e.sustain_end/1e3,this.releaseDuration=e.release_duration/1e3,this.releaseEnvelope=e.release_envelope,void 0===this.releaseEnvelope?this.releaseEnvelope="equal power":"array"===n(this.releaseEnvelope)&&(this.releaseEnvelopeArray=e.release_envelope_array,this.releaseEnvelope="array")}),d.prototype.route=function(){this.source.loop=!0,this.source.loopStart=this.sustainStart,this.source.loopEnd=this.sustainEnd,this.source.connect(this.output)},p=a(v,function(e){this.release=!0,this.releaseDuration=e.release_duration/1e3,this.releaseEnvelope=e.release_envelope,void 0===this.releaseEnvelope?this.releaseEnvelope="equal power":"array"===n(this.releaseEnvelope)&&(this.releaseEnvelopeArray=e.release_envelope_array,this.releaseEnvelope="array"),this.panPosition=e.panPosition}),p.prototype.route=function(){this.panner=s(),this.panner.setPosition(this.panPosition||0),this.source.connect(this.panner.node),this.panner.node.connect(this.output)},h=a(v,function(e){this.release=!0,this.sustainStart=e.sustain_start/1e3,this.sustainEnd=e.sustain_end/1e3,this.releaseDuration=e.release_duration/1e3,this.releaseEnvelope=e.release_envelope,void 0===this.releaseEnvelope?this.releaseEnvelope="equal power":"array"===n(this.releaseEnvelope)&&(this.releaseEnvelopeArray=e.release_envelope_array,this.releaseEnvelope="array"),this.panPosition=e.panPosition}),h.prototype.route=function(){this.source.loop=!0,this.source.loopStart=this.sustainStart,this.source.loopEnd=this.sustainEnd,this.panner=s(),this.panner.setPosition(this.panPosition||0),this.source.connect(this.panner.node),this.panner.node.connect(this.output)},u=a(v,function(e){this.release=!0,this.panPosition=0,this.autopan=e.autopan||!1,this.frequency=e.event.frequency,this.waveForm=e.wave_form||0,this.releaseDuration=e.release_duration/1e3||1.5,this.releaseEnvelope=e.release_envelope||"equal power"}),u.prototype.createSource=function(){this.source=e.createOscillator(),this.source.type=this.waveForm,this.source.frequency.value=this.frequency},u.prototype.route=function(){this.volume*=.3,this.output.gain.value=this.volume,this.autopan?(this.panner=s(),this.panner.setPosition(0),this.source.connect(this.panner.node),this.panner.node.connect(this.output)):this.source.connect(this.output)}})}(),function(){function e(e,t){var i,n,o,s,r,a,c,u,l,d,p,h=t.mapping;e.samples=[],e.samplesById={},l=t.remote_path,l=void 0!==l&&l;for(i in h)h.hasOwnProperty(i)&&(d={id:i,folder:e.folder+"/"+e.name},!1!==l?(n=h[i],0===n.indexOf("http://")||0===n.indexOf("https://")?d.url=n:(s=n,a=n.lastIndexOf("/"),-1!==a&&(s=n.substring(a+1)),o=n.substring(0,a),c=n.lastIndexOf("."),p=t.extension,-1!==c&&(r=n.substring(c+1),r.length>=3&&r.length<=4&&(p=r,s=n.substring(a,c))),n=l+"/"+o+"/"+s+"."+p,n=n.replace(/\/{2,}/g,"/"),n=n.replace(/^\//,""),n=n.replace(/$\//,""),d.url=n)):(u=h[i],void 0!==u.d?(d.base64=h[i].d,void 0!==u.s&&(d.sustain=u.s),void 0!==u.r&&(d.release=u.r)):d.base64=h[i],e.samplesById[i]=d),e.samples.push(d))}function t(e,t){s(e.samples,function(e){},function(){e.loaded=!0,e.parseTime=g,w.debug>=2&&E.info("parsing",e.name,"took",1e3*g,"ms"),t&&t(!0)})}function i(e,t){e.reset(),e=void 0,t(!1)}function n(e){var t,i,n,o=u(e.localPath,w.storage.samplepacks,!0),s=e.action;if(o&&"SamplePack"===o.className)if("overwrite"===s)for(i=o.samples,t=i.length-1;t>=0;t--)n=i[t],d(n.name+"/"+n.folder,w.storage.audio);else{if("append"!==s)return w.debug>=2&&E.warn("there is already a samplepack at",e.localPath),!1;for(i=o.samples,t=i.length-1;t>=0;t--)e.samples.push(i[t])}return l(e,e.localPath,w.storage.samplepacks),!0}function o(o,s){!0!==o.hasMapping?c({url:o.url,responseType:"json",onError:function(){i(o,s)},onSuccess:function(r){return null===r?void s(!1):void 0===r.mapping?(w.debug>=2&&E.warn("can't create a SamplePack with this data",r),void i(o,s)):(void 0!==r.name&&void 0===o.name&&(o.name=r.name),void 0!==r.folder&&void 0===o.folder&&(o.folder=r.folder),void 0===o.name&&(o.name=h(o.url).name),o.action=r.action,o.localPath=void 0!==o.folder?o.folder+"/"+o.name:o.name,void(!0===n(o)?(e(o,r),t(o,s)):s(!1)))}}):!0===n(o)?t(o,s):s(!1)}function s(e,t,i){function n(c){l(c,y+"/"+b,v.audio),t&&t(c),o++,o<s?(a=e[o],r(a,n)):i()}var o=0,s=e.length,a=e[o];r(a,n)}function r(e,t){var i,n=e.url,o=e.base64;b=e.id,y=e.folder,i=u(y+"/"+b,v.audio,!0),!1!==i?t(i):o?("TWAAAP"!==o?(i=f(o),a(i,t)):t(i),e.base64=""):n?c({url:n,responseType:"arraybuffer",onError:function(){t()},onSuccess:function(e){a(e,t)}}):E.error("could not load sample",y+"/"+b)}function a(e,t){var i=w.getTime();if(null!==e)try{m.decodeAudioData(e,function(e){g+=w.getTime()-i,t(e)},function(e){E.log("error decoding audiodata",b,e),t()})}catch(e){E.log(b,e),t()}}var c,u,l,d,p,h,f,m,v,g,y,b,k,w=window.sequencer,E=window.console,N=0;k=function(t){this.id="SP"+N+++(new Date).getTime(),this.className="SamplePack",this.loaded=!1,this.loadTime=0,this.parseTime=g=0,this.url=t.url,this.name=t.name,this.folder=t.folder,this.info=t.info||t.samplepack_info,this.author=t.author||t.samplepack_author,this.license=t.license||t.samplepack_license,this.compression=t.compression||t.samplepack_compression,void 0===this.compression&&void 0!==t.compression_type&&(this.compression=t.compression_type+" "+t.compression_level),this.pack=t.pack,this.filesize=t.filesize,void 0===this.filesize&&void 0!==this.pack&&(this.filesize=this.pack.filesize),t.mapping?(void 0===this.name&&void 0===this.folder?(this.name=this.id,this.localPath=this.id):this.localPath=void 0!==this.folder?this.folder+"/"+this.name:this.name,this.hasMapping=!0,this.action=t.action,e(this,t)):t.url&&(this.url=t.url)},k.prototype.reset=function(){this.samples=[]},w.addSamplePack=function(e,t,i){var n,s,r,a,c=p(e);if(i=void 0!==i&&i,"object"!==c)return w.debug>=2&&E.warn("can't create a SamplePack with this data",e),!1;if(e.json){if(s=e.json,r=e.name,a=e.folder,"string"===p(s))try{s=JSON.parse(s)}catch(t){return w.debug>=2&&E.warn("can't create a SamplePack with this data",e),!1}if(void 0===s.mapping)return w.debug>=2&&E.warn("can't create a SamplePack with this data",e),!1;e={mapping:s.mapping,name:void 0===r?s.name:r,folder:void 0===a?s.folder:a}}n=new k(e),w.addTask({type:"load sample pack",method:o,params:n},function(e){t&&(!1===e?(n=null,t(null)):t(n))},i),w.startTaskQueue()},w.protectedScope.addInitMethod(function(){v=w.storage,c=w.protectedScope.ajax,m=w.protectedScope.context,u=w.protectedScope.findItem,h=w.protectedScope.parseUrl,l=w.protectedScope.storeItem,d=w.protectedScope.deleteItem,p=w.protectedScope.typeString,f=w.protectedScope.base64ToBinary})}(),function(){function e(i,n,o,s){var r;for(n=0;n<o;n++)void 0!==(r=i[n])&&("MidiEvent"===r.className?s.push(r):"MidiNote"===r.className?s.push(r.noteOn):"array"===t(r)&&e(r,0,r.length))}var t,i,n,o=window.sequencer;window.console;n=function(e){this.song=e,this.looped=!1,this.notes={},this.audioEvents={}},n.prototype.updateSong=function(){this.events=this.song.eventsMidiAudioMetronome,this.numEvents=this.events.length,this.index=0,this.maxtime=0,this.notes={},this.audioEvents=this.song.audioEvents,this.numAudioEvents=this.audioEvents.length,this.scheduledAudioEvents={},this.looped=!1,this.setIndex(this.song.millis)},n.prototype.setIndex=function(e){var t;for(t=0;t<this.numEvents;t++)if(this.events[t].millis>=e){this.index=t;break}this.beyondLoop=!1,e>this.song.loopEnd&&(this.beyondLoop=!0),this.scheduledAudioEvents={}},n.prototype.getDanglingAudioEvents=function(e,t){var i,n,o=0;for(i=0;i<this.numAudioEvents;i++)n=this.audioEvents[i],n.millis<e&&n.endMillis>e?(n.playheadOffset=e-n.millis,n.time=this.startTime+n.millis-this.songStartMillis+n.playheadOffset,n.playheadOffset/=1e3,this.scheduledAudioEvents[n.id]=n,t.push(n),o++):n.playheadOffset=0;return t},n.prototype.getEvents=function(){var e,t,i,n,s,r,a,c,u,l,d=[];if(u=1e3*o.bufferTime,!0===this.song.doLoop&&this.song.loopDuration<u&&(this.maxtime=this.songMillis+this.song.loopDuration-1),!0===this.song.doLoop)if(this.maxtime>=this.song.loopEnd&&!1===this.beyondLoop){if(c=this.maxtime-this.song.loopEnd,this.maxtime=this.song.loopStart+c,!1===this.looped){for(this.looped=!0,e=this.index;e<this.numEvents&&(t=this.events[e],t.millis<this.song.loopEnd);e++)t.time=this.startTime+t.millis-this.songStartMillis,d.push(t),this.index++;a=this.song.loopEndTicks-1,r=this.song.getPosition("ticks",a).millis;for(e in this.notes)if(this.notes.hasOwnProperty(e)){if(i=this.notes[e],n=i.noteOn,s=i.noteOff,s.millis<=this.song.loopEnd)continue;t=o.createMidiEvent(a,128,n.data1,0),t.millis=r,t.part=n.part,t.track=n.track,t.midiNote=n.midiNote,t.time=this.startTime+t.millis-this.songStartMillis,d.push(t)}for(e in this.scheduledAudioEvents)this.scheduledAudioEvents.hasOwnProperty(e)&&(l=this.scheduledAudioEvents[e],l.endMillis>this.song.loopEnd&&(l.stopSample(this.song.loopEnd/1e3),delete this.scheduledAudioEvents[e]));this.notes={},this.setIndex(this.song.loopStart),this.song.startTime+=this.song.loopDuration,this.startTime=this.song.startTime,this.getDanglingAudioEvents(this.song.loopStart,d)}}else this.looped=!1;for(!0===this.firstRun&&(this.getDanglingAudioEvents(this.song.millis,d),this.firstRun=!1),e=this.index;e<this.numEvents&&(t=this.events[e],t.millis<this.maxtime);e++)t.time=this.startTime+t.millis-this.songStartMillis,144===t.type||128===t.type?void 0!==t.midiNote&&void 0!==t.midiNote.noteOff&&(144===t.type?this.notes[t.midiNote.id]=t.midiNote:128===t.type&&delete this.notes[t.midiNote.id],d.push(t)):"audio"===t.type?(void 0!==this.scheduledAudioEvents[t.id]&&(l=this.scheduledAudioEvents[t.id],void 0!==l.sample&&void 0!==l.sample.source&&l.stopSample(0)),this.scheduledAudioEvents[t.id]=t,t.time=t.time+1e3*t.playheadOffset,d.push(t)):d.push(t),this.index++;return d},n.prototype.update=function(){var e,t,n,s,r,a;for(this.prevMaxtime=this.maxtime,!0===this.song.precounting?(this.songMillis=this.song.metronome.millis,this.maxtime=this.songMillis+1e3*o.bufferTime,s=[].concat(this.song.metronome.getPrecountEvents(this.maxtime)),this.maxtime>this.song.metronome.endMillis&&(this.songMillis=0,this.maxtime=this.song.millis+1e3*o.bufferTime,this.startTime=this.song.startTime,this.startTime2=this.song.startTime2,this.songStartMillis=this.song.startMillis,s=this.getEvents())):(this.songMillis=this.song.millis,this.maxtime=this.songMillis+1e3*o.bufferTime,this.startTime=this.song.startTime,this.startTime2=this.song.startTime2,this.songStartMillis=this.song.startMillis,s=this.getEvents()),n=s.length,e=0;e<n;e++)t=s[e],void 0===(r=t.track)||!0===t.mute||!0===t.part.mute||!0===t.track.mute||"metronome"===t.track.type&&!1===this.song.useMetronome||(t.time+=r.audioLatency,"audio"===t.type?(t.time/=1e3,r.audio.processEvent(t)):!1===r.routeToMidiOut?(t.time/=1e3,r.instrument.processEvent(t)):(a=r.channel,"any"!==a&&void 0!==a&&!0!==isNaN(a)||(a=0),i(r.midiOutputs,function(e){128===t.type||144===t.type||176===t.type?e.send([t.type+a,t.data1,t.data2],t.time):192!==t.type&&224!==t.type||e.send([t.type+a,t.data1],t.time)}),this.lastEventTime=t.time))},n.prototype.unschedule=function(){var t,i,n,o,s=Array.prototype.slice.call(arguments),r=[];for(e(s,0,s.length,r),t=r.length-1;t>=0;t--)i=r[t],n=i.track,(o=n.instrument)&&o.unscheduleEvent(i)},n.prototype.reschedule=function(){var e,t,i=this.song.numTracks,n=this.song.tracks;for(e=0;e<i;e++)t=n[e],t.instrument.reschedule(this.song)},o.protectedScope.addInitMethod(function(){t=o.protectedScope.typeString,i=o.protectedScope.objectForEach}),o.protectedScope.createScheduler=function(e){return new n(e)}}(),function(){function e(e){E[e.id]=e}function t(e){var t;for(t in e)e.hasOwnProperty(t)&&(e[t]=null)}var i,n,o,s,r,a,c,u,l,d,p,h,f,m,v=window.sequencer,g=window.console,y=Array.prototype.slice,b=0,k={},w=[],E={},N={};v.getSongs=function(){return E},v.deleteSong=function(e){if(void 0!==e&&null!==e&&"Song"===e.className){e.stop(),e.disconnect(d),delete E[e.id];var i,n,o,s,r,a,c;for(i=e.eventsMidiAudioMetronome.length-1;i>=0;i--)c=e.eventsMidiAudioMetronome[i],t(c);for(i=e.timeEvents.length-1;i>=0;i--)c=e.timeEvents[i];for(i=e.numTracks-1;i>=0;i--){for(n=e.tracks[i],void 0!==n.audio&&n.audio.recorder.cleanup(),o=n.numParts-1;o>=0;o--){for(s=n.parts[o],r=s.numNotes-1;r>=0;r--)a=s.notes[r],t(a);t(s),s=null}t(n),n=null}return t(e),e=null,null}},v.getSnapshot=function(e,t){if(void 0===e)return void g.error("song is undefined");t=t||e.id;var i,n,s,r,a,c,u,l=N[t],d=e.activeEvents,p=e.activeNotes,h=e.activeParts,f=[],m=[],v=[];if(void 0!==l){for(i=l.activeEvents,n=l.activeNotes,s=l.activeParts,u=i.length-1;u>=0;u--)r=i[u],void 0===d[r.id]&&void 0!==e.eventsLib[r.id]&&f.push(r);for(u=n.length-1;u>=0;u--)a=n[u],void 0===p[a.id]&&void 0!==e.notesLib[a.id]&&m.push(a);for(u=s.length-1;u>=0;u--)c=s[u],void 0===h[c.id]&&v.push(c)}return l={activeEvents:o(d),activeNotes:o(p),activeParts:o(h),nonActiveEvents:f,nonActiveNotes:m,nonActiveParts:v},N[t]=l,l},h=function(e){var t,i,n,o=v.getTime();for(t in c)c.hasOwnProperty(t)&&(n=c[t],n.time>=o&&(n.execute(),n=null,delete c[t]));for(t in u)u.hasOwnProperty(t)&&u[t]();for(t in l)l.hasOwnProperty(t)&&l[t]();b>=10?(i=(e-f)/1e3,v.diff=i,i>v.bufferTime&&!0===v.autoAdjustBufferTime&&(v.debug&&g.log("adjusted buffertime:"+v.bufferTime+" -> "+i),v.bufferTime=i)):b++,f=e,u={},window.requestAnimationFrame(h)},v.processEvent=v.processEvents=function(){var e,t,n,o,s,c,u,l,d,p,h,f,g=y.call(arguments),b=60;for(m=[],e=function(n,o,s){for(o=0;o<s;o++)t=n[o],l=i(t),void 0!==t&&("midimessageevent"===l?(n=t.data,u=r(0,n[0],n[1],n[2]),m.push(u)):"MidiEvent"===t.className?m.push(t):"array"===l?e(t,0,t.length):"string"===l?d=t:!1===isNaN(t)&&(b=t))},e(g,0,g.length),p=v.createPart(),h=v.createTrack(),h.setInstrument(d),void 0===k[h.instrumentId]?(k[h.instrumentId]=h,h.addPart(p),h.connect(a.destination)):(h=k[h.instrumentId],p=h.parts[0]),p.addEvents(m),h.update(),o=m.length,s=v.getTime(),f=60/b/v.defaultPPQ,n=0;n<o;n++)c=m[n],c.time=s+c.ticks*f+.002,h.instrument.processEvent(c)},v.stopProcessEvent=v.stopProcessEvents=function(){s(k,function(e){e.instrument.allNotesOff(),e=void 0}),k={}},v.play=function(){var t,n,o,s,r,a,c,u,l,d,p=y.call(arguments),h=[],f=[],m=[],g=[],b=[],k=!1;for(o=function(e,t,r,p){for(t=0;t<r;t++)void 0!==(n=e[t])&&("string"===i(n)?d=n:"Song"===n.className?(void 0===c&&(c=n.bpm,u=n.nominator,l=n.denominator),g.push(n)):"Track"===n.className?(void 0===c&&void 0!==(s=n.song)&&(c=s.bpm,u=s.nominator,l=s.denominator),m.push(n)):"Part"===n.className?(void 0===c&&void 0!==(s=n.song)&&(c=s.bpm,u=s.nominator,l=s.denominator),f.push(n)):"MidiEvent"===n.className||"AudioEvent"===n.className?(void 0===c&&void 0!==(a=n.part)&&void 0!==(s=a.song)&&(c=s.bpm,u=s.nominator,l=s.denominator),81===n.type||88===n.type?b.push(n):h.push(n)):"array"===i(n)?o(n,0,n.length,"    "):!0===n||!1===n?k=n:0===n.indexOf("S")&&(s=E[n])&&s.play())},o(p,0,p.length,"  "),t=g.length-1;t>=0;t--)s=g[t],m=m.concat(s.tracks),b=b.concat(s.timeEvents);return f.length>0&&(r=v.createTrack(),r.instrument=d,r.addParts(f),m.push(r)),h.length>0&&(r=v.createTrack(),r.instrument=d,a=v.createPart(),a.addEvents(h),r.addPart(a),m.push(r)),s=v.createSong({bpm:c||120,nominator:u||4,denominator:l||4,timeEvents:b,tracks:m}),e(s),s.play(),s},v.setAnimationFrameType=function(e,t){switch(e=e||"default",e=e.toLowerCase(),t=t||15,e){case"settimeout":window.requestAnimationFrame=function(e){setTimeout(e,t)};break;default:window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.requestAnimationFrame}},v.protectedScope.updateInstruments=function(){var e,t,i,n,o;for(e in E)if(E.hasOwnProperty(e))for(o=E[e],i=o.tracks,t=i.length-1;t>=0;t--)n=i[t],n.instrument.reset()},v.allNotesOff=function(){s(E,function(e){e.allNotesOff()})},window.onblur=function(){!1!==v.pauseOnBlur&&(v.allNotesOff(),w=[],s(E,function(e){!0===e.playing&&(v.debug&&g.log("pause song",e.id),w.push(e),e.pause())}))},window.onfocus=function(){if(!1!==v.pauseOnBlur){var e,t,i,n=w.length;for(i=0;i<n;i++)e=w[i],t=e.millis,e.stop(),e.setPlayhead("millis",t),v.restartOnFocus&&e.play();w=[]}},v.protectedScope.addSong=e,v.protectedScope.addInitMethod(function(){o=v.protectedScope.objectToArray,n=v.protectedScope.isEmptyObject,n=v.protectedScope.isEmptyObject,s=v.protectedScope.objectForEach,c=v.protectedScope.timedTasks,u=v.protectedScope.scheduledTasks,l=v.protectedScope.repetitiveTasks,i=v.protectedScope.typeString,a=v.protectedScope.context,r=v.createMidiEvent,d=v.protectedScope.masterGainNode,p=v.protectedScope.parseTimeEvents,h()})}(),function(){var e,t,i,n,o,s,r,a,c,u,l,d,p,h,f,m,v,g,y,b,k,w,E,N,P,S,T,A,I,x,O,M,C,B,_,R,L,V,q,U,D,F,j,z,W,Q,H,K,X,G,Z,Y,J,$,ee,te,ie=window.sequencer,ne=window.console,oe=Array.prototype.slice,se=0;te=function(s){s=s||{},this.id="S"+se+++(new Date).getTime(),this.name=s.name||this.id,this.className="Song",z(this),this.midiInputs={},this.midiOutputs={},l(this),this.bpm=s.bpm||120,this.ppq=s.ppq||ie.defaultPPQ,this.bars=s.bars||30,this.lastBar=this.bars,this.lowestNote=s.lowestNote||0,this.highestNote=s.highestNote||127,this.pitchRange=this.highestNote-this.lowestNote+1,this.nominator=s.nominator||4,this.denominator=s.denominator||4,this.factor=4/this.denominator,this.ticksPerBeat=this.ppq*this.factor,this.ticksPerBar=this.ticksPerBeat*this.nominator,this.millisPerTick=6e4/this.bpm/this.ppq,this.quantizeValue=s.quantizeValue||"8",this.fixedLengthValue=s.fixedLengthValue||!1,this.positionType=s.positionType||"all",this.useMetronome=s.useMetronome,this.autoSize=void 0===s.autoSize||!0===s.autoSize,this.playbackSpeed=1,this.defaultInstrument=s.defaultInstrument||ie.defaultInstrument,this.recordId=-1,this.autoQuantize=!1,this.loop=s.loop||!1,this.doLoop=!1,this.illegalLoop=!0,this.loopStart=0,this.loopEnd=0,this.loopDuration=0,this.audioRecordingLatency=0,!0!==this.useMetronome&&!1!==this.useMetronome&&(this.useMetronome=!1),this.grid=void 0,s.timeEvents&&s.timeEvents.length>0?(this.timeEvents=[].concat(s.timeEvents),this.tempoEvent=Y(ie.TEMPO,this)[0],this.timeSignatureEvent=Y(ie.TIME_SIGNATURE,this)[0],void 0===this.tempoEvent?(this.tempoEvent=e(0,ie.TEMPO,this.bpm),this.timeEvents.unshift(this.tempoEvent)):this.bpm=this.tempoEvent.bpm,void 0===this.timeSignatureEvent?(this.timeSignatureEvent=e(0,ie.TIME_SIGNATURE,this.nominator,this.denominator),this.timeEvents.unshift(this.timeSignatureEvent)):(this.nominator=this.timeSignatureEvent.nominator,this.denominator=this.timeSignatureEvent.denominator)):(this.tempoEvent=e(0,ie.TEMPO,this.bpm),this.timeSignatureEvent=e(0,ie.TIME_SIGNATURE,this.nominator,this.denominator),this.timeEvents=[this.tempoEvent,this.timeSignatureEvent]),void 0!==s.timeEvents&&void 0!==s.bpm&&this.bpm!==s.bpm&&this.setTempo(s.bpm,!1),void 0===s.timeEvents||void 0===s.nominator&&void 0===s.denominator||this.nominator===s.nominator&&this.denominator===s.denominator||this.setTimeSignature(s.nominator||this.nominator,s.denominator||this.denominator,!1),this.tracks=[],this.parts=[],this.notes=[],this.events=[],this.allEvents=[],this.tracksById={},this.tracksByName={},this.partsById={},this.notesById={},this.eventsById={},this.activeEvents=null,this.activeNotes=null,this.activeParts=null,this.recordedNotes=[],this.recordedEvents=[],this.recordingNotes={},this.numTracks=0,this.numParts=0,this.numNotes=0,this.numEvents=0,this.instruments=[],this.playing=!1,this.paused=!1,this.stopped=!0,this.recording=!1,this.prerolling=!1,this.precounting=!1,this.preroll=!0,this.precount=0,this.listeners={},this.playhead=t(this,this.positionType,this.id,this),this.playheadRecording=t(this,"all",this.id+"_recording"),this.scheduler=n(this),this.followEvent=i(this),this.volume=1,this.gainNode=a.createGainNode(),this.gainNode.gain.value=this.volume,this.metronome=o(this,A),this.connect(),"MidiFile"===s.className&&!1===s.loaded&&ie.debug&&ne.warn("midifile",s.name,"has not yet been loaded!"),s.tracks&&this.addTracks(s.tracks),s.parts&&this.addParts(s.parts),s.events&&this.addEvents(s.events),s.events||s.parts||s.tracks?(void 0===s.bars&&(this.lastBar=0),this.lastEvent=e([this.lastBar,ie.END_OF_TRACK])):this.lastEvent=e([this.bars*this.ticksPerBar,ie.END_OF_TRACK]),this.update(!0),this.numTimeEvents=this.timeEvents.length,this.playhead.set("ticks",0),this.midiEventListeners={}},G=function(e,t){var i=!1;return void 0===e?i=!1:"Part"===i.className?i=e:"string"===R(e)?i=t.partsById[e]:!1===isNaN(e)&&(i=t.parts[e]),i},K=function(e,t){var i=!1;return void 0===e?i=!1:"Track"===e.className?i=e:"string"===R(e)?void 0===(i=t.tracksById[e])&&(i=t.tracksByName[e]):!1===isNaN(e)&&(i=t.tracks[e]),void 0===i&&(i=!1),i},X=function(e,t){var i,n,o=t.tracksById,s=t.tracksByName,r=[];for(i=e.length-1;i>=0;i--)!1!==(n=K(e[i]))&&(void 0!==n.song&&null!==n.song&&(n=n.copy()),n.song=t,n.instrument.song=t,n.quantizeValue=t.quantizeValue,n.connect(t.gainNode),n.state="new",n.needsUpdate=!0,o[n.id]=n,s[n.name]=n,r.push(n.id),j(n.partsById,function(e){e.state="new"}));return r},W=function(e){var t,i,n=[];for(t=e.length-1;t>=0;t--)!1!==(i=K(e[t]))&&(void 0===i.song||i.song===this?(i.state="removed",i.disconnect(this.gainNode),i.reset(),delete this.tracksById[i.id],delete this.tracksByName[i.name],n.push(i)):ne.warn("can't remove: this track belongs to song",i.song.id));return n},Z=function(e){var t,i,n=[];for(i=e.length-1;i>=0;i--)(t=G(e[i],this))&&n.push(t);return n},Y=function(e,t){var i=[];return t.timeEvents.forEach(function(t){t.type===e&&i.push(t)}),i},Q=function(e){var t=1e3*ie.getTime(),i=t-e.timeStamp,n=e.millis+i;if(e.diff=i,e.timeStamp=t,!0===e.precounting)return e.metronome.millis+=i,void e.scheduler.update(i);e.prevMillis=e.millis,e.doLoop&&e.scheduler.looped&&n>=e.loopEnd?(e.followEvent.resetAllListeners(),e.playhead.set("millis",e.loopStart+(n-e.loopEnd)),e.followEvent.update(),e.scheduler.update(),A(e,"loop")):n>=e.durationMillis?(e.playhead.update("millis",e.durationMillis-e.millis),e.followEvent.update(),e.pause(),e.endOfSong=!0,A(e,"end")):(e.playhead.update("millis",i),e.followEvent.update(),e.scheduler.update()),e.jump=!1},te.prototype.remove=function(){ne.warn("Song.remove() is deprecated, please use sequencer.deleteSong()"),ie.deleteSong(this)},te.prototype.play=function(){ie.unlockWebAudio();var e,t;if(this.playing)return void this.pause();this.scheduler.firstRun=!0,this.doLoop=!1===this.illegalLoop&&!0===this.loop,this.endOfSong&&(this.followEvent.resetAllListeners(),this.playhead.set("millis",0),this.scheduler.setIndex(0)),this.timeStamp=1e3*ie.getTime(),this.startTime=this.timeStamp;try{this.startTime2=window.performance.now()}catch(e){ie.debug&&ne.log("window.performance.now() not supported")}this.precounting&&(this.metronome.startTime=this.startTime,this.metronome.startTime2=this.startTime2,this.startTime+=this.metronome.precountDurationInMillis,this.startTime2+=this.metronome.precountDurationInMillis,e=this,t=this.startTime/1e3,u.playAfterPrecount=function(){ie.getTime()>=t&&(e.precounting=!1,e.prerolling=!1,e.recording=!0,e.playing=!0,A(e,"record_start"),A(e,"play"),u.playAfterPrecount=void 0,delete u.playAfterPrecount)}),this.startMillis=this.millis,e=this,e.playhead.update("millis",0),e.followEvent.update(),u[this.id]=function(){Q(e)},this.paused=!1,this.stopped=!1,this.endOfSong=!1,!0!==this.precounting&&(this.playing=!0,A(this,"play"))},te.prototype.pause=function(){return!0===this.recording||!0===this.precounting?void this.stop():this.stopped||this.paused?void this.play():(delete u[this.id],this.allNotesOff(),this.playing=!1,this.paused=!0,void A(this,"pause"))},te.prototype.stop=function(){if(this.stopped)return this.followEvent.resetAllListeners(),this.playhead.set("millis",0),void this.scheduler.setIndex(0);!0!==this.recording&&!0!==this.precounting||this.stopRecording(),delete u[this.id],j(c,function(e,t){0!==t.indexOf("unschedule_")&&0!==t.indexOf("event_")||(null,delete c[t])}),this.allNotesOff(),this.playing=!1,this.paused=!1,this.stopped=!0,this.endOfSong=!1,this.followEvent.resetAllListeners(),this.playhead.set("millis",0),this.scheduler.setIndex(0),A(this,"stop")},te.prototype.adjustLatencyForAllRecordings=function(e){this.audioRecordingLatency=e,this.tracks.forEach(function(t){t.setAudioRecordingLatency(e)})},te.prototype.setAudioRecordingLatency=function(e,t,i){var n,o,s;for(n=this.audioEvents.length-1;n>=0&&(o=this.audioEvents[n],void 0===(s=o.sampleId)||e!==s);n--);o.track.setAudioRecordingLatency(e,t,i)},te.prototype.startRecording=te.prototype.record=function(e){if(!0===this.recording||!0===this.precounting)return void this.stop();var t,i,n=!1,o=!1,s=this;for(this.metronome.precountDurationInMillis=0,this.playing?(this.precount=0,this.recordStartMillis=this.millis):void 0===e?(this.precount=0,this.recordStartMillis=this.millis):(this.setPlayhead("barsbeats",this.bar),this.metronome.createPrecountEvents(e),this.precount=e,this.recordStartMillis=this.millis-this.metronome.precountDurationInMillis),this.recordTimestampTicks=this.ticks,this.recordId="REC"+(new Date).getTime(),this.recordedNotes=[],this.recordedEvents=[],this.recordingNotes={},this.recordingAudio=!1,void 0!==this.keyEditor&&this.keyEditor.prepareForRecording(this.recordId),t=this.numTracks-1;t>=0;t--)i=this.tracks[t],"audio"===i.recordEnabled&&(this.recordingAudio=!0),"audio"===i.recordEnabled?(o=!0,i.prepareForRecording(this.recordId,function(){!1===n&&(n=!0,J.call(s))})):i.prepareForRecording(this.recordId);return!1===o&&J.call(this),this.recordId},J=function(){this.recordTimestamp=1e3*a.currentTime,!1===this.playing?(this.precount>0?(this.precounting=!0,this.prerolling=this.preroll,this.prerolling?A(this,"record_preroll"):A(this,"record_precount")):(this.recording=!0,A(this,"record_start")),this.play()):(this.recording=!0,this.precounting=!1,A(this,"record_start"))},$=function(e,t,i){var n,o=this;e<this.numTracks?(n=this.tracks[e],n.stopRecording(this.recordId,function(s){void 0!==s&&(t[n.name]=s),e++,$.call(o,e,t,i)})):i(t)},te.prototype.stopRecording=function(){if(!1!==this.recording){this.recording=!1,this.prerolling=!1,this.precounting=!1,delete u.playAfterPrecount;var e=this;return $.call(this,0,{},function(t){e.update(),A(e,"recorded_events",t)}),this.update(),A(this,"record_stop"),this.recordId}},te.prototype.undoRecording=function(e){var t,i;if(void 0===e)for(t=this.numTracks-1;t>=0;t--)this.tracks[t].undoRecording(this.recordId);else i=this.tracksByName,j(e,function(e,t){i[t].undoRecording(e)})},te.prototype.getAudioRecordingData=function(e){var t,i,n;for(t=this.audioEvents.length-1;t>=0&&(i=this.audioEvents[t],void 0===(n=i.sampleId)||e!==n);t--);return void 0!==i&&i.track.getAudioRecordingData(e)},te.prototype.quantize=function(){var e,t,i,n,o,s=oe.call(arguments),r=s.length,a={};for(e=0;e<r;e++)i=s[e],n=R(i),"string"===n||"number"===n?o=i:"object"===n&&(a=i);for(e=this.numTracks-1;e>=0;e--)t=this.tracks[e],void 0===o&&(o=t.quantizeValue),ie.quantize(t.events,o,this.ppq,a);return a},te.prototype.undoQuantize=function(e){if(void 0===e)return void(ie.debug>=2&&ne.warn("please pass a quantize history object"));var t,i;for(t=this.numTracks-1;t>=0;t--)i=this.tracks[t],i.undoQuantize(e)},te.prototype.quantizeRecording=function(e){var t,i;for(t=this.numTracks-1;t>=0;t--)i=this.tracks[t],i.recordId===this.recordId&&i.quantizeRecording(e)},te.prototype.setLeftLocator=function(){var e=y(this,oe.call(arguments));void 0!==e&&(this.loopStartPosition=e,this.loopStart=e.millis,this.loopStartTicks=e.ticks),this.illegalLoop=this.loopStart>=this.loopEnd,this.doLoop=!1===this.illegalLoop&&!0===this.loop,this.loopDuration=!0===this.illegalLoop?0:this.loopEnd-this.loopStart},te.prototype.setRightLocator=function(){var e=y(this,oe.call(arguments));this.illegalLoop;void 0!==e&&(this.loopEndPosition=e,this.loopEnd=e.millis,this.loopEndTicks=e.ticks),this.illegalLoop=this.loopEnd<=this.loopStart,this.doLoop=!1===this.illegalLoop&&!0===this.loop,this.loopDuration=!0===this.illegalLoop?0:this.loopEnd-this.loopStart},te.prototype.setLoop=function(e){if(void 0===e)this.loop=!this.loop;else{if(!0!==e&&!1!==e)return void(ie.debug>=1&&ne.error('pass "true", "false" or no value'));this.loop=e}this.doLoop=!1===this.illegalLoop&&!0===this.loop},te.prototype.setPlayhead=function(){this.jump=!0,this.scheduler.looped=!1,this.scheduler.firstRun=!0,this.timeStamp=1e3*ie.getTime(),this.startTime=this.timeStamp;try{this.startTime2=window.performance.now()}catch(e){ie.debug&&ne.log("window.performance.now() not supported")}this.playing&&this.allNotesOff();var e=y(this,oe.call(arguments)),t=e.millis;this.startMillis=t,this.playhead.set("millis",t),this.scheduler.setIndex(t)},te.prototype.addEventListener=function(){return S.apply(this,arguments)},te.prototype.removeEventListener=function(){T.apply(this,arguments)},te.prototype.addEvent=te.prototype.addEvents=function(){var e,t;return e=this.tracks[0],void 0===e&&(e=ie.createTrack(),this.addTrack(e)),e.needsUpdate&&e.update(),t=e.parts[0],void 0===t&&(t=ie.createPart(),e.addPart(t)),t.addEvents.apply(t,arguments),this},te.prototype.addPart=te.prototype.addParts=function(){var e=this.tracks[0];return void 0===e&&(e=ie.createTrack(),this.addTrack(e)),e.addParts.apply(e,arguments),this},te.prototype.addTrack=function(){var e=H(arguments),t=e[0],i=e.length;return("array"===R(t)||i>1)&&(ne.warn("please use addTracks() if you want to get more that one tracks"),e=[t]),X(e,this)[0]},te.prototype.addTracks=function(){return X(H(arguments),this)},te.prototype.getTrack=function(e){return K(e,this)},te.prototype.getTracks=function(){var e,t,i=H(arguments),n=[];for(t=i.length-1;t>=0;t--)(e=K(i[t],this))&&n.push(e);return n},te.prototype.getPart=function(){var e=H(arguments);return e.length>1&&ne.warn("please use getParts() if you want to get more that one part"),Z.call(this,e)[0]},te.prototype.getParts=function(){var e=H(arguments);return Z.call(this,e)},te.prototype.removeTrack=function(){var e=H(arguments);return e.length>1&&ne.warn("please use removeTracks() if you want to remove more that one tracks"),W.call(this,e)[0]},te.prototype.removeTracks=function(){return W.call(this,H(arguments))},te.prototype.setPlaybackSpeed=function(e){if(e<.01||e>100)return void ne.error("playback speed has to be > 0.01 and < 100");var t,i,n,o=this.ticks;this.playbackSpeed=e,this.update(!0),void 0!==this.loopStartTicks&&(t=this.getPosition("ticks",this.loopStartTicks),this.loopStart=t.millis,this.loopStartTicks=t.ticks),void 0!==this.loopEndTicks&&(i=this.getPosition("ticks",this.loopEndTicks),this.loopEnd=i.millis,this.loopEndTicks=i.ticks),n=this.getPosition("ticks",o),this.setPlayhead("ticks",n.ticks)},te.prototype.gridToSong=function(e,t,i,n){return M(this,e,t,i,n)},te.prototype.noteToGrid=function(e,t){return C(e,t,this)},te.prototype.eventToGrid=function(e,t,i){return B(e,t,i,this)},te.prototype.positionToGrid=function(e,t){return _(e,t,this)},te.prototype.getPosition=function(){return y(this,oe.call(arguments))},te.prototype.ticksToMillis=function(e,t){return k(this,e,t)},te.prototype.millisToTicks=function(e,t){return b(this,e,t)},te.prototype.ticksToBars=function(e,t){return w(this,e,t)},te.prototype.millisToBars=function(e,t){return E(this,e,t)},te.prototype.barsToTicks=function(){return N(this,oe.call(arguments))},te.prototype.barsToMillis=function(){return P(this,oe.call(arguments))},te.prototype.findEvent=te.prototype.findEvents=function(e){return D(this,e)},te.prototype.findNote=te.prototype.findNotes=function(e){return F(this,e)},te.prototype.getStats=function(e){return U(this,e)},te.prototype.createGrid=function(e){return void 0===this.grid?this.grid=ee(this,e):this.grid.update(e),this.grid},te.prototype.update=function(e){I(this,e)},te.prototype.updateGrid=function(e){return this.grid.update(e),this.grid},te.prototype.updateTempoEvent=function(e,t){if(e.type!==ie.TEMPO)return void(ie.debug>=4&&ne.error("this is not a tempo event"));if(e.song!==this)return void(ie.debug>=4&&ne.error("this event has not been added to this song yet"));var i=this.ticks;this.percentage;e.bpm=t,this.update(!0),this.updatePlayheadAndLocators(i)},te.prototype.updateTimeSignatureEvent=function(e,t,i){if(e.type!==ie.TIME_SIGNATURE)return void(ie.debug>=4&&ne.error("this is not a time signature event"));if(e.song!==this)return void(ie.debug>=4&&ne.error("this event has not been added to this song yet"));var n=this.ticks;this.percentage;e.nominator=t||e.nominator,e.denominator=i||e.denominator,this.update(!0),this.updatePlayheadAndLocators(n)},te.prototype.getTempoEvents=function(){return Y(ie.TEMPO,this)},te.prototype.getTimeSignatureEvents=function(){return Y(ie.TIME_SIGNATURE,this)},te.prototype.updatePlayheadAndLocators=function(e){var t,i,n,o=this.loopStartPosition,s=this.loopEndPosition;void 0!==o&&(t=this.getPosition("ticks",o.ticks),this.loopStart=t.millis,this.loopStartTicks=t.ticks,this.loopStartPosition=t),void 0!==s&&(i=this.getPosition("ticks",s.ticks),i.ticks>this.durationTicks&&(i=this.getPosition("ticks",this.bars)),this.loopEnd=i.millis,this.loopEndTicks=i.ticks,this.loopEndPosition=i),n=this.getPosition("ticks",e),this.doLoop&&n.ticks>this.durationTicks?this.setPlayhead("ticks",0):this.setPlayhead("ticks",n.ticks),this.loopDuration=!0===this.illegalLoop?0:this.loopEnd-this.loopStart},te.prototype.setTempo=function(e,t){var i,n,o=Y(ie.TEMPO,this),s=this.ticks,r=(this.percentage,e/o[0].bpm);for(i=o.length-1;i>=0;i--)n=o[i],n.bpm=r*n.bpm;this.bpm=e,!1!==t&&(this.update(!0),this.updatePlayheadAndLocators(s))},te.prototype.setTimeSignature=function(e,t,i){var n,o,s=Y(ie.TIME_SIGNATURE,this),r=(this.percentage,this.ticks);for(n=s.length-1;n>=0;n--)o=s[n],o.nominator=e,o.denominator=t;this.nominator=e,this.denominator=t,!1!==i&&(this.update(!0),this.updatePlayheadAndLocators(r))},te.prototype.resetTempo=function(e){var t=Y(ie.TEMPO,this)[0],i=this.timeEvents;t.bpm=e,i=V(i,function(e){return 81===e.type}),this.numTimeEvents=i.length,this.update(!0)},te.prototype.resetTimeSignature=function(e,t){var i=Y(ie.TIME_SIGNATURE,this)[0],n=this.timeEvents,o=this.ticks;i.nominator=e,i.denominator=t,n=V(n,function(e){return 88===e.type}),this.numTimeEvents=n.length,this.update(!0),this.updatePlayheadAndLocators(o)},te.prototype.addTimeEvent=te.prototype.addTimeEvents=function(){var e,t,i,n=H(arguments),o=this.ticks;for(e=n.length-1;e>=0;e--)t=n[e],"MidiEvent"===t.className&&(t.type===ie.TEMPO?this.timeEvents.push(t):t.type===ie.TIME_SIGNATURE&&(i=this.getPosition("ticks",t.ticks),i=i.beat>i.nominator/2?this.getPosition("barsbeats",i.bar+1):this.getPosition("barsbeats",i.bar),t.ticks=i.ticks,this.timeEvents.push(t)));this.numTimeEvents=this.timeEvents.length,this.update(!0),this.updatePlayheadAndLocators(o)},te.prototype.removeTimeEvent=te.prototype.removeTimeEvents=function(){var e,t,i=H(arguments),n=i.length,o=this.ticks,s=[];for(e=0;e<n;e++)(t=i[e])!==this.tempoEvent&&t!==this.timeSignatureEvent&&s.push(t);this.timeEvents=L(s,this.timeEvents),this.numTimeEvents=this.timeEvents.length,this.update(!0),this.updatePlayheadAndLocators(o)},te.prototype.removeDoubleTimeEvents=function(){var e,t,i,n,o=[],s={81:{},88:{}};for(e=this.timeEvents.length-1;e>=0;e--)t=this.timeEvents[e],void 0===s[t.type][t.ticks]&&(n=t.type,i=t.ticks,s[n][i]=t,0===i&&(81===n?this.tempoEvent=t:88===n&&(this.timeSignatureEvent=t)));j(s[81],function(e){o.push(e)}),j(s[88],function(e){o.push(e)}),this.timeEvents=o,this.update(!0)},te.prototype.setPitchRange=function(e,t){var i=this;i.lowestNote=e,i.highestNote=t,i.numNotes=i.pitchRange=i.highestNote-i.lowestNote+1},te.prototype.trim=function(){x(this,!0)},te.prototype.setDurationInBars=function(e){var t=this,i=t.findEvent("bar > "+e),n=[],o=[],s=[],r={},a={};return i.forEach(function(e){var t=e.trackId,i=e.partId;void 0===r[t]&&(r[t]=[]),r[t].push(e),void 0===a[i]&&(a[i]=e.part)}),j(r,function(e,i){var n=t.getTrack(i);n.removeEvents(e),o.push(n)}),j(a,function(e,t){0===e.events.length?(e.track.removePart(e),n.push(e)):s.push(e)}),t.bars=e,t.lastBar=e,{removedEvents:i,removedParts:n,changedTracks:o,changedParts:s}},te.prototype.addEffect=function(){},te.prototype.removeEffect=function(){},te.prototype.setVolume=function(){function e(i,n,o){for(n=0;n<o;n++){var r=i[n],a=R(r);"array"===a?e(r,0,r.length):"number"===a?t=r:"Track"===r.className&&s.push(r)}}var t,i,n=oe.call(arguments),o=n.length,s=[];if(1===o){if(t=n[0],isNaN(t))return void ne.warn("please pass a number");this.volume=t<0?0:t>1?1:t,this.gainNode.gain.value=this.volume}else for(e(n,0,o),i=s.length-1;i>=0;i--)s[i].setVolume(t)},te.prototype.getVolume=function(){return this.gainNode.gain.value},te.prototype.connect=function(){this.gainNode.connect(r)},te.prototype.disconnect=function(){this.gainNode.disconnect(r)},te.prototype.getMidiInputs=function(e){m(e,this)},te.prototype.getMidiOutputs=function(e){v(e,this)},te.prototype.setTrackSolo=function(e,t){var i,n;for(i=this.numTracks-1;i>=0;i--)n=this.tracks[i],!0===t?n.mute=n===e?!t:t:!1===t&&(n.mute=!1),n.solo=n===e&&t},te.prototype.muteAllTracks=function(e){var t,i;for(t=this.numTracks-1;t>=0;t--)i=this.tracks[t],i.mute=e},te.prototype.setMetronomeVolume=function(e){this.metronome.setVolume(e)},te.prototype.configureMetronome=function(e){this.metronome.configure(e)},te.prototype.resetMetronome=function(){this.metronome.reset()},te.prototype.setPrecount=function(e){this.precount=e},te.prototype.allNotesOff=function(){j(this.tracks,function(e){e.allNotesOff()}),this.metronome.allNotesOff(),this.resetExternalMidiDevices()},te.prototype.resetExternalMidiDevices=function(){var e=this.scheduler.lastEventTime+100;isNaN(e)&&(e=100),j(this.midiOutputs,function(t){t.send([176,123,0],e),t.send([176,121,0],e)})},te.prototype.addMidiEventListener=function(){return d(arguments,this)},te.prototype.removeMidiEventListener=function(e){p(e,this)},te.prototype.removeMidiEventListeners=function(){p(arguments,this)},te.prototype.getMidiInputsAsDropdown=function(e){return e=e||{type:"input"},g(e,this)},te.prototype.getMidiOutputsAsDropdown=function(e){return e=e||{type:"output"},g(e,this)},te.prototype.setMidiInput=function(e,t){h(e,t,this)},te.prototype.setMidiOutput=function(e,t){f(e,t,this)},te.prototype.getNoteLengthName=function(e){return q(this,e)},ie.createSong=function(e){return new te(e)},ie.protectedScope.addInitMethod(function(){a=ie.protectedScope.context,c=ie.protectedScope.timedTasks,u=ie.protectedScope.repetitiveTasks,r=ie.protectedScope.masterGainNode,e=ie.createMidiEvent,ee=ie.protectedScope.createGrid,l=ie.protectedScope.initMidiSong,h=ie.protectedScope.setMidiInputSong,f=ie.protectedScope.setMidiOutputSong,m=ie.protectedScope.getMidiInputs,v=ie.protectedScope.getMidiOutputs,d=ie.protectedScope.addMidiEventListener,g=ie.protectedScope.getMidiPortsAsDropdown,p=ie.protectedScope.removeMidiEventListener,y=ie.protectedScope.getPosition,b=ie.protectedScope.millisToTicks,k=ie.protectedScope.ticksToMillis,w=ie.protectedScope.ticksToBars,E=ie.protectedScope.millisToBars,N=ie.protectedScope.barsToTicks,P=ie.protectedScope.barsToMillis,R=ie.protectedScope.typeString,L=ie.protectedScope.removeFromArray,V=ie.protectedScope.removeFromArray2,D=ie.findEvent,F=ie.findNote,U=ie.getStats,M=ie.gridToSong,C=ie.noteToGrid,B=ie.eventToGrid,_=ie.positionToGrid,H=ie.protectedScope.getArguments,j=ie.protectedScope.objectForEach,q=ie.protectedScope.getNoteLengthName,I=ie.protectedScope.update,x=ie.protectedScope.checkDuration,O=ie.protectedScope.addMetronomeEvents,s=ie.protectedScope.followEvent,t=ie.protectedScope.createPlayhead,n=ie.protectedScope.createScheduler,i=ie.protectedScope.createFollowEvent,o=ie.protectedScope.createMetronome,S=ie.protectedScope.songAddEventListener,T=ie.protectedScope.songRemoveEventListener,A=ie.protectedScope.songDispatchEvent,z=ie.protectedScope.addSong})}(),function(){var e,t,i,n,o=window.sequencer,s=window.console,r=Array.prototype.slice,a=0;n=function(){var e,t,i,n=r.call(arguments),o=n.length,s=n[0],a=n[1],c=[];if(o>2)for(e=2;e<o;)c.push(n[e]),e++;if(c.push(s),void 0!==(t=s.listeners[a])&&void 0!==t.length)for(e=t.length-1;e>=0;e--)i=t[e],i.callback.apply(null,c)},t=function(){var e,t=r.call(arguments),i=t[0];switch(i){case"play":case"stop":case"pause":case"end":case"record_start":case"record_stop":case"record_precount":case"record_preroll":case"recorded_events":case"latency_adjusted":case"loop_off":case"loop_on":case"loop":case"sustain_pedal":return void 0===this.listeners[i]&&(this.listeners[i]=[]),e=i+"_"+a++,this.listeners[i].push({id:e,callback:t[1]}),e;case"note":case"event":case"position":return this.followEvent.addEventListener(i,t[1],t[2]);default:s.log(i,"is not a supported event")}},i=function(){var t,i,n,o,a,c=r.call(arguments),u=c[0],l=c[1],d=[];if(-1!==u.indexOf("_")?(t=u.split("_"),i=t[0],n=u):i=u,"array"===e(i))return this.followEvent.removeEventListener(c);switch(i){case"play":case"stop":case"pause":case"end":case"record_start":case"record_stop":case"record_precount":case"record_preroll":case"recorded_events":case"latency_adjusted":case"loop_off":case"loop_on":case"loop":case"sustain_pedal":if((t=this.listeners[i])&&t.length>0){for(o=t.length-1;o>=0;o--)a=t[o],void 0!==n?a.id!==n&&d.push(a):void 0!==l&&a.callback!==l&&d.push(a);this.listeners[i]=[].concat(d)}break;case"note":case"event":case"position":return this.followEvent.removeEventListener(c);default:s.error("unsupported event")}},o.protectedScope.songAddEventListener=t,o.protectedScope.songRemoveEventListener=i,o.protectedScope.songDispatchEvent=n,o.protectedScope.addInitMethod(function(){e=o.protectedScope.typeString})}(),function(){var e,t,i,n,o,s,r,a,c=window.sequencer,u=window.console,l=0,d={bar:1,beat:1,sixteenth:1,tick:0,ticks:1,barsbeats:1,barsandbeats:1,hour:1,minute:1,second:1,millisecond:0,millis:1,time:1},p="= == === > >= < <= != !== %=";new RegExp(" "+p.replace(/\s+/g," | ")+" ");a=function(e){this.song=e,this.allListenersById={},this.allListenersByType={},this.searchPatterns=[],this.eventListenersBySearchstring={},this.positionListenersBySearchstring={},this.allListenersByType={event:{instance:{},searchstring:{}},position:{ticks:[],repetitive:{},conditional_simple:{},conditional_complex:{}}}},a.prototype.updateSong=function(){var t,i,n,o,s,r,a,c,u,d,p=[];c=this.allListenersByType.event.instance;for(o in c)if(c.hasOwnProperty(o)&&void 0===this.song.eventsById[o]){for(p=c[o],t=p.length-1;t>=0;t--)d=p[t],delete this.allListenersById[d];delete this.allListenersByType.event.instance[o]}c=this.allListenersByType.event.searchstring,p=[];for(o in c)c.hasOwnProperty(o)&&(p=p.concat(c[o]));for(t=p.length-1;t>=0;t--)delete this.allListenersById[p[t]];for(this.allListenersByType.event.searchstring={},r=this.allListenersByType.event.searchstring,t=this.searchPatterns.length-1;t>=0;t--)for(a=this.searchPatterns[t],s=e(this.song,a.searchstring),"note"===r.type&&(s=e(s,"type = NOTE_ON OR type = NOTE_OFF")),i=s.length-1;i>=0;i--)n=s[i],d="event_"+l++,u={id:d,event:n,type:a.type,subtype:a.subtype,callback:a.callback},this.allListenersById[d]=u,void 0===r[n.id]&&(r[n.id]=[]),r[n.id].push(d)},a.prototype.update=function(){var e,t,i,n=this.song,o=n.ticks,s=[];for(s=this.song.playhead.collectedEvents,t=s.length,e=0;e<t;e++)i=s[e],this.callEventListeners(i.id,i);this.callListenersPositionTicks(o),n.bar!==this.bar&&(this.bar=n.bar,this.callListenersPositionRepetitive("bar"),this.callListenersPositionConditionalSimple("bar",this.bar),this.callListenersPositionConditionalComplex("bar",this.bar)),n.beat!==this.beat&&(this.beat=n.beat,this.callListenersPositionRepetitive("beat"),this.callListenersPositionConditionalSimple("beat",this.beat),this.callListenersPositionConditionalComplex("beat",this.beat)),n.sixteenth!==this.sixteenth&&(this.sixteenth=n.sixteenth,this.callListenersPositionRepetitive("sixteenth"),this.callListenersPositionConditionalSimple("sixteenth",this.sixteenth),this.callListenersPositionConditionalComplex("sixteenth",this.sixteenth)),n.hour!==this.hour&&(this.hour=n.hour,this.callListenersPositionRepetitive("hour"),this.callListenersPositionConditionalSimple("hour",this.hour),this.callListenersPositionConditionalComplex("hour",this.hour)),n.minute!==this.minute&&(this.minute=n.minute,this.callListenersPositionRepetitive("minute"),this.callListenersPositionConditionalSimple("minute",this.minute),this.callListenersPositionConditionalComplex("minute",this.minute)),n.second!==this.second&&(this.second=n.second,this.callListenersPositionRepetitive("second"),this.callListenersPositionConditionalSimple("second",this.second),this.callListenersPositionConditionalComplex("second",this.second))},a.prototype.callEventListeners=function(e,t){var i,n,o,s,r=[];for(o=this.allListenersByType.event.instance,o[e]&&(r=r.concat(o[e])),o=this.allListenersByType.event.searchstring,o[e]&&(r=r.concat(o[e])),r.length,i=r.length-1;i>=0;i--)n=r[i],s=this.allListenersById[n],!0!==s.called&&(s.called=!0,s.callback(t))},a.prototype.callListenersPositionRepetitive=function(e){var t,i=this.allListenersByType.position.repetitive[e],n=this;i&&i.forEach(function(e){t=n.allListenersById[e],t.callback(t.searchstring)})},a.prototype.callListenersPositionConditionalSimple=function(e,t){var i,n,o,s=!1,r=this.allListenersByType.position.conditional_simple[e],a=this;r&&r.forEach(function(e){switch(i=a.allListenersById[e],n=i.data,o=i.operator){case">":s=t>n;break;case"<":s=t<n;break;case"%=":s=t%n==0;break;case"!=":case"!==":s=t!==n;break;case"===":s=t===n}!0===s&&i.callback(i.searchstring)})},a.prototype.callListenersPositionConditionalComplex=function(e,t){var i,n,o,s,r,a=this.allListenersByType.position.conditional_complex[e],c=this;a&&a.forEach(function(e){i=c.allListenersById[e],n=i.value1,o=i.value2,s=i.operator1,r=i.operator2,"<"===s?(t<n||t>o)&&i.callback(i.searchstring):">"===s&&t>n&&t<o&&i.callback(i.searchstring)})},a.prototype.callListenersPositionTicks=function(e){var t,i,n=this.allListenersByType.position.ticks,o=n.length;for(t=0;t<o;t++)i=this.allListenersById[n[t]],e>=i.ticks&&!i.called&&(i.callback(i.searchstring),i.called=!0)},a.prototype.addEventListener=function(i,n,o){var r,a,c,d,p,h,f,m,v=[],g=t(n);if("function"!==t(o))return u.error(o,"is not a function; please provide a function for callback"),-1;if("position"===i)return m=this.addPositionEventListener(n,o);if("string"===g){if(a=e(this.song,n),this.searchPatterns.push({searchstring:n,callback:o,type:"event",subtype:"searchstring"}),0===a.length)return-1;h="searchstring",d=this.allListenersByType.event.searchstring,this.eventListenersBySearchstring[n]=p=[]}else{if(-1===(a=s(i,n)))return-1;h="instance",d=this.allListenersByType.event.instance}for("note"===i&&(a=e(a,"type = NOTE_ON OR type = NOTE_OFF")),r=a.length-1;r>=0;r--)c=a[r],m="event_"+l++,f={id:m,event:c,type:i,subtype:h,callback:o},this.allListenersById[m]=f,void 0===d[c.id]&&(d[c.id]=[]),d[c.id].push(m),v.push(m),"searchstring"===h&&p.push(m);return"searchstring"===h||"array"===g||"note"===i?v:v[0]},a.prototype.addPositionEventListener=function(e,n){var o,s,a,c,h=e.split(/[\s+]/g),f=h.length,m=h[0],v=h[1],g=h[2],y=h[3],b=h[4],k=t(g);if(1!==f&&3!==f&&5!==f)return u.error("invalid search string, please consult documentation"),!1;if(1!==d[m])return u.error(m,"is not a supported event id, please consult documentation"),-1;switch("="!==v&&"=="!==v||(v="==="),m){case"barsbeats":case"barsandbeats":case"time":case"ticks":case"millis":if(void 0===v||"==="!==v)return u.error(m,"can only be used conditionally with the operators '===', '==' or '='"),-1;y&&u.warn("this position event type can only be used with a single condition, ignoring second condition");break;case"bar":case"beat":case"sixteenth":case"hour":case"minute":case"second":if(g&&isNaN(g))return u.error("please provide a number"),-1;if(b&&isNaN(b))return u.error("please provide a number"),-1}if(v&&-1===p.indexOf(v))return u.error(v,"is not a supported operator, please use any of",p),-1;if(v&&void 0===g)return void u.error("operator without value");if(y&&-1===p.indexOf(v))return u.error(y,"is not a supported operator, please use any of",p),-1;if(y&&void 0===b)return void u.error("operator without value");if(v&&y&&!1===r(v,y))return u.error("you can't use "+v+" together with "+y),-1;if("function"!==t(n))return u.error(n,"is not a function; please provide a function for callback"),-1;switch(m){case"bar":case"beat":case"sixteenth":g-=0,b-=0;case"hour":case"minute":case"second":g-=0,b-=0,v&&("<="===v?(g++,v="<"):">="===v&&(g--,v=">")),y&&("<="===y?(b++,y="<"):">="===y&&(b--,y=">"));break;case"ticks":g-=0;break;case"barsbeats":case"barsandbeats":isNaN(g)?"string"===k?(g=g.replace(/[\[\]\s]/g,""),g=g.split(","),g=i(this.song,["barsbeats",g[0],g[1]||1,g[2]||1,g[3]||0]).ticks):u.error("please provide a number or an array of numbers"):g=i(this.song,["barsbeats",g,1,1,0]).ticks,m="ticks";break;case"millis":g=i(this.song,["millis",g]).ticks,m="ticks";break;case"time":isNaN(g)?"string"===k?(g=g.replace(/[\[\]\s]/g,""),u.log(g),g=g.split(","),1===g.length?(c=60*g[0]*1e3,g=i(this.song,["millis",c]).ticks):g=i(this.song,["time",g[0],g[1],g[2],g[3]]).ticks):u.error("please provide a number or an array of numbers"):(c=60*g*1e3,g=i(this.song,["millis",c]).ticks),u.log(g),m="ticks"}return s="position_"+l++,"ticks"===m?(a={id:s,callback:n,type:"position",subtype:"ticks",ticks:g,searchstring:e},this.allListenersByType.position.ticks.push(s)):v||y?v&&!y?(a={id:s,callback:n,type:"position",subtype:"conditional_simple",position_type:m,data:g,operator:v,searchstring:e},o=this.allListenersByType.position.conditional_simple,void 0===o[m]&&(o[m]=[]),o[m].push(s)):v&&y&&(a={id:s,callback:n,type:"position",subtype:"conditional_complex",position_type:m,value1:g,value2:b,operator1:v,operator2:y,searchstring:e},o=this.allListenersByType.position.conditional_complex,void 0===o[m]&&(o[m]=[]),o[m].push(s)):(a={id:s,callback:n,type:"position",subtype:"repetitive",position_type:m,searchstring:e},o=this.allListenersByType.position.repetitive,void 0===o[m]&&(o[m]=[]),o[m].push(s)),this.allListenersById[s]=a,this.positionListenersBySearchstring[e]=s,s},a.prototype.removeEventListener=function(e){var i,n,o,s,r,a,c,l,d,p,h,f,m,v,g,y,b,k,w=[],E=[];if(i=e[0],1===(n=e.length))for(l="array"===t(i)?i:[i],v=l.length-1;v>=0;v--)if(c=l[v],void 0!==this.allListenersById[c]){if(d=this.allListenersById[c],o=d.type,s=d.subtype,"position"===o){for(b=this.allListenersByType[o][s][d.position_type],g=b.length-1;g>=0;g--)(p=b[g])!==c&&w.push(p);this.allListenersByType[d.type][d.subtype][d.position_type]=[].concat(w),delete this.allListenersById[c]}else if("event"===o||"note"===o){for(h=d.event,f=h.id,b=this.allListenersByType.event[s][f],g=b.length-1;g>=0;g--)if(p=b[g],d=this.allListenersById[p],p!==c){w.push(p);break}this.allListenersByType.event[s][f]=[].concat(w),delete this.allListenersById[c]}}else u.warn("no event listener found with id",c);else if(2===n||3===n)switch(o=e[0],r=e[1],a=e[2],k=t(r),o){case"position":if("string"===k){for(c=this.positionListenersBySearchstring[r],d=this.allListenersById[c],b=this.allListenersByType[d.type][d.subtype][d.position_type],v=b.length-1;v>=0;v--)(p=b[v])!==c&&w.push(p);this.allListenersByType[d.type][d.subtype][d.position_type]=[].concat(w),delete this.allListenersById[c],delete this.positionListenersBySearchstring[r]}break;case"event":case"note":if("string"===k){for(b=this.eventListenersBySearchstring[r],v=b.length-1;v>=0;v--)E.push(b[v]);m=this.allListenersByType.event.searchstring;for(f in m)if(m.hasOwnProperty(f)){for(b=m[f],w=[],v=b.length-1;v>=0;v--){for(p=b[v],y=!1,g=E.length-1;g>=0;g--)if(p===E[g]){y=!0;break}!1===y?w.push(p):delete this.allListenersById[b[v]]}this.allListenersByType.event.searchstring[f]=[].concat(w)}delete this.eventListenersBySearchstring[r]}else if("object"===k){if("MidiEvent"!==r.className&&"MidiNote"!==r.className)return void u.error("please provide a midi event or a midi note");if("MidiNote"===r.className?c=r.noteOn.id:"MidiEvent"===r.className&&(c=r.id),void 0!==this.allListenersByType.event.instance[c]?(o="instance",b=this.allListenersByType.event.instance[c]):void 0!==this.allListenersByType.event.searchstring[c]&&(o="searchstring",b=this.allListenersByType.event.searchstring[c]),void 0===b)return void u.warn("no event listener bound to event with id",c);for("MidiNote"===r.className&&(l=this.allListenersByType.event[o][r.noteOff.id],b=b.concat(l)),v=b.length-1;v>=0;v--)p=b[v],d=this.allListenersById[p],a&&d.callback!==a?w.push(d.id):delete this.allListenersById[d.id],this.allListenersByType.event[o][d.event.id]=[].concat(w)}}},a.prototype.resetAllListeners=function(){var e,t,i=this.allListenersById;for(e in i)i.hasOwnProperty(e)&&(t=i[e],t.called=!1)},s=function(e,i){var n,o,s=t(i),r=[];if("array"!==s&&void 0!==i&&"MidiEvent"!==i.className&&"MidiNote"!==i.className)return u.error(i," is not valid data for event type 'event', please consult documentation"),-1;if("array"===s)for(n=i.length-1;n>=0;n--)o=i[n],"event"!==e||"MidiEvent"===o.className||"AudioEvent"===o.className?"note"!==e||"MidiNote"===o.className?r.push(o):u.warn("skipping",o,"because it is not a MidiNote"):u.warn("skipping",o,"because it is not a MidiEvent nor an AudioEvent");else if("event"===e){if("MidiEvent"!==i.className&&"AudioEvent"!==i.className)return u.error(i," is not a MidiEvent nor an AudioEvent"),-1;r=[i]}else if("note"===e){if("MidiNote"!==i.className)return u.error(i," is not a MidiNote"),-1;r=[i.noteOn,i.noteOff]}return r},r=function(e,t){switch(e){case"=":case"==":case"===":return!1}switch(t){case"=":case"==":case"===":return!1}return!0},c.protectedScope.createFollowEvent=function(e){return new a(e)},c.protectedScope.addInitMethod(function(){t=c.protectedScope.typeString,i=c.protectedScope.getPosition,o=c.midiEventNumberByName,n=c.midiEventNameByNumber,e=c.findEvent})}(),function(){var e,t,i,n,o,s,r,a;a=function(i,n,o,s,r){var a,c,u;return void 0===i?void console.error("please provide a song"):void 0===n||void 0===o?void console.error("please provide a coordinate"):void 0===s||void 0===r?void console.error("please provide width and height"):(a=t(n/s*i.ticks),c=i.highestNote-t(o/r*i.pitchRange),u=e(i,["ticks",a]),c=sequencer.createNote(c),{position:u,note:c})},sequencer.positionToSong=sequencer.coordinatesToPosition=sequencer.gridToSong=function(){var e=Array.prototype.slice.call(arguments),t=e.length,i=e[0];return 4===t&&"Song"!==i.className?a(sequencer.getSong(),i,e[1],e[2],e[3]):a(i,e[1],e[2],e[3],e[4])},sequencer.songToGrid=function(){var e=Array.prototype.slice.call(arguments),t=e.length,i=e[0],n=e[1];switch(t){case 3:s(i,n,e[2]);break;case 4:"x"===i?o(n,e[2],e[3]):"y"===i&&r(n,e[2],e[3]);break;case 6:break;default:console.error("wrong number of arguments")}},s=function(e,t,i,n){if(void 0===n&&(n=sequencer.getSong()),e.type!==sequencer.NOTE_ON&&e.type!==sequencer.NOTE_OFF)return console.error("please provide a NOTE_ON or a NOTE_OFF event"),null;var s=(e.millis,n.durationMillis,sequencer.createNote(e.noteNumber));return{x:o(["ticks",e.ticks],t,n),y:r(s,i,n)}},o=function(i,o,s){void 0===s&&(s=sequencer.getSong()),"array"!==n(i)&&"ticks"===i.type||(i=e(s,i));var r=t(i.ticks/s.quantizeTicks)*s.quantizeTicks;return r/=s.ticks,r*=o},r=function(e,t,i){void 0===i&&(i=sequencer.getSong());var n,o=e.number;return o<i.lowestNote||o>i.highestNote?(console.error("note is out of range of the pitch range of this song"),null):(n=(o-i.highestNote)/i.pitchRange,n=n<0?-n:n,n*=t)},sequencer.protectedScope.addInitMethod(function(){e=sequencer.protectedScope.getPosition,t=sequencer.protectedScope.floor,i=sequencer.protectedScope.round,n=sequencer.protectedScope.typeString})}(),function(){function e(e,t){var i,n,o=e.lastEventTmp;!1===e.autoSize?e.lastBar=e.bars:e.lastBar=t?o.bar:Math.max(e.lastBar,o.bar),e.bars=parseInt(e.lastBar),i=s(e,["barsandbeats",e.bars,o.nominator,o.numSixteenth,o.ticksPerSixteenth,!0]),e.durationTicks=i.ticks,e.durationMillis=i.millis;for(n in i)i.hasOwnProperty(n)&&(e.lastEvent[n]=i[n])}function t(e,t){var i=t.concat(e.timeEvents);a(e,i),t=t.concat(e.events),t.sort(function(e,t){return e.sortIndex-t.sortIndex}),e.eventsMidiAudioMetronome=[].concat(t)}function i(e,t){var i,n;for(i=t.length-1;i>=0;i--)n=t[i],n.startPosition=e.getPosition("ticks",n.start.ticks),n.endPosition=e.getPosition("ticks",n.end.ticks),n.start.millis=n.startPosition.millis,n.end.millis=n.endPosition.millis,n.duration.millis=n.end.millis-n.start.millis,n.state="clean"}function n(e,t){var i,n;for(i=t.length-1;i>=0;i--)n=t[i],!0===n.endless?(n.durationTicks=p.ticks-n.noteOn.ticks,n.durationMillis=p.millis-n.noteOn.millis):(n.durationTicks=n.noteOff.ticks-n.noteOn.ticks,n.durationMillis=n.noteOff.millis-n.noteOn.millis),n.ticks=n.noteOn.ticks,n.millis=n.noteOn.millis,n.number=n.noteOn.noteNumber,n.state="clean"}function o(e,t){var i,n,o,s,r,a=e.recordTimestamp,c=e.recordStartMillis,u=c,l=t.length,d=e.playheadRecording;for(d.set("millis",c),i=0;i<l;i++)s=t[i],r=s.recordMillis-a+c,o=d.update("millis",r-u),u=r,n=p.getNiceTime(o.millis),s.ticks=o.ticks,s.bpm=o.bpm,s.factor=o.factor,s.nominator=o.nominator,s.denominator=o.denominator,s.ticksPerBar=o.ticksPerBar,s.ticksPerBeat=o.ticksPerBeat,s.ticksPerSixteenth=o.ticksPerSixteenth,s.numSixteenth=o.numSixteenth,s.millisPerTick=o.millisPerTick,s.secondsPerTick=o.secondsPerTick,s.millis=o.millis,s.seconds=o.millis/1e3,s.hour=n.hour,s.minute=n.minute,s.second=n.second,s.millisecond=n.millisecond,s.timeAsString=n.timeAsString,s.timeAsArray=n.timeAsArray,s.bar=o.bar,s.beat=o.beat,s.sixteenth=o.sixteenth,s.tick=o.tick,s.barsAsString=o.bar+":"+o.beat+":"+o.sixteenth+":"+o.tick,s.barsAsArray=[o.bar,o.beat,o.sixteenth,o.tick],s.state="clean";e.recordStartMillis=void 0,e.recordTimestamp=void 0}var s,r,a,c,u,l,d,p=window.sequencer;window.console;l=function(e,t){if(!0===p.playing)return void(u.updateSong=function(){d(e,t)});d(e,t)},d=function(t,s){var c,u,l,d,p,h,f,m,v,g,y,b=[],k=[],w=[],E=[],N=[],P=[],S=[],T=[],A=[],I=[],x=[],O=[],M=[],C=[],B=[],_=[],R=[],L=[],V=[],q=[],U=[],D={},F={},j={};!0===s&&r(t);for(u in t.tracksById)if(t.tracksById.hasOwnProperty(u)){h=t.tracksById[u],!0===h.needsUpdate&&h.update();for(l in h.partsById)if(h.partsById.hasOwnProperty(l)){f=h.partsById[l],!0===f.needsUpdate&&f.update(),g=f.dirtyEvents;for(d in g)if(g.hasOwnProperty(d))switch(m=g[d],m.state){case"new":b.push(m);break;case"recorded":E.push(m);break;case"changed":k.push(m);break;case"removed":w.push(m),delete f.eventsById[d]}y=f.dirtyNotes;for(d in y)if(y.hasOwnProperty(d))switch(v=y[d],v.state){case"new":N.push(v);break;case"changed":P.push(v);break;case"removed":S.push(v),delete f.notesById[d]}switch(f.dirtyEvents={},f.dirtyNotes={},"removed"!==f.state?(V=V.concat(f.notes),_=_.concat(f.events)):(S=S.concat(f.notes),w=w.concat(f.events)),f.state){case"new":T.push(f),j[f.id]=f;break;case"changed":A.push(f),j[f.id]=f;break;case"removed":I.push(f),delete h.partsById[f.id]}}switch(q=q.concat(h.parts),h.state){case"clean":h.index=U.length,U.push(h);break;case"new":x.push(h),h.state="clean",h.index=U.length,U.push(h);break;case"changed":O.push(h),h.state="clean",h.index=U.length,U.push(h);break;case"removed":M.push(h),delete t.tracksById[h.id]}}for(c=w.length-1;c>=0;c--)m=w[c],m.state="clean";for(c=S.length-1;c>=0;c--)v=S[c],v.state="clean";for(c=I.length-1;c>=0;c--)f=I[c],f.state="clean";for(E.length>0&&o(t,E),_.sort(function(e,t){return e.sortIndex-t.sortIndex}),V.sort(function(e,t){return e.ticks-t.ticks}),q.sort(function(e,t){return e.ticks-t.ticks}),c=_.length-1;c>=0;c--)m=_[c],D[m.id]=m,"audio"===m.type?L.push(m):R.push(m);for(c=V.length-1;c>=0;c--)v=V[c],F[v.id]=v;!1===s?(p=t.timeEvents.concat(b,k),a(t,p),p=[].concat(N,P),n(t,p),p=[].concat(T,A),i(t,p)):(p=t.timeEvents.concat(_),a(t,p),n(t,V),i(t,q)),e(t),t.metronome.bars!==t.bars?t.metronome.update():!0===s&&t.metronome.update(),C=[].concat(R,L,t.metronome.events),C.sort(function(e,t){return e.ticks-t.ticks}),B=[].concat(_,t.timeEvents),B.sort(function(e,t){return e.ticks-t.ticks}),t.eventsMidiAudioMetronome=C,t.eventsMidiTime=B,t.events=_,t.midiEvents=R,t.audioEvents=L,t.notes=V,t.parts=q,t.tracks=U,t.numEvents=_.length,t.numNotes=V.length,t.numParts=q.length,t.numTracks=U.length,t.eventsById=D,t.notesById=F,t.partsById=j,t.newEvents=b,t.changedEvents=k,t.removedEvents=w,t.newNotes=N,t.changedNotes=P,t.removedNotes=S,t.newParts=T,t.changedParts=A,t.removedParts=I,t.playhead.updateSong(),t.playheadRecording.updateSong(),t.scheduler.updateSong(),t.scheduler.reschedule(),t.followEvent.updateSong(),void 0!==t.grid&&t.grid.update(),void 0!==t.keyEditor&&t.keyEditor.updateSong({numBars:t.bars,newEvents:b,changedEvents:k,removedEvents:w,newNotes:N,changedNotes:P,removedNotes:S,newParts:T,changedParts:A,removedParts:I})},p.protectedScope.update=l,p.protectedScope.checkDuration=e,p.protectedScope.parseMetronomeEvents=t,p.protectedScope.addInitMethod(function(){s=p.protectedScope.getPosition,a=p.protectedScope.parseEvents,r=p.protectedScope.parseTimeEvents,c=p.protectedScope.getInstrument,u=p.protectedScope.scheduledTasks})}(),function(){function e(e,t){var i=!1;return e?"Part"===e.className?i=e:"string"===p(e)?i=t.partsById[e]:!1===isNaN(e)&&(i=t.parts[e]):i=!1,i}function t(e,t){var i=!1;return e?"MidiEvent"===e.className||"AudioEvent"===e.className?i=e:"array"===p(e)&&4===e.length?i=g(e):"string"===p(e)?i=t.eventsById[e]:!1===isNaN(e)&&(i=t.events[e]):i=!1,i}function i(t,i){t=Array.prototype.slice.call(t);var n,o,s,r=0,a=0,c=t[0],u=[],l=[];if("array"===p(c)){for(a=c.length-1;a>=0;a--)s=c[a],(o=e(s,i))&&u.push(o);r=0===u.length?0:1}for(n=t.length,a=r;a<n;a++)s=t[a],o=e(s,i),o?u.push(o):l.push(s);return 0===u.length?(C.warn("no parts added"),!1):{parts:u,config:l}}function n(e,i){e=Array.prototype.slice.call(e);var n,o,s,r=0,a=0,c=e[0],u=[],l=[];if("array"===p(c)){for(a=c.length-1;a>=0;a--)s=c[a],(o=t(s,i))&&u.push(o);r=1}for(n=e.length,a=r;a<n;a++)s=e[a],o=t(s,i),o?u.push(o):l.push(s);return 0===u.length&&B>=2&&C.info("Please provide one or more events, or an array of events"),1===l.length&&"array"===p(l[0])&&(l=l[0]),{events:u,config:l}}function o(e,t){var i,n;if(!1===(e=v(e)))return!1;if(i=e[0],void 0===t&&"ticks"!==i)return C.error("Track has not been added to a song yet, you can only use tick values"),!1;switch(i){case"ticks":n=e[1];break;case"millis":n=t.millisToTicks(e[1]);break;case"barsbeats":case"barsandbeats":case"time":e=t.getPosition(e,"ticks"),n=e.ticks}return n}function s(t,i){if(!1!==t){var n,o,s,r,a,c,u,l=i.song,d=t.parts,p=d.length,h=i.partsById;for(n=0;n<p;n++)if(!1!==(r=e(d[n]))){void 0!==r.track&&(r=r.copy()),r.hasAudioEvents&&void 0===i.audio&&(i.audio=w(i)),r.song=l,r.track=i,r.trackId=i.id,a=r.eventsById,c=r.ticks,u=0!==c;for(o in a)a.hasOwnProperty(o)&&(s=a[o],s.track=i,s.channel=i.channel,s.trackId=i.id,u&&(s.ticks+=c),s.state="new");r.state="new",r.needsUpdate=!0,h[r.id]=r}else C.error(r,"is not a part");i.needsUpdate=!0}}function r(e,t){if(!1!==e){var i,n,o,s=e.parts,r=e.config[0],a=r;for(o=s.length-1;o>=0;o--)n=s[o],i=n.ticks+r,i<0&&(i=0,a=-n.ticks),n.ticks=i,n.moveEvents(n.events,a),"new"!==n.state&&(n.state="changed");t.needsUpdate=!0}}function a(e,t){if(!1!==e){var i,n,s,r,a=t.song,c=e.parts,u=e.config;for(i=c.length-1;i>=0;i--)n=c[i],s=o(u[i],a),!1!==s?(r=s-n.ticks,n.ticks=s,n.moveAllEvents(r),"new"!==n.state&&(n.state="changed")):C.warn("wrong position data, skipping part",n.id);t.needsUpdate=!0}}function c(e,t){if(!1===e)return[];var i,n,o=[],s=e.parts;if(void 0===s)return C.log("weird situation, check this when it happens"),[];for(i=s.length-1;i>=0;i--)n=s[i],void 0===n.track||n.track===t?(o.push(n),n.state="removed",n.reset(!0,!0)):C.warn("can't remove: this part belongs to track",n.track.id);return t.needsUpdate=!0,o}function u(e,t){if(!1!==e){var i,n,o,s,r={},a=[],c=e;for(i=c.length-1;i>=0;i--)s=c[i],void 0===s.track||s.track===t?(o=s.partId,void 0===r[o]&&(r[o]=[]),r[o].push(s),a.push(s)):C.warn("can't remove: this event belongs to track",s.track.id);for(o in r)r.hasOwnProperty(o)&&(n=t.partsById[o],n.removeEvents(r[o]));return t.needsUpdate=!0,a}}function l(e){var t;return void 0!==e.song&&void 0!==e.song.defaultInstrument&&(t=f(e.song.defaultInstrument,M.storage.instruments)),!1!==t&&void 0!==t||(t=f(M.defaultInstrument,M.storage.instruments)),t}var d,p,h,f,m,v,g,y,b,k,w,E,N,P,S,T,A,I,x,O,M=window.sequencer,C=window.console,B=M.debug,_=Array.prototype.slice,R=0;O=function(e,t,i){this.className="Track",this.id="T"+R+++(new Date).getTime(),this.type=t||"instrument",this.name=e||this.id,this.song=i,this.instrumentName="",this.events=[],this.eventsById={},this.notes=[],this.notesById={},this.parts=[],this.partsById={},this.numParts=0,this.numEvents=0,this.needsUpdate=!1,this.audioLatency=0,this.effects={},this.numEffects=0,this.volume=1,this.input=b.createGainNode(),this.input.gain.value=1,this.output=b.createGainNode(),this.output.gain.value=this.volume,this.panner=E(),this.input.connect(this.panner.node),this.panner.node.connect(this.output),this.lastEffect=this.input,this.midiInputs={},this.midiOutputs={},this.routeToMidiOut=!1,this.midiEventListeners={},this.monitor=!1,this.recordEnabled=!1,this.mute=!1,this.solo=!1,this.channel="any",this.quantizeValue=0,this.fixedLengthValue=0,this.autoQuantize=!1,this.retrospectiveRecording=[],this.recordingNotes={},this.enableRetrospectiveRecording=!1,"metronome"!==t&&this.setInstrument(this.instrumentName)},O.prototype.addPart=O.prototype.addParts=function(){s(i(arguments,this),this)},O.prototype.addPartAt=O.prototype.addPartsAt=function(){var e,t,n,r,a,c=i(arguments,this);if(!1!==c){if(t=c.parts,void 0===(e=c.config))return C.error("please provide position data"),!1;for(n=t.length-1;n>=0;n--)r=t[n],!1!==(a="ticks"===e[0]?e[1]:o(e[n],this.song))&&(r.ticks+=a);s(c,this)}},O.prototype.movePart=O.prototype.moveParts=function(){r(i(arguments,this),this)},O.prototype.movePartTo=O.prototype.movePartsTo=function(){a(i(arguments,this),this)},O.prototype.moveAllParts=function(e){this.moveParts({parts:this.parts,config:[e]})},O.prototype.copyPart=O.prototype.copyParts=function(){var e,t=i(arguments,this),n=[];if(!1!==t)return 0===e.length?void C.error("no parts"):(e=t.parts,e.forEach(function(e){n.push(e.copy())}),1===n.length?n[0]:n)},O.prototype.removePart=function(){var e=i(arguments,this),t=c(e,this);return 1===t.length?t[0]:t},O.prototype.removeParts=function(){return c(i(arguments,this),this)},O.prototype.getPart=function(t){return e(t)},O.prototype.getParts=function(){var t,i,n=Array.prototype.slice.call(arguments),o=[];return i=function(n,s){t=n[s],"array"===p(t)?i(t,0):o.push(e(t))},i(n,0),o},O.prototype.getPartAt=O.prototype.getPartsAt=function(e){var t=o(e,this.song),i=this.parts,n=[];return!1===t?void C.error("please provide position as array, for instance: ['barsandbeats',5,1,2,0]"):(i.forEach(function(e){e.ticks===t&&n.push(e)}),n)},O.prototype.getPartFromTo=O.prototype.getPartsFromTo=function(e,t){var i=this.parts,n=[],s=o(e,this.song),r=o(t,this.song);return!1===s?void C.error("invalid position data for from position"):!1===r?void C.error("invalid position data for from position"):(i.forEach(function(e){(s>=e.start.ticks&&s<=e.end.ticks||r>=e.start.ticks&&r<=e.end.ticks)&&n.push(e)}),n)},O.prototype.getPartBetween=O.prototype.getPartBetween=function(e,t){var i=this.parts,n=[],s=o(e,this.song),r=o(r,this.song);return!1===s||!1===r?void C.error("please provide position as array, for instance: ['barsandbeats',5,1,2,0]"):(i.forEach(function(e){e.start.ticks>=s&&e.end.ticks<=r&&n.push(e)}),n)},O.prototype.copy=function(){var e,t,i,n=new O(h(this.name)),o=this.parts,s=[];if(n.song=null,n.instrumentId=this.instrumentId,n.numEffects=this.numEffects,this.numEffects>0){n.effects={};for(t in this.effects)this.effects.hasOwnProperty(t)&&(i=this.effects[t],n.effects[i.id]=i.copy())}for(t=o.length-1;t>=0;t--)e=o[t],s.push(e.copy());return n.addParts(s),n},O.prototype.removeEvent=O.prototype.removeEvents=function(){u(n(arguments,this).events,this)},O.prototype.removeEventsFromTo=function(e,t){C.warn("removeEventsFromTo() is temporarily disabled")},O.prototype.removeEventAt=O.prototype.removeEventsAt=function(e){C.warn("removeEventAt() is temporarily disabled")},O.prototype.removeAllEvents=function(){u(this.events,this)},O.prototype.transposePart=function(e,t){var i=e.getStats("noteNumber all"),n=0,o=127;return this.song&&(n=this.song.lowestNote,o=this.song.highestNote),i.min+t<n?void(n-i.min):i.max+t>o?void(o=i.max):void e.transposeAllEvents(t)},O.prototype.reset=function(){var e,t;this.song=null,this.audio&&this.audio.setSong(null);for(e in this.partsById)this.partsById.hasOwnProperty(e)&&(t=this.partsById[e],t.reset(!1,!0));this.needsUpdate=!0},O.prototype.findEvent=function(e){return A(this,e)},O.prototype.findNote=function(e){return I(this,e)},O.prototype.getStats=function(e){return x(this,e)},O.prototype.update=function(){this.parts=[],this.notes=[],this.events=[];var e,t,i,n,o,s;for(t in this.partsById)if(this.partsById.hasOwnProperty(t)){if(i=this.partsById[t],!0===i.needsUpdate&&i.update(),0===i.events.length&&!1===i.keepWhenEmpty&&this.removePart(i),"new"===i.state&&void 0!==this.song)for(o=i.events,e=o.length-1;e>=0;e--)n=o[e],n.song=this.song;"removed"!==i.state&&(this.parts.push(i),this.notes=this.notes.concat(i.notes),this.events=this.events.concat(i.events))}for(this.parts.sort(function(e,t){return e.ticks-t.ticks}),this.notes.sort(function(e,t){return e.ticks-t.ticks}),this.events.sort(function(e,t){return e.sortIndex-t.sortIndex}),this.numEvents=this.events.length,this.numNotes=this.notes.length,this.numParts=this.parts.length,e=this.numEvents-1;e>=0;e--)n=this.events[e],this.eventsById[n.id]=n;for(e=this.numNotes-1;e>=0;e--)s=this.notes[e],this.notesById[s.id]=s;this.needsUpdate=!1},O.prototype.getIndex=function(){var e,t,i=-1,n=this.song.tracks,o=n.length;if(o>0)for(t=0;t<o;t++)if(e=n[t],e.id===this.id){i=t;break}return i},O.prototype.addEffect=function(e,t){e&&(this.effects[e.id]=e,this.numEffects++,void 0!==this.lastEffect&&(this.lastEffect.disconnect(0),e.setInput(this.lastEffect)),e.output.connect(this.panner.node),this.lastEffect=e.output)},O.prototype.removeEffect=function(e){!1!==e&&(delete this.effects[e.id],this.numEffects--)},O.prototype.setEffectPosition=function(e,t){var i,n,o=this.numEffects-1;if(!(t<0||t>o))for(e.position=t,i=0;i<o-1;i++)n=this.effects[i],n.position>=t&&n!==e&&(n.position+=1)},O.prototype.setSolo=function(e){void 0===e&&(e=!this.solo),this.mute=!1,this.solo=e,this.song&&this.song.setTrackSolo(this,e)},O.prototype.setPartSolo=function(e,t){var i,n;for(i=this.numParts-1;i>=0;i--)n=this.parts[i],!0===t?n.mute=n===e?!t:t:!1===t&&(n.mute=!1),n.solo=n===e&&t},O.prototype.setVolume=function(e){isNaN(e)?M.debug>=1&&C.error("please pass a number"):e<0||e>1?M.debug>=1&&C.error("please pass a float between 0 and 1"):(this.volume=e,this.input.gain.value=this.volume)},O.prototype.getVolume=function(){return this.volume},O.prototype.setPanning=function(e){this.panner.setPosition(e)},O.prototype.connect=function(e){this.output.connect(e)},O.prototype.disconnect=function(e){this.output.disconnect(0)},O.prototype.setInstrument=function(e){""!==e&&void 0!==e&&!1!==e||(e=l(this));var t=k(e);!1===t&&(t=k(l(this))),t.track=this,this.instrument&&this.instrument.allNotesOff(),this.instrument=t,this.instrumentId=t.name,this.song&&(this.instrument.song=this.song)},O.prototype.setMidiInput=function(e,t){var i,n,o=this.midiInputs;if(t=void 0===t||t,"all"===e)return n=void 0!==this.song?this.song.midiInputs:M.midiInputs,void m(n,function(e,i){!0===t?o[i]=e:delete o[i]});void 0!==(i=this.song.midiInputs[e])&&(t?this.midiInputs[e]=i:delete this.midiInputs[e])},O.prototype.setMidiOutput=function(e,t){t=void 0===t||t;var i=this.song.midiOutputs[e],n=this;void 0!==i&&(!0===t&&this.instrument.allNotesOff(),t?this.midiOutputs[e]=i:delete this.midiOutputs[e],this.routeToMidiOut=!1,m(this.midiOutputs,function(e,t){!1!==e&&(n.routeToMidiOut=!0)}))},O.prototype.prepareForRecording=function(e,t){"midi"!==this.recordEnabled&&"audio"!==this.recordEnabled||(this.recordPart=M.createPart(),this.addPart(this.recordPart),this.recordingNotes={},this.recordId=e,"audio"===this.recordEnabled&&(void 0===this.audio&&(this.audio=w(this)),this.audio.prepareForRecording(e,t)))},O.prototype.stopRecording=function(e,t){if(this.recordId===e)if(this.recordingNotes={},(this.autoQuantize||this.song.autoQuantize)&&(B>=1&&C.log("performing auto quantize"),this.quantizeRecording()),"midi"===this.recordEnabled)this.recordPart.update(),t(this.recordPart.events);else if("audio"===this.recordEnabled){var i=this;this.audio.stopRecording(function(e){var n=M.createAudioEvent({ticks:i.song.recordTimestampTicks,buffer:e.audioBuffer,sampleId:e.id});i.recordPart.addEvent(n),i.recordPart.update(),t([n])})}},O.prototype.undoRecording=function(e){var t=p(e);"string"===t?this.recordId===e&&this.removePart(this.recordPart):"array"===t&&this.removeEvents(e)},O.prototype.setWaveformConfig=function(e){this.waveformConfig=e,void 0!==this.audio&&(this.audio.recorder.waveformConfig=e)},O.prototype.getAudioRecordingData=function(e){if(void 0!==this.audio)return void 0===e?(M.debug>=M.WARN&&C.warn("please provide a recording id"),!1):M.storage.audio.recordings[e]},O.prototype.encodeAudioRecording=function(e,t,i,n){if(void 0!==this.audio){if(void 0===e)return M.debug>=M.WARN&&C.warn("please provide a recording id"),void(n&&n(!1));var o=M.storage.audio.recordings[e];S(o.audioBuffer,t,i,function(e){o.mp3=e,n(o)})}},O.prototype.setAudioRecordingLatency=function(e,t,i){void 0!==this.audio&&this.audio.setAudioRecordingLatency(e,t,function(t){var n,o,s,r=this.song.audioEvents;for(n=r.length-1;n>=0;n--)o=r[n],void 0!==(s=o.sampleId)&&e===s&&(o.buffer=t.audioBuffer);void 0!==i&&i()})},O.prototype.quantizeRecording=function(e){return e=e||this.quantizeValue,M.quantize(this.recordPart.events,e,this.song.ppq)},O.prototype.quantize=function(){var e,t,i,n,o=_.call(arguments),s=o.length;for(e=0;e<s;e++)t=o[e],i=p(t),"string"===i||"number"===i?n=t:"object"===i&&t;return void 0===n&&(n=this.quantizeValue),M.quantize(this.events,n,this.song.ppq,history)},O.prototype.undoQuantize=function(e){if(void 0===e)return void(M.debug>=2&&C.warn("please pass a quantize history object"));var t,i,n=e.tracks[this.id].quantizedEvents,o=n.length;for(t=0;t<o;t++)i=n[t],i.ticks=e.events[i.id].ticks},O.prototype.addMidiEventListener=function(){return N(arguments,this)},O.prototype.removeMidiEventListener=function(e){P(e,this)},O.prototype.allNotesOff=function(e){this.audio&&this.audio.allNotesOff(),this.instrument&&this.instrument.allNotesOff()},O.prototype.processMidiEvent=function(e){T(e,this)},M.protectedScope.Track=O,M.createTrack=function(e,t,i){return new O(e,t,i)},M.protectedScope.addInitMethod(function(){var e=M.protectedScope;x=M.getStats,A=M.findEvent,I=M.findNote,d=M.createPart,g=M.createMidiEvent,y=M.createMidiNote,k=M.createInstrument,E=M.createPanner,S=M.encodeAudio,b=e.context,f=e.findItem,N=e.addMidiEventListener,P=e.removeMidiEventListener,w=M.protectedScope.createAudioTrack,v=e.checkPosition,m=e.objectForEach,p=e.typeString,h=e.copyName,T=e.handleMidiMessageTrack})}(),function(){function e(e){return"object"!=(void 0===e?"undefined":n(e))?void 0===e?"undefined":n(e):null===e?"null":Object.prototype.toString.call(e).match(/\[object\s(\w+)\]/)[1].toLowerCase()}function t(e){var t,i,n,o,s,r="";return s=e/1e3,t=u(s/3600),i=u(s%3600/60),n=u(s%60),o=c(1e3*(s-3600*t-60*i-n)),r+=t+":",r+=i<10?"0"+i:i,r+=":",r+=n<10?"0"+n:n,r+=":",r+=0===o?"000":o<10?"00"+o:o<100?"0"+o:o,{hour:t,minute:i,second:n,millisecond:o,timeAsString:r,timeAsArray:[t,i,n,o]}}function i(e){var t,o;if(null===e||"object"!==(void 0===e?"undefined":n(e)))return e;o=e.constructor();for(t in e)e.hasOwnProperty(t)&&(o[t]=i(e[t]));return o}function o(t){var i,n={};if("object"!==e(t))return{};for(i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}function s(e){var t,i,n=e.indexOf("_copy");return-1===n?t=e+"_copy":(i=e.substring(n+5),t=""===i?e+"2":e.slice(0,-1)+(parseInt(i,10)+1)),t}function r(t,i){var n,o,s,r,a,c,u,l=[];for("array"!==e(t)&&(t=[t]),s=i.length,r=t.length,n=0;n<s;n++){for(c=i[n],a=!1,o=0;o<r;o++)if(u=t[o],c===u){a=!0;break}!1===a&&l.push(c)}return l}function a(e,t){var i,n,o=e.length,s=[];for(i=0;i<o;i++)n=e[i],!1===t(n)&&s.push(n);return s}function c(e,t){if(void 0===t||t<=0)return re(e);var i=se(10,t);return re(e*i)/i}function u(e,t){if(void 0===t||t<=0)return ae(e);var i=se(10,t);return ae(e*i)/i}function l(e,t){if(void 0===e)return!1;var i,n=!0;t=t||"";for(i in e)if(e.hasOwnProperty(i)&&-1===t.indexOf(i)){n=!1;break}return n}function d(e,t){var i,n=e;for(i in n)n.hasOwnProperty(i)&&t(n[i],i)}function p(e){var t,i=[];for(t in e)e.hasOwnProperty(t)&&i.push(e[t]);return i}function h(e,t){var i,n={};for(i=e.length-1;i>=0;i--)n[e[i][t]]=e[i];return n}function f(e,t){var i;return i=function(){this.parent=e,arguments.length>0&&(e.apply(this,arguments),void 0!==t&&t.apply(this,arguments))},i.prototype=Object.create(e.prototype),i}function m(e){function t(t,n){n=n||function(){},t=t||function(){},o.onload=function(){if(200!==o.status)return void n(o.status);"json"===e.responseType?(i=o.response.length,t(JSON.parse(o.response),i)):t(o.response)},o.onerror=function(t){e.onError(t)},o.open(s,e.url,!0),e.overrideMimeType&&o.overrideMimeType(e.overrideMimeType),e.responseType&&("json"===e.responseType?o.responseType="text":o.responseType=e.responseType),"POST"===s&&o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.data?o.send(e.data):o.send()}var i,n,o=new XMLHttpRequest,s=void 0===e.method?"GET":e.method;if(n=new Promise(t),void 0===e.onSuccess)return n;n.then(e.onSuccess,e.onError)}function v(e){var t,i=new XMLHttpRequest,n=void 0===e.method?"GET":e.method;i.onreadystatechange=function(){404===i.request&&e.onError(404)},i.onload=function(){if(200!==i.status)return void e.onError(i.status);"json"===e.responseType?(t=i.response.length,e.onSuccess(JSON.parse(i.response),t)):e.onSuccess(i.response)},i.onerror=function(t){e.onError(t)},i.open(n,e.url,!0),e.overrideMimeType&&i.overrideMimeType(e.overrideMimeType),e.responseType&&("json"===e.responseType?i.responseType="text":i.responseType=e.responseType),"POST"===n&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.data?i.send(e.data):i.send()}function g(e,t,i){var n,o;for(n in e){if(!1!==te)return;if(e.hasOwnProperty(n)&&void 0!==(o=e[n])&&"Folder"===o.className){if(n===t)return void(te=o);g(o,t,i+".")}}}function y(e,t,i,n){var o,s;for(o in e)if(e.hasOwnProperty(o)){if("id"===o||"path"===o||"className"===o)continue;if(void 0===(s=e[o]))continue;"Folder"===s.className?!0===i&&y(s,t,i,n+"."):void 0===s.name?t.push({name:o,data:s}):t.push(s)}}function b(e,t,i){i=void 0===i||i;var n,o,s,r=O(e),a=r.length,c=r[a-1],u=[];if(0===a)y(t,u,i,".");else{for(n=t,o=0;o<a&&(s=r[o],void 0!==(n=n[s]));o++);n?y(n,u,i,"."):(te=!1,g(t,c,"."),y(te,u,i,"."))}return u.sort(function(e,t){var i=e.name.toLowerCase(),n=t.name.toLowerCase();return i<n?-1:i>n?1:0}),u}function k(t,i,n){var o,s;for(o in t){if(!1!==ee)return;if(t.hasOwnProperty(o)){if(s=t[o],e(s),o===i){ee=s;break}void 0!==s&&"Folder"===s.className&&(n+=".",k(s,i,n))}}}function w(e,t,i){if(i=void 0!==i&&i,void 0===e||""===e)return t;var n,o,s,r,a,c,u;if(s=O(e),u=s.pop(),r=s.length,""===u)return t;if(ee=!1,s.length>0){for(a=t,n=0;n<r&&(o=s[n],void 0!==(a=a[o]));n++);a&&(c=a[u])}return void 0===c&&(!0===i?c=t[u]:(k(t,u,"."),c=ee)),void 0===c&&(c=!1),c}function E(e,t,i){var n,o,s,r,a,c="";for(o=O(t),s=o.length,r=i,a=0;a<s;a++){if(n=o[a],c+="/"+n,void 0===r[n]&&(r[n]={path:c,className:"Folder"}),a===s-1){r[n]=e;break}r=r[n]}}function N(e,t){var i,n,o,s=t;if(!(i=w(e,t,!0)))return!1;if("Folder"===i.className)for(o in i)i.hasOwnProperty(o)&&"className"!==o&&delete i[o];for(e=O(e);e.length>1;){for(o=0,s=t;o<e.length-1;)s=s[e[o++]];n=e[o],i=s[n],"Folder"===i.className?l(i,"path className")&&delete s[n]:delete s[n],e.pop()}return 1===e.length&&""!==e[0]&&(n=e[0],i=t[n],"Folder"===i.className?l(t[n],"path className")&&delete t[n]:delete t[n]),!0}function P(e,t){return new Promise(function(i,n){try{$.decodeAudioData(t,function(t){i({id:e,buffer:t})},function(t){ne.log("error decoding audiodata",e,t),i({id:e,buffer:void 0})})}catch(t){ne.log("error decoding audiodata",e,t),i({id:e,buffer:void 0})}})}function S(e,t){return new Promise(function(i,n){m({url:t,responseType:"arraybuffer"}).then(function(t){P(e,t).then(i,n)},function(){i({id:e,buffer:void 0})})})}function T(e){var t,i,n=[];for(t in e)e.hasOwnProperty(t)&&(i=e[t],-1===i.indexOf("http://")?n.push(P(t,x(i))):n.push(S(t,i)));return new Promise(function(e,t){Promise.all(n).then(function(t){var i={};t.forEach(function(e){i[e.id]=e.buffer}),e(i)},function(e){t(e)})})}function A(e){var t,i,n,o,s;for(t=e||"",i=[],n=t.length,o=String.fromCharCode,s=0;s<n;s++)i[s]=o(255&t.charCodeAt(s));return i.join("")}function I(e){var t,i,n,o,s;for(t=e||"",n=t.length,i=new Uint8Array(n),o=String.fromCharCode,s=0;s<n;s++)i[s]=o(255&t.charCodeAt(s));return i}function x(e){var t,i,n,o,s,r,a,c,u,l,d,p,h,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",m=0;for(t=Math.ceil(3*e.length/4),n=new ArrayBuffer(t),i=new Uint8Array(n),o=f.indexOf(e.charAt(e.length-1)),s=f.indexOf(e.charAt(e.length-1)),64==o&&t--,64==s&&t--,e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),h=0;h<t;h+=3)u=f.indexOf(e.charAt(m++)),l=f.indexOf(e.charAt(m++)),d=f.indexOf(e.charAt(m++)),p=f.indexOf(e.charAt(m++)),r=u<<2|l>>4,a=(15&l)<<4|d>>2,c=(3&d)<<6|p,i[h]=r,64!=d&&(i[h+1]=a),64!=p&&(i[h+2]=c);return n}function O(e){return void 0===e?[]:(e=e.replace(/undefined/g,""),e=e.replace(/\/{2,}/g,"/"),e=e.replace(/^\//,""),e=e.replace(/\/$/,""),e=e.split("/"))}function M(e){var t,i,n,o="",s=e,r="";return e=e.replace(/\/{2,}/g,"/"),e=e.replace(/^\//,""),e=e.replace(/\/$/,""),t=e.lastIndexOf("/"),-1!==t&&(s=e.substring(t+1),o=e.substring(0,t)),i=e.lastIndexOf("."),-1!==i&&(n=e.substring(i+1),n.length>=3&&n.length<=4&&(r=n,s=e.substring(t+1,i))),{path:o,name:s,ext:r}}function C(e,t,i,n,o){if(0===t)return void(n&&n());i[e].load(function(){o&&o(arguments),e++,e<t?C(e,t,i,n,o):n&&n()})}function B(t){var i,n,o=[];return t=oe.call(t),i=function(t,s,r){for(s=0;s<r;s++)n=t[s],"array"===e(n)?i(n,0,n.length):o.push(n)},i(t,0,t.length),o}function _(e,t,i){var n,o,s,r=new Float32Array(e);for(n=0;n<e;n++)s=n/e,"fadeIn"===t?o=Math.cos(.5*(1-s)*Math.PI)*i:"fadeOut"===t&&(o=Math.cos(.5*s*Math.PI)*i),r[n]=o,n===e-1&&(r[n]="fadeIn"===t?1:0);return r}function R(e,t,i,n,o){var s=i-t,r=o-n;return(e-t)*r/s+n}function L(t,i,n){var o,s;for(o in t)t.hasOwnProperty(o)&&(s=t[o],s.className===i?n.push(s):"object"===e(s)&&k(s,i,n))}function V(e){function t(t){var i=r.valueAsNumber;e.onMouseDown&&e.onMouseDown(i,t),s.onMouseDown&&s.onMouseDown(i,t)}function i(t){var i=r.valueAsNumber;e.onMouseUp&&e.onMouseUp(i,t),s.onMouseUp&&s.onMouseUp(i,t)}function n(t){var i=r.valueAsNumber;e.onMouseMove&&e.onMouseMove(i,t),s.onMouseMove&&s.onMouseMove(i,t)}function o(t){var i=r.valueAsNumber;e.onChange&&e.onChange(i,t),s.onChange&&s.onChange(i,t)}var s,r=e.slider,a=e.message,c=e.label;return void 0===e.label&&(c=r.parentNode.firstChild),void 0!==e.initialSliderValue&&(r.value=e.initialSliderValue),void 0!==e.initialLabelValue&&(c.innerHTML=a.replace("{value}",e.initialLabelValue)),void 0!==e.min&&(r.min=e.min),void 0!==e.max&&(r.max=e.max),void 0!==e.step&&(r.step=e.step),r.addEventListener("mousedown",function(e){setTimeout(t,0,e),r.addEventListener("mousemove",n,!1)},!1),r.addEventListener("mouseup",function(e){setTimeout(i,0,e),r.removeEventListener("mousemove",n,!1)},!1),r.addEventListener("change",function(e){o(e)},!1),s={getValue:function(){return e.getValue?e.getValue(r.valueAsNumber):r.valueAsNumber},setValue:function(t){e.setValue?r.value=e.setValue(t):r.value=t},setLabel:function(e){c.innerHTML=a.replace("{value}",e)},elem:r,element:r},s.set=function(e){setLabel(e),setValue(e)},s}function q(e){function t(){var t=o();void 0!==e.onMouseMove&&e.onMouseMove(r.valueAsNumber,t),c.innerHTML=a.replace("{value}",t)}function i(){var t=o();void 0!==e.onMouseUp&&e.onMouseUp(r.valueAsNumber,t),c.innerHTML=a.replace("{value}",t)}function n(){var t=o();void 0!==e.onMouseDown&&e.onMouseDown(r.valueAsNumber,t),c.innerHTML=a.replace("{value}",t)}function o(){var t=r.valueAsNumber;return void 0!==e.calculate&&(t=e.calculate(t)),t}function s(t){return void 0!==e.calculateFromLabel&&(t=e.calculateFromLabel(t)),t}var r=e.slider,a=e.message,c=r.parentNode.firstChild;return e.initialValueSlider&&(r.value=e.initialValueSlider,c.innerHTML=a.replace("{value}",o())),e.initialValueLabel&&(c.innerHTML=a.replace("{value}",e.initialValueLabel),r.value=s(e.initialValueLabel)),r.addEventListener("mousedown",function(){setTimeout(n,0),r.addEventListener("mousemove",t,!1)},!1),r.addEventListener("mouseup",function(){setTimeout(i,0),r.removeEventListener("mousemove",t,!1)},!1),{updateSlider:function(e){r.value=e,c.innerHTML=a.replace("{value}",o())},updateLabel:function(e){c.innerHTML=a.replace("{value}",e),r.value=s(e)},getValue1:function(){return r.valueAsNumber},getValue2:function(){return o(r.valueAsNumber)}}}function U(e,t,i){var n=ce()*(t-e)+e;return!0===i?re(n):n}function D(e){var t,i,n,o,s,r,a,c,u,l,d,p=0,h=[];for(e=e||{},d=e.ppq||ie.defaultPPQ,o=e.numNotes||20,r=e.noteLength||d/2,a=e.minVelocity||30,c=e.maxVelocity||127,u=e.minNoteNumber||60,l=e.maxNoteNumber||127,r>d&&(r=d),t=0;t<o;t++)s=U(u,l,!0),n=U(a,c,!0),i=ie.createMidiEvent(p,ie.NOTE_ON,s,n),h.push(i),p+=r,i=ie.createMidiEvent(p,ie.NOTE_OFF,s,0),h.push(i),p+=d-r;return h}function F(){function t(e){for(i=e.length-1;i>=0;i--)n=e[i],n.ticks=a*n.ticks,"new"!==n.state&&(n.state="changed")}var i,n,o=oe.call(arguments),s=o[0],r=o[1],a=r/s;if(isNaN(s)||isNaN(r))return void(4===ie.debug&&ne.error("PPQ values must be numbers"));!function(i,n,o){var s,r,a,c,u;for(c=n;c<o;c++)if(s=i[c],"array"===(r=e(s)))t(s);else if("object"===r)if("Part"===s.className||"Track"===s.className||"Song"===s.className)t(s.events);else if("MidiFile"===s.className)for(u=s.numTracks-1;u>=0;u--)a=s.tracks[u],!0===a.needsUpdate&&(a.update(),a.events&&t(a.events))}(o,2,o.length)}function j(e,t){for(var i in ue)if(ue.hasOwnProperty(i)&&t===e.ppq/i)return ue[i];return!1}function z(e){return c(6e7/e)}function W(e){var t,i=e.indexOf("http://");return-1!==i&&(t=e.substring(i),-1!==(i=t.indexOf(" "))&&(t=t.substring(0,i))),'<a href="'+t+'"></a>'}function Q(e,t,i){var n,o,s,r,a,c,u,l=document.createElement("canvas"),d=l.getContext("2d"),p=e.getChannelData(0),h=(e.getChannelData(0),p.length),r=t.height||100,f=t.color||"#71DE71",m=t.bgcolor||"#000",v=r/2,g=t.sampleStep||50,y=0,b=0,k=[];for(void 0!==t.width?(o=t.width,s=o/h):(s=t.density||1,o=1e3,a=h*t.density%o,c=Math.ceil(h*t.density/o),u=0),l.width=o,l.height=r,d.fillStyle=m,d.fillRect(0,0,o,r),d.beginPath(),d.strokeStyle=f,d.lineWidth=1,d.moveTo(0,v),n=0;n<h;n+=g)y=(n-b)*s,y>=o?(d.stroke(),k.push(l.toDataURL("image/png")),u++,l.width=u===c-1?a:o,d.beginPath(),d.strokeStyle=f,b=n,y=0,d.moveTo(y,v-p[n]*v)):d.lineTo(y,v-p[n]*v);y<o&&(d.stroke(),k.push(l.toDataURL("image/png"))),i(k)}function H(e){for(var t="",i=new Uint8Array(e),n=i.byteLength,o=0;o<n;o++)t+=String.fromCharCode(i[o]);return window.btoa(t)}function K(e){return e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:43===e?62:47===e?63:0}function X(e,t){for(var i,n,o=e.replace(/[^A-Za-z0-9\+\/]/g,""),s=o.length,r=t?Math.ceil((3*s+1>>2)/t)*t:3*s+1>>2,a=new Uint8Array(r),c=0,u=0,l=0;l<s;l++)if(n=3&l,c|=K(o.charCodeAt(l))<<18-6*n,3===n||s-l==1){for(i=0;i<3&&u<r;i++,u++)a[u]=c>>>(16>>>i&24)&255;c=0}return a}function G(e){return e<26?e+65:e<52?e+71:e<62?e-4:62===e?43:63===e?47:65}function Z(e){for(var t=2,i="",n=e.length,o=0,s=0;s<n;s++)t=s%3,s>0&&4*s/3%76==0&&(i+="\r\n"),o|=e[s]<<(16>>>t&24),2!==t&&e.length-s!=1||(i+=String.fromCharCode(G(o>>>18&63),G(o>>>12&63),G(o>>>6&63),G(63&o)),o=0);return i.substr(0,i.length-2+t)+(2===t?"":1===t?"=":"==")}function Y(e){for(var t,i="",n=e.length,o=0;o<n;o++)t=e[o],i+=String.fromCharCode(t>251&&t<254&&o+5<n?1073741824*(t-252)+(e[++o]-128<<24)+(e[++o]-128<<18)+(e[++o]-128<<12)+(e[++o]-128<<6)+e[++o]-128:t>247&&t<252&&o+4<n?(t-248<<24)+(e[++o]-128<<18)+(e[++o]-128<<12)+(e[++o]-128<<6)+e[++o]-128:t>239&&t<248&&o+3<n?(t-240<<18)+(e[++o]-128<<12)+(e[++o]-128<<6)+e[++o]-128:t>223&&t<240&&o+2<n?(t-224<<12)+(e[++o]-128<<6)+e[++o]-128:t>191&&t<224&&o+1<n?(t-192<<6)+e[++o]-128:t);return i}function J(e){for(var t,i,n=e.length,o=0,s=0;s<n;s++)i=e.charCodeAt(s),o+=i<128?1:i<2048?2:i<65536?3:i<2097152?4:i<67108864?5:6;t=new Uint8Array(o);for(var r=0,a=0;r<o;a++)i=e.charCodeAt(a),i<128?t[r++]=i:i<2048?(t[r++]=192+(i>>>6),t[r++]=128+(63&i)):i<65536?(t[r++]=224+(i>>>12),t[r++]=128+(i>>>6&63),t[r++]=128+(63&i)):i<2097152?(t[r++]=240+(i>>>18),t[r++]=128+(i>>>12&63),t[r++]=128+(i>>>6&63),t[r++]=128+(63&i)):i<67108864?(t[r++]=248+(i>>>24),t[r++]=128+(i>>>18&63),t[r++]=128+(i>>>12&63),t[r++]=128+(i>>>6&63),t[r++]=128+(63&i)):(t[r++]=252+(i>>>30),t[r++]=128+(i>>>24&63),t[r++]=128+(i>>>18&63),t[r++]=128+(i>>>12&63),t[r++]=128+(i>>>6&63),t[r++]=128+(63&i));return t}var $,ee,te,ie=window.sequencer,ne=window.console,oe=Array.prototype.slice,se=Math.pow,re=Math.round,ae=Math.floor,ce=Math.random,ue={1:"quarter",2:"eighth",4:"sixteenth",8:"32th",16:"64th"};ie.protectedScope.addInitMethod(function(){$=ie.protectedScope.context}),ie.util.b64ToUint6=K,ie.util.base64DecToArr=X,ie.util.uint6ToB64=G,ie.util.base64EncArr=Z,ie.util.UTF8ArrToStr=Y,ie.util.strToUTF8Arr=J,ie.util.ajax=m,ie.util.ajax2=v,ie.util.parseSamples=T,ie.util.round=c,ie.util.floor=u,ie.util.remap=R,ie.util.getRandom=U,ie.util.createSlider=V,ie.util.createSlider2=q,ie.util.getRandomNotes=D,ie.util.getEqualPowerCurve=_,ie.util.objectForEach=d,ie.util.insertLink=W,ie.util.encode64=H,ie.protectedScope.getNoteLengthName=j,ie.protectedScope.toBinaryString=A,ie.protectedScope.base64ToBinary=x,ie.protectedScope.toUint8Array=I,ie.protectedScope.getArguments=B,ie.protectedScope.pathToArray=O,ie.protectedScope.parseUrl=M,ie.protectedScope.loadLoop=C,ie.protectedScope.findItem=w,ie.protectedScope.storeItem=E,ie.protectedScope.deleteItem=N,ie.protectedScope.toBinaryString=A,ie.protectedScope.ajax=m,ie.protectedScope.copyObject=o,ie.protectedScope.findItemsInFolder=b,ie.convertPPQ=F,ie.getNiceTime=t,ie.protectedScope.isEmptyObject=l,ie.protectedScope.objectForEach=d,ie.protectedScope.objectToArray=p,ie.protectedScope.arrayToObject=h,ie.protectedScope.createClass=f,ie.protectedScope.clone=i,ie.protectedScope.round=c,ie.protectedScope.floor=u,ie.protectedScope.typeString=e,ie.protectedScope.copyName=s,ie.protectedScope.removeFromArray=r,ie.protectedScope.removeFromArray2=a,ie.protectedScope.filterItemsByClassName=L,ie.getMicrosecondsFromBPM=z,ie.getWaveformData=Q}(),function(){function e(e,t,i,a){var c;if(t=""+t,t=t.toUpperCase(),i=i||n.defaultPPQ,0===t)return{};var u,l,d,p,h,f,m=a||{};if(void 0===m.events&&(m.events={}),void 0===m.tracks&&(m.tracks={}),void 0===(f=-1!==t.indexOf("TICKS")?parseInt(t.replace(/TICKS/,""),10):r[t]*i))return void(n.debug&&o.warn("invalid quantize value"));for(u=e.length-1;u>=0;u--)l=e[u],m.events[l.id]={event:l,ticks:l.ticks},128!==l.type&&(d=l.ticks,p=s(d/f)*f,h=p-d,l.ticks=p,l.state="changed",l.part.needsUpdate=!0,l.track.needsUpdate=!0,c=l.track,void 0===m.tracks[c.id]&&(m.tracks[c.id]={track:c,quantizedEvents:[]}),m.tracks[c.id].quantizedEvents.push(l),void 0!==l.midiNote&&(l.midiNote.noteOff.ticks+=h,l.midiNote.noteOff.state="changed",l.midiNote.state="changed",m.tracks[c.id].quantizedEvents.push(l.midiNote.noteOff)));return m}function t(e,t,i,n){}var i,n=window.sequencer,o=window.console,s=(Math.floor,Math.round),r={1:4,"1.":6,"1..":7,"1...":7.5,"1T":2/3*4,2:2,"2.":3,"2..":3.5,"2...":3.75,"2T":2/3*2,4:1,"4.":1.5,"4..":1.75,"4...":1.875,"4T":2/3*1,8:.5,"8.":.75,"8..":.875,"8...":.9375,"8T":2/3*1/2,16:.25,"16.":.375,"16..":.4375,"16...":.46875,"16T":2/3*1/4,32:1/8,"32.":.1875,"32..":.21875,"32...":.234375,"32T":2/3*1/8,64:1/16,"64.":.09375,"64..":.109375,"64...":.1171875,"64T":2/3*1/16,128:1/32,"128.":1.5/32,"128..":1.75/32,"128...":1.875/32,"128T":2/3*1/32};n.protectedScope.addInitMethod(function(){i=n.protectedScope.copyObject}),n.quantize=e,n.fixedLength=t}(),function(){function e(e,i,o){try{t.decodeAudioData(n(e),function(){window.sequencer[i]=!0,o()},function(){o()})}catch(e){o()}}var t,i,n,o=window.sequencer,s=!1,r=[];o.protectedScope.callInitMethods(),t=o.protectedScope.context,i=o.protectedScope.initMidi,n=o.protectedScope.base64ToBinary,delete o.protectedScope,o.ready=function(e){!0===s?e():r.push(e)},o.addInstrument({name:"sinewave",folder:"heartbeat",autopan:!1,attack:200,keyrange:[21,108],release_duration:50}),o.addInstrument({name:"metronome",folder:"heartbeat",sample_path:"heartbeat/metronome",keyrange:[60,61],mapping:{60:{n:"lowtick"},61:{n:"hightick"}}}),o.addSamplePack({name:"metronome",folder:"heartbeat",mapping:{hightick:"UklGRkQFAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YSAFAACx/xf/dADOACwBsP3p+6H+zAGoBOkCCwBX/EH5OvxlA4kJ2wcSArT9E/ut+HT2evUx98n6OAF5CCUMwQvfCOsJxAx0DSIMEAq9BiAB3vhz7mLkT9sR133YxN2s5QLv0vrUBnwRnxuQJeEsSDCiMd8yFS8aKFIhohUsCKj64u625OraA9HuyPnElcP+wxvJWtW25637VQ0jHPgnBTDDM1o0CzKLK+8hzhgFDOz8Se4J47DYVtG0z5fQq9LB12rfA+j99roHAhelIyMwIjdTOuU8mjwIOGoxhCb5E53/j+3k3/fTY8pTw4y/Tr+ew8DMvdsk8RcHRRkSKO4yGTkHPkU/rzzyNcgsrR94Dp/5r+Zs17zOncoDxhfE38WLyn/TeOMi9r0IRxlRKIQzyTlOPKo9yjmWMcokDRLc/Y7rudtdzu/D2L1Iu+27JcG3yYrVLujl+3UOZx1UK5Q0qzmNPDk8ZjeeMPojzhH+/jLtPd5m0hHLHsYIw5TEMMnA0jvj8fSOBiwXASZgMzM8dUBGQbI+rzjpKkIZygZT9QflcdaRyqXCz7+VwUPH784r3K7s+v0KDu8bvyeLMb43NjrhOIo0dSvQHi0PnP6i7ovg3NTxy4/Gf8X8yH/QBtvX55P2Ygb0FcUjsy4LNmI5ejiXM38r7iC8FJwHPvok7dDgQdaJzlTKIsoFzsrVkuA87d/6qAi7FQ0h9ClKMLEz3TOrMBcqYSD8E9AFd/dS6kTf6dbU0XnQv9IH2MXfZ+ln9DEAFwwdFy8giib6KawqeChgI/UbHBOTCZj/vvXe7InlFuDN3P3b0d1F4gzpifG2+u4D7Qw1FfwbnCD+IlgjWyHLHPMVog2mBL37qvP+7NvnYuTv4rvjfubN6k3wpPZ0/WkEOwtiEUsWcxm+Gl4aOhhiFDAPIwmbAtn7TPVy77zqcefr5YHmHull7enyfPmcAHgHew1REr8Vhhd/F+AV1RJ0DikJWQNc/ZP3efKd7hvs2ur46rHs5u8e9N/48/0hA/8HFgwuD04RSBIREqsQOg7mCssGMAJW/Xn4G/TK8Lbuzu0I7qTvnPJy9sX6bP84BLYIbAwdD84QYxG7EOcODAxwCFMEAQC9+7P3SvTX8XHw+u9R8KTxIvSo9+X7VQCUBJ0IMwziDj4QLhAGD9UMrgnTBZcBRv1v+Xv2UfS+8tfx+vES87z0+vb3+Zf9ZgEQBSEIUArWC8kM2QyzC5EJEAdvBHgBXP5n++r4Avd89Wj07fMw9D31Jvfp+Uj9xQD9A8QG5QhXClELrAsvC9wJ7gd6BWIC3v6O+7T4PPZN9EHzWvNf9Pz1Fvit+qL9rQCHAwEG/weCCZUKFwvDCnIJcAcQBWcCaf8Z/CD55vaB9dD0wPSP9UL3m/k7/Mz+JwEyAw8FzAY7CBsJaQk5CWkI2gatBCICYf+j/Fr6vfiV9872sfZP91z4p/lR+3H9zf89AroEFAfjCP0Jcwo8CjAJdQdgBSEDkgDQ/Vj7ZfnR95T28fUd9v32Vvg2+nb8+/6xAWoE4AbDCP4JpAqbCqQJ0weEBfgCTACT/R37M/m+9672IPY69gb3afhW+tT8qf+MAj0FggcuCScKXAriCcMIEAfyBJYCFwCP/Rz7A/l793z2F/Zn9mH37fjd+i39yf9pAt0EFAfRCNkJGAqrCZYIvgZPBJ8B6P4//M350vdz9q/1lfUq9mz3RPmi+3H+bgFVBOQG3wgHCkwK0Am7CCAHCgWmAjAA",lowtick:"UklGRlQFAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YTAFAAB0/5v+U/4T/3gA0wFTAuUB+f8d/nT90f1q/ub+tf46/mb/8wFQA9gC7wCd/mr+FAGRA3cE6wJf/h36evmv+8v/NwRHBZUC2/60+//5EvuZ/aX/bgFOAp8Azvzh9wfzLPF68zT4y/2BAygIfQwaEjYY0x31Irwl8SOWHVESOgPh9NfpReFt22nYHddD2BXcZeDa5InqgPDx9nP+6gS4CBYLnw0zES0WXxv4HkcgLh/1G+EX1RNpD4wKigXH/6r5/fNu7lTpj+Zu5hHoXOtL71byr/Qp91L64v6OBO4JoQ5zEskU+hU1FiQVeRP7EWgP4Qr0BIT+tPid9C3y1vCh8FDxJvK28vvyy/LA8pLzU/XP95v6xvw4/uD/RAK2BSkKcg6BEScTZBMeEqkPTQxjCKEEVwFi/nv7h/hp9aDyAvHP8MfxLvM+9PX0uPW19g/4Lfr7/C4AKgNaBXQGywb0BhIHWQfWB1oIzAjtCF8IHwdtBakDVwKLAeYA8v9w/kj81/nQ94v29/XX9bz1bPUY9Uz1Z/aH+Hr7yP4MAi4F+wcfCnYLNgyfDPsMSw0sDUAMfgrcB5IEMwFb/iX8T/pT+O/1X/Mf8cbvrO+18MLyvfVP+Rf9wgAoBCEHpwnIC5EN4Q5AD3wO1Ay0CpsIvwbvBNcCbQAr/nX8Ofsf+vb4mvda9rj1z/WX9pL3a/hH+ZX6R/wn/vP/eQESA/AE+wYDCcwKFAyPDCkMFQuSCe4HVQbSBHQDCwI8ANL9JPuY+HX28vTq82PzdPMV9Az1MfZ49zD5gftx/sQBBQXLB8cJ/gqpCw8MigwWDXENXQ2rDDUL7QgDBswCdv8S/K74WPVk8hXwou4P7mvu1+9T8pz1Uvli/ZoBwgWRCcsMPg/CEEQR4RDADwoO9wusCVMH4ARSApn/ufzd+Wj3bvX78xzzx/L68qzz1vSD9qX4Gfvd/c0AhwO/BWwHmghvCQEKVQonClsJCwiIBh0F0gOgAm0BOwAx/03+XP0g/Lb6cPmX+F/4vfh++TH6s/os+7/7cvwL/Zz9XP5O/3IA3AF9AzsF9gaUCAAKHgueCzcL9wntB3sF4wIzAI396fp1+Gv2IvWn9N30p/Xi9m74G/ru+9P9k/8aAYEC1AMTBSIG0wYuB1gHkgcACGEISAhTBzEFWAKt/5L92fuU+vX50fmf+SP5i/gb+Bf4mviv+Sr7kvyb/Uj+r/4X/8r/+gCiAo0EUAaRBzwISwjqB3IHGQfCBv8FpgTMApQAKf67+5n5/vfn9jz2yPVn9SL1RPXq9SP3Dvmr+6f+sQGKBAcH+whOCh0Laws3C28KLAmDB5AFfQNoAVP/Zv3e+7P6sfnL+Cv4vPeM95b37feV+Jn51Poq/LL9mv+YAVYD3gQuBmcHSAikCIEI7Af+BuEFngQXA1sBv/9v/pf9MP3W/Fj8q/sR+6H6U/o3+mP6y/pN+/f7xvye/WH+Jf9mAD4CQAQJBisHtgf6Bw0I8QdsB1sGywT4AggBCP/o/KX6mPg19572jfaz9uf2S/cM+E35E/tW/af/5wH1A8AFKgfkB/AHgwfxBlAGgQVIBMMCJwGs/43+vP0i/Zr8Lfzl+9H76fvi+9f75fsf/In8BP10/ej9cf4O/7f/dAAcAaUBEgKMAhgDpAMEBCEEDwTfA3IDxQL8ASoBUwCG/87+J/6h/Rr9pPxk/Gb8oPwJ/XH9w/39/UD+qP41/9D/WwDeAGsBAgKdAhEDQQNAA0sDbwOVA5YDVwPOAhgCVAGRAA=="}}),o.addTask({type:"test mp3",method:function(t){e("//sQxAADwAABpAAAACAAADSAAAAETEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU=","mp3",t)},params:[]}),o.addTask({type:"test ogg",method:function(t){e("T2dnUwACAAAAAAAAAABdxd4XAAAAADaS0jQBHgF2b3JiaXMAAAAAAUSsAAAAAAAAgLsAAAAAAAC4AU9nZ1MAAAAAAAAAAAAAXcXeFwEAAAAaXK+QDz3/////////////////MgN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAAAAAAEFdm9yYmlzH0JDVgEAAAEAGGNUKUaZUtJKiRlzlDFGmWKSSomlhBZCSJ1zFFOpOdeca6y5tSCEEBpTUCkFmVKOUmkZY5ApBZlSEEtJJXQSOiedYxBbScHWmGuLQbYchA2aUkwpxJRSikIIGVOMKcWUUkpCByV0DjrmHFOOSihBuJxzq7WWlmOLqXSSSuckZExCSCmFkkoHpVNOQkg1ltZSKR1zUlJqQegghBBCtiCEDYLQkFUAAAEAwEAQGrIKAFAAABCKoRiKAoSGrAIAMgAABKAojuIojiM5kmNJFhAasgoAAAIAEAAAwHAUSZEUybEkS9IsS9NEUVV91TZVVfZ1Xdd1Xdd1IDRkFQAAAQBASKeZpRogwgxkGAgNWQUAIAAAAEYowhADQkNWAQAAAQAAYig5iCa05nxzjoNmOWgqxeZ0cCLV5kluKubmnHPOOSebc8Y455xzinJmMWgmtOaccxKDZiloJrTmnHOexOZBa6q05pxzxjmng3FGGOecc5q05kFqNtbmnHMWtKY5ai7F5pxzIuXmSW0u1eacc84555xzzjnnnHOqF6dzcE4455xzovbmWm5CF+eccz4Zp3tzQjjnnHPOOeecc84555xzgtCQVQAAEAAAQRg2hnGnIEifo4EYRYhpyKQH3aPDJGgMcgqpR6OjkVLqIJRUxkkpnSA0ZBUAAAgAACGEFFJIIYUUUkghhRRSiCGGGGLIKaecggoqqaSiijLKLLPMMssss8wy67CzzjrsMMQQQwyttBJLTbXVWGOtueecaw7SWmmttdZKKaWUUkopCA1ZBQCAAAAQCBlkkEFGIYUUUoghppxyyimooAJCQ1YBAIAAAAIAAAA8yXNER3RER3RER3RER3REx3M8R5RESZRESbRMy9RMTxVV1ZVdW9Zl3fZtYRd23fd13/d149eFYVmWZVmWZVmWZVmWZVmWZVmC0JBVAAAIAACAEEIIIYUUUkghpRhjzDHnoJNQQiA0ZBUAAAgAIAAAAMBRHMVxJEdyJMmSLEmTNEuzPM3TPE30RFEUTdNURVd0Rd20RdmUTdd0Tdl0VVm1XVm2bdnWbV+Wbd/3fd/3fd/3fd/3fd/3dR0IDVkFAEgAAOhIjqRIiqRIjuM4kiQBoSGrAAAZAAABACiKoziO40iSJEmWpEme5VmiZmqmZ3qqqAKhIasAAEAAAAEAAAAAACia4imm4imi4jmiI0qiZVqipmquKJuy67qu67qu67qu67qu67qu67qu67qu67qu67qu67qu67qu67ouEBqyCgCQAADQkRzJkRxJkRRJkRzJAUJDVgEAMgAAAgBwDMeQFMmxLEvTPM3TPE30RE/0TE8VXdEFQkNWAQCAAAACAAAAAAAwJMNSLEdzNEmUVEu1VE21VEsVVU9VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU1TdM0TSA0ZCUAAAQAwGKNweUgISUl5d4QwhCTnjEmIbVeIQSRkt4xBhWDnjKiDHLeQuMQgx4IDVkRAEQBAADGIMcQc8g5R6mTEjnnqHSUGuccpY5SZynFmGLNKJXYUqyNc45SR62jlGIsLXaUUo2pxgIAAAIcAAACLIRCQ1YEAFEAAIQxSCmkFGKMOaecQ4wp55hzhjHmHHOOOeegdFIq55x0TkrEGHOOOaecc1I6J5VzTkonoQAAgAAHAIAAC6HQkBUBQJwAgEGSPE/yNFGUNE8URVN0XVE0XdfyPNX0TFNVPdFUVVNVbdlUVVmWPM80PdNUVc80VdVUVVk2VVWWRVXVbdN1ddt0Vd2Wbdv3XVsWdlFVbd1UXds3Vdf2Xdn2fVnWdWPyPFX1TNN1PdN0ZdV1bVt1XV33TFOWTdeVZdN1bduVZV13Zdn3NdN0XdNVZdl0Xdl2ZVe3XVn2fdN1hd+VZV9XZVkYdl33hVvXleV0Xd1XZVc3Vln2fVvXheHWdWGZPE9VPdN0Xc80XVd1XV9XXdfWNdOUZdN1bdlUXVl2Zdn3XVfWdc80Zdl0Xds2XVeWXVn2fVeWdd10XV9XZVn4VVf2dVnXleHWbeE3Xdf3VVn2hVeWdeHWdWG5dV0YPlX1fVN2heF0Zd/Xhd9Zbl04ltF1fWGVbeFYZVk5fuFYlt33lWV0XV9YbdkYVlkWhl/4neX2feN4dV0Zbt3nzLrvDMfvpPvK09VtY5l93VlmX3eO4Rg6v/Djqaqvm64rDKcsC7/t68az+76yjK7r+6osC78q28Kx677z/L6wLKPs+sJqy8Kw2rYx3L5uLL9wHMtr68ox675RtnV8X3gKw/N0dV15Zl3H9nV040c4fsoAAIABBwCAABPKQKEhKwKAOAEAjySJomRZoihZliiKpui6omi6rqRppqlpnmlammeapmmqsimarixpmmlanmaamqeZpmiarmuapqyKpinLpmrKsmmasuy6sm27rmzbomnKsmmasmyapiy7sqvbruzquqRZpql5nmlqnmeapmrKsmmarqt5nmp6nmiqniiqqmqqqq2qqixbnmeamuippieKqmqqpq2aqirLpqrasmmqtmyqqm27quz6sm3rummqsm2qpi2bqmrbruzqsizbui9pmmlqnmeamueZpmmasmyaqitbnqeaniiqquaJpmqqqiybpqrKlueZqieKquqJnmuaqirLpmraqmmatmyqqi2bpirLrm37vuvKsm6qqmybqmrrpmrKsmzLvu/Kqu6KpinLpqrasmmqsi3bsu/Lsqz7omnKsmmqsm2qqi7Lsm0bs2z7umiasm2qpi2bqirbsi37uizbuu/Krm+rqqzrsi37uu76rnDrujC8smz7qqz6uivbum/rMtv2fUTTlGVTNW3bVFVZdmXZ9mXb9n3RNG1bVVVbNk3VtmVZ9n1Ztm1hNE3ZNlVV1k3VtG1Zlm1htmXhdmXZt2Vb9nXXlXVf133j12Xd5rqy7cuyrfuqq/q27vvCcOuu8AoAABhwAAAIMKEMFBqyEgCIAgAAjGGMMQiNUs45B6FRyjnnIGTOQQghlcw5CCGUkjkHoZSUMucglJJSCKGUlFoLIZSUUmsFAAAUOAAABNigKbE4QKEhKwGAVAAAg+NYlueZomrasmNJnieKqqmqtu1IlueJommqqm1bnieKpqmqruvrmueJommqquvqumiapqmqruu6ui6aoqmqquu6sq6bpqqqriu7suzrpqqqquvKriz7wqq6rivLsm3rwrCqruvKsmzbtm/cuq7rvu/7wpGt67ou/MIxDEcBAOAJDgBABTasjnBSNBZYaMhKACADAIAwBiGDEEIGIYSQUkohpZQSAAAw4AAAEGBCGSg0ZEUAECcAABhDKaSUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJIKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKqaSUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKZVSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUgoAkIpwAJB6MKEMFBqyEgBIBQAAjFFKKcacgxAx5hhj0EkoKWLMOcYclJJS5RyEEFJpLbfKOQghpNRSbZlzUlqLMeYYM+ekpBRbzTmHUlKLseaaa+6ktFZrrjXnWlqrNdecc825tBZrrjnXnHPLMdecc8455xhzzjnnnHPOBQDgNDgAgB7YsDrCSdFYYKEhKwGAVAAAAhmlGHPOOegQUow55xyEECKFGHPOOQghVIw55xx0EEKoGHPMOQghhJA55xyEEEIIIXMOOugghBBCBx2EEEIIoZTOQQghhBBKKCGEEEIIIYQQOgghhBBCCCGEEEIIIYRSSgghhBBCCaGUUAAAYIEDAECADasjnBSNBRYashIAAAIAgByWoFLOhEGOQY8NQcpRMw1CTDnRmWJOajMVU5A5EJ10EhlqQdleMgsAAIAgACDABBAYICj4QgiIMQAAQYjMEAmFVbDAoAwaHOYBwANEhEQAkJigSLu4gC4DXNDFXQdCCEIQglgcQAEJODjhhife8IQbnKBTVOogAAAAAAAMAOABAOCgACIimquwuMDI0Njg6PAIAAAAAAAWAPgAADg+gIiI5iosLjAyNDY4OjwCAAAAAAAAAACAgIAAAAAAAEAAAACAgE9nZ1MABAEAAAAAAAAAXcXeFwIAAABq2npxAgEBAAo=","ogg",t)},params:[]}),o.addTask({type:"init midi",method:i,params:[]},function(){if(r.forEach(function(e){e()}),o.debug>=4){var e="sequencer ready, support for:";!0===o.ogg&&(e+=" ogg"),!0===o.mp3&&(e+=" mp3"),console.log(e)}s=!0},!1)}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});for(var r=(function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}()),a=i(0),c=function(e){return e&&e.__esModule?e:{default:e}}(a),u=i(1),l=[],d=0;d<=1e4;d+=200)l.push(c.default.createElement(u.Note,{key:d,ticks:d,number:function(e){return Math.floor(Math.random()*Math.floor(e))}(120),duration:30,velocity:60}));var p=function(e){function t(){return n(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),r(t,[{key:"render",value:function(){return c.default.createElement(u.Song,{bpm:100,metronome:100},l)}}]),t}(c.default.Component);t.default=p},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(0),c=function(e){return e&&e.__esModule?e:{default:e}}(a),u=i(1),l=document.querySelector("#bhc").value,d=function(e){function t(){return n(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),r(t,[{key:"render",value:function(){return c.default.createElement(u.Song,null,c.default.createElement(u.Midi,{base64:l}))}}]),t}(c.default.Component);t.default=d},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(0),c=function(e){return e&&e.__esModule?e:{default:e}}(a),u=i(1),l=document.querySelector("#bsb").value,d=function(e){function t(){return n(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),r(t,[{key:"render",value:function(){return c.default.createElement(u.Song,null,c.default.createElement(u.Midi,{base64:l}))}}]),t}(c.default.Component);t.default=d},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(0),c=function(e){return e&&e.__esModule?e:{default:e}}(a),u=i(1),l=document.querySelector("#yyh").value,d=function(e){function t(){return n(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),r(t,[{key:"render",value:function(){return c.default.createElement(u.Song,null,c.default.createElement(u.Midi,{base64:l}))}}]),t}(c.default.Component);t.default=d},function(e,t,i){"use strict";document.body.addEventListener("songCreated",function(e){function t(e){var t,i,n=document.querySelectorAll("input, select"),o=n.length;for(t=0;t<o;t++)i=n[t],i.disabled=!e}function i(){var e,t=O.getSnapshot("key-editor");if(A.style.left=O.getPlayheadX()-10+"px",b.innerHTML=O.currentPage+"/"+O.numPages,v.innerHTML=d.timeAsString,t.notes.removed.forEach(function(e){x[e.id].removeEventListener("mousedown",u),T.removeChild(document.getElementById(e.id))}),t.notes.new.forEach(function(e){a(e)}),t.notes.recorded.forEach(function(e){a(e)}),t.notes.recording.forEach(function(e){c(x[e.id],e.bbox)}),t.notes.changed.forEach(function(e){c(x[e.id],e.bbox)}),t.notes.stateChanged.forEach(function(t){e=document.getElementById(t.id),!1===t.part.mute&&(t.active?e.className="note note-active":!1===t.active&&(e.className="note"))}),t.hasNewBars){for(w.style.width=t.newWidth+"px",S.innerHTML="",O.horizontalLine.reset();O.horizontalLine.hasNext("chromatic");)s(O.horizontalLine.next("chromatic"));for(;O.verticalLine.hasNext("sixteenth");)r(O.verticalLine.next("sixteenth"))}requestAnimationFrame(i)}function n(){var e=m.getBoundingClientRect().height,t=window.innerWidth,i=window.innerHeight-e;O.setViewport(t,i),k.style.width=t+"px",k.style.height=i+"px"}function o(){for(x={},I={},T.innerHTML="",S.innerHTML="",E.innerHTML="",N.innerHTML="",P.innerHTML="",O.horizontalLine.reset(),O.verticalLine.reset(),O.noteIterator.reset(),w.style.width=O.width+"px";O.horizontalLine.hasNext("chromatic");)s(O.horizontalLine.next("chromatic"));for(;O.verticalLine.hasNext("sixteenth");)r(O.verticalLine.next("sixteenth"));for(;O.noteIterator.hasNext();)a(O.noteIterator.next())}function s(e){var t=document.createElement("div"),i=O.pitchHeight;!0===e.note.blackKey?t.className="pitch-line black-key":t.className="pitch-line",t.id=e.note.fullName,t.style.height=i+"px",t.style.top=e.y+"px",t.y=e.y,S.appendChild(t)}function r(e){var t=e.type,i=document.createElement("div");switch(i.id=e.position.barsAsString,i.className=e.type+"-line",i.style.left=e.x+"px",i.style.width="5px",i.x=e.x,t){case"bar":E.appendChild(i);break;case"beat":N.appendChild(i);break;case"sixteenth":P.appendChild(i)}}function a(e){var t=e.bbox,i=document.createElement("div");i.id=e.id,i.className="note",c(i,t),I[e.id]=e,x[e.id]=i,i.addEventListener("mousedown",u,!1),T.appendChild(i)}function c(e,t){e.style.left=t.x+"px",e.style.top=t.y+"px",e.style.width=t.width+"px",e.style.height=t.height+"px"}function u(e){var t=I[e.target.id];e.ctrlKey?O.removeNote(t):(O.startMoveNote(t,e.pageX,e.pageY),document.addEventListener("mouseup",l,!1))}function l(){O.stopMoveNote(),document.removeEventListener("mouseup",l)}var d=e.detail,p=window.sequencer,h=document.getElementById("play"),f=document.getElementById("stop"),m=document.getElementById("controls"),v=document.getElementById("time-seconds"),g=document.getElementById("mouse-x"),y=document.getElementById("mouse-y"),b=document.getElementById("page-numbers"),k=document.getElementById("editor"),w=document.getElementById("score"),E=document.getElementById("bar-lines"),N=document.getElementById("beat-lines"),P=document.getElementById("sixteenth-lines"),S=document.getElementById("pitch-lines"),T=document.getElementById("notes"),A=document.getElementById("playhead"),I=void 0,x=void 0,O=void 0;t(!1),function(){var e,s,r,a=m.getBoundingClientRect().height,c=window.innerWidth,u=window.innerHeight-a,l=[];k.style.width=c+"px",k.style.height=u+"px",e=p.util.getRandomNotes({minNoteNumber:60,maxNoteNumber:100,minVelocity:30,maxVelocity:80,numNotes:12,noteLength:480}),r=p.createPart(),r.addEvents(e),l.push(p.createMidiEvent(0,p.TIME_SIGNATURE,6,8)),l.push(p.createMidiEvent(2880,p.TIME_SIGNATURE,4,4)),d.addEventListener("play",function(){h.value="pause"}),d.addEventListener("pause",function(){h.value="play"}),d.addEventListener("stop",function(){h.value="play"}),O=p.createKeyEditor(d,{keyListener:!0,viewportHeight:u,viewportWidth:c,lowestNote:58,highestNote:102,barsPerPage:4}),O.addEventListener("scale draw",function(){o()}),O.addEventListener("scroll",function(e){k.scrollLeft=e.x}),w.addEventListener("mousedown",function(e){var t=e.target.className;-1===t.indexOf("part")&&-1===t.indexOf("note")&&O.setPlayheadToX(e.pageX)}),k.addEventListener("scroll",function(){O.updateScroll(k.scrollLeft,k.scrollTop)},!1),w.addEventListener("mousemove",function(e){e.preventDefault();var t=e.pageX,i=e.pageY,n=O.getPositionAt(t),o=O.selectedPart,s=O.selectedNote;g.innerHTML="x "+n.barsAsString,y.innerHTML="y "+O.getPitchAt(i).number,void 0!==o&&O.movePart(t,i),void 0!==s&&O.moveNote(t,i)},!1),h.addEventListener("click",function(){d.pause()}),f.addEventListener("click",function(){d.stop()}),window.addEventListener("resize",n,!1),t(!0),s=document.createEvent("HTMLEvents"),s.initEvent("change",!1,!1),o(),i()}()})}]);